<!DOCTYPE html><html lang="zh-CN"><head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.jpg">
  <link rel="mask-icon" href="/images/avatar.jpg" color="#222">
  <link rel="alternate" href="/atom.xml" title="贝克街的流浪猫" type="application/atom+xml">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="google-site-verification" content="PB8pKbwvyCztAdFAxM1AdLMfqXY7wDk6xWZIy3BYn0M">
  <meta name="baidu-site-verification" content="lHxDkbImj8">





  
  


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.5.0',
    exturl: true,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":null},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: true,
    lazyload: false,
    pangu: true,
    algolia: {
      appID: 'XKULKGLQCN',
      apiKey: '59d463bff59108a7719f93aa31f249f3',
      indexName: 'Hexo Blog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"文章查询","hits_empty":"很抱歉，贝贝猫没有发表关于 \"${query}\" 的文章","hits_stats":"找到了 ${hits} 篇文章，耗时 ${time} 毫秒"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="引言本系列文章将整理各路流媒体传输协议，包括RTP/RTCP，RTMP，希望通过深入理解各个流媒体传输协议的设计细节，对今后流媒体部分的开发工作有一定的启发。">
<meta property="og:type" content="article">
<meta property="og:title" content="流媒体传输协议之 RTP">
<meta property="og:url" content="https://www.beikejiedeliulangmao.top/protocol/rtp/index.html">
<meta property="og:site_name" content="贝克街的流浪猫">
<meta property="og:description" content="引言本系列文章将整理各路流媒体传输协议，包括RTP/RTCP，RTMP，希望通过深入理解各个流媒体传输协议的设计细节，对今后流媒体部分的开发工作有一定的启发。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="article:published_time" content="2019-02-22T00:09:51.000Z">
<meta property="article:modified_time" content="2021-01-17T04:25:40.566Z">
<meta property="article:author" content="贝克街的流浪猫">
<meta property="article:tag" content="Stream Media">
<meta property="article:tag" content="RTP">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">

<link rel="canonical" href="https://www.beikejiedeliulangmao.top/protocol/rtp/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>流媒体传输协议之 RTP | 贝克街的流浪猫</title>
  
    <script>
      function sendPageView() {
        var host = window.location.hostname;
        if (host == "localhost" && true) return;
        var uid = localStorage.getItem('uid') || (Math.random() + '.' + Math.random());
        localStorage.setItem('uid', uid);
        navigator.sendBeacon('https://www.google-analytics.com/collect', new URLSearchParams({
          v  : 1,
          tid: 'UA-146830566-1',
          cid: uid,
          t  : 'pageview',
          dp : encodeURIComponent(location.pathname)
        }));
      }
      document.addEventListener('pjax:complete', sendPageView);
      sendPageView();
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?818a8e6061ff2bd0b5531a739f216601";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <style>body {
  background-image: url("https://www.beikejiedeliulangmao.top/images/background.jpeg") !important;
  background-attachment: fixed !important;
  background-repeat: no-repeat !important;
  background-size: 100% 100% !important;
}
.bg_content {
  position: fixed;
  top: 0;
  z-index: -1;
  width: 100%;
  height: 100%;
}
.copyright {
  color: #000;
}
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
  background-color: #fff;
}
::-webkit-scrollbar-button {
  width: 0;
  height: 0;
}
::-webkit-scrollbar-button:start:increment,
::-webkit-scrollbar-button:end:decrement {
  display: none;
}
::-webkit-scrollbar-corner {
  display: block;
}
::-webkit-scrollbar-thumb {
  border-radius: 6px;
  background-color: rgba(0,0,0,0.4);
}
::-webkit-scrollbar-thumb:hover {
  border-radius: 6px;
  background-color: rgba(0,0,0,0.6);
}
::-webkit-scrollbar-track,
::-webkit-scrollbar-thumb {
  border-right: 1px solid transparent;
  border-left: 1px solid transparent;
}
::-webkit-scrollbar-button:start {
  width: 8px;
  height: 8px;
}
::-webkit-scrollbar-button:end {
  width: 6px;
  height: 6px;
}
html {
  line-height: 1.15; 
  -webkit-text-size-adjust: 100%; 
}
body {
  margin: 0;
}
main {
  display: block;
}
h1 {
  font-size: 2em;
  margin: 0.67em 0;
}
hr {
  box-sizing: content-box; 
  height: 0; 
  overflow: visible; 
}
pre {
  font-family: monospace, monospace; 
  font-size: 1em; 
}
a {
  background: transparent;
}
abbr[title] {
  border-bottom: none; 
  text-decoration: underline; 
  text-decoration: underline dotted; 
}
b,
strong {
  font-weight: bolder;
}
code,
kbd,
samp {
  font-family: monospace, monospace; 
  font-size: 1em; 
}
small {
  font-size: 80%;
}
sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
sub {
  bottom: -0.25em;
}
sup {
  top: -0.5em;
}
img {
  border-style: none;
}
button,
input,
optgroup,
select,
textarea {
  font-family: inherit; 
  font-size: 100%; 
  line-height: 1.15; 
  margin: 0; 
}
button,
input {

  overflow: visible;
}
button,
select {

  text-transform: none;
}
button,
[type='button'],
[type='reset'],
[type='submit'] {
  -webkit-appearance: button;
}
button::-moz-focus-inner,
[type='button']::-moz-focus-inner,
[type='reset']::-moz-focus-inner,
[type='submit']::-moz-focus-inner {
  border-style: none;
  padding: 0;
}
button:-moz-focusring,
[type='button']:-moz-focusring,
[type='reset']:-moz-focusring,
[type='submit']:-moz-focusring {
  outline: 1px dotted ButtonText;
}
fieldset {
  padding: 0.35em 0.75em 0.625em;
}
legend {
  box-sizing: border-box; 
  color: inherit; 
  display: table; 
  max-width: 100%; 
  padding: 0; 
  white-space: normal; 
}
progress {
  vertical-align: baseline;
}
textarea {
  overflow: auto;
}
[type='checkbox'],
[type='radio'] {
  box-sizing: border-box; 
  padding: 0; 
}
[type='number']::-webkit-inner-spin-button,
[type='number']::-webkit-outer-spin-button {
  height: auto;
}
[type='search'] {
  outline-offset: -2px; 
  -webkit-appearance: textfield; 
}
[type='search']::-webkit-search-decoration {
  -webkit-appearance: none;
}
::-webkit-file-upload-button {
  font: inherit; 
  -webkit-appearance: button; 
}
details {
  display: block;
}
summary {
  display: list-item;
}
template {
  display: none;
}
[hidden] {
  display: none;
}
::selection {
  background: #262a30;
  color: #fff;
}
html,
body {
  height: 100%;
}
body {
  background: #eee;
  color: #555;
  font-family: 'Monda', "PingFang SC", "Microsoft YaHei", sans-serif;
  font-size: 1em;
  line-height: 2;
}
@media (max-width: 991px) {
  body {
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
}
h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: 'Roboto Slab', 'Monda', "PingFang SC", "Microsoft YaHei", sans-serif;
  font-weight: bold;
  line-height: 1.5;
  margin: 20px 0 15px;
  padding: 0;
}
h1 {
  font-size: 1.5em;
}
h2 {
  font-size: 1.375em;
}
h3 {
  font-size: 1.25em;
}
h4 {
  font-size: 1.125em;
}
h5 {
  font-size: 1em;
}
h6 {
  font-size: 0.875em;
}
p {
  margin: 0 0 20px 0;
}
a,
span.exturl {
  border-bottom: 1px solid #999;
  color: #555;
  outline: 0;
  text-decoration: none;
  overflow-wrap: break-word;
  word-wrap: break-word;
  cursor: pointer;
}
a:hover,
span.exturl:hover {
  border-bottom-color: #222;
  color: #222;
}
iframe,
img,
video {
  display: block;
  margin-left: auto;
  margin-right: auto;
  max-width: 100%;
}
hr {
  background-color: #ddd;
  background-image: repeating-linear-gradient(-45deg, #fff, #fff 4px, transparent 4px, transparent 8px);
  border: 0;
  height: 3px;
  margin: 40px 0;
}
blockquote {
  border-left: 4px solid #ddd;
  color: #666;
  margin: 0;
  padding: 0 15px;
}
blockquote cite::before {
  content: '-';
  padding: 0 5px;
}
dt {
  font-weight: 700;
}
dd {
  margin: 0;
  padding: 0;
}
kbd {
  background-color: #f5f5f5;
  background-image: linear-gradient(#eee, #fff, #eee);
  border: 1px solid #ccc;
  border-radius: 0.2em;
  box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1);
  font-family: inherit;
  padding: 0.1em 0.3em;
  white-space: nowrap;
}
.table-container {
  -webkit-overflow-scrolling: touch;
  overflow: auto;
}
table {
  border-collapse: collapse;
  border-spacing: 0;
  font-size: 0.875em;
  margin: 0 0 20px 0;
  width: 100%;
}
tbody tr:nth-of-type(odd) {
  background: #f9f9f9;
}
tbody tr:hover {
  background: #f5f5f5;
}
caption,
th,
td {
  font-weight: normal;
  padding: 8px;
  text-align: left;
  vertical-align: middle;
}
th,
td {
  border: 1px solid #ddd;
  border-bottom: 3px solid #ddd;
}
th {
  font-weight: 700;
  padding-bottom: 10px;
}
td {
  border-bottom-width: 1px;
}
.btn {
  background: #fff;
  border: 2px solid #555;
  border-radius: 2px;
  color: #555;
  display: inline-block;
  font-size: 0.875em;
  line-height: 2;
  padding: 0 20px;
  text-decoration: none;
  transition-property: background-color;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.btn:hover {
  background: #222;
  border-color: #222;
  color: #fff;
}
.btn + .btn {
  margin: 0 0 8px 8px;
}
.btn .fa-fw {
  text-align: left;
  width: 1.285714285714286em;
}
.toggle {
  line-height: 0;
}
.toggle .toggle-line {
  background: #fff;
  display: inline-block;
  height: 2px;
  left: 0;
  position: relative;
  top: 0;
  transition: all 0.4s;
  vertical-align: top;
  width: 100%;
}
.toggle .toggle-line:not(:first-child) {
  margin-top: 3px;
}
.toggle.toggle-arrow .toggle-line-first {
  left: 50%;
  top: 2px;
  transform: rotate(45deg);
  width: 50%;
}
.toggle.toggle-arrow .toggle-line-middle {
  left: 2px;
  width: 90%;
}
.toggle.toggle-arrow .toggle-line-last {
  left: 50%;
  top: -2px;
  transform: rotate(-45deg);
  width: 50%;
}
.toggle.toggle-close .toggle-line-first {
  transform: rotate(-45deg);
  top: 5px;
}
.toggle.toggle-close .toggle-line-middle {
  opacity: 0;
}
.toggle.toggle-close .toggle-line-last {
  transform: rotate(45deg);
  top: -5px;
}
.highlight-container {
  position: relative;
}
.highlight-container:hover .copy-btn,
.highlight-container .copy-btn:focus {
  opacity: 1;
}
.copy-btn {
  color: #333;
  cursor: pointer;
  display: inline-block;
  font-weight: 700;
  line-height: 1.6;
  opacity: 0;
  outline: 0;
  padding: 2px 6px;
  position: absolute;
  transition: opacity 0.3s ease-in-out;
  vertical-align: middle;
  white-space: nowrap;
  -moz-user-select: none;
  -ms-user-select: none;
  -webkit-user-select: none;
  user-select: none;
  background-color: #eee;
  background-image: linear-gradient(#fcfcfc, #eee);
  border: 1px solid #d5d5d5;
  border-radius: 3px;
  font-size: 0.8125em;
  right: 4px;
  top: 8px;
}
.highlight,
pre {
  background: #f7f7f7;
  color: #4d4d4c;
  line-height: 1.6;
  margin: 0 auto 20px;
}
pre,
code {
  font-family: 'PT Mono', consolas, Menlo, monospace, "PingFang SC", "Microsoft YaHei";
}
code {
  background: #eee;
  border-radius: 3px;
  color: #555;
  padding: 2px 4px;
  overflow-wrap: break-word;
  word-wrap: break-word;
}
.highlight *::selection {
  background: #d6d6d6;
}
.highlight pre {
  border: 0;
  margin: 0;
  padding: 0;
}
.highlight table {
  border: 0;
  margin: 0;
  width: auto;
}
.highlight tr:first-child pre {
  padding-top: 10px;
}
.highlight tr:last-child pre {
  padding-bottom: 10px;
}
.highlight td {
  border: 0;
  padding: 0;
}
.highlight figcaption {
  background: #eee;
  color: #4d4d4c;
  font-size: 0.875em;
  line-height: 1.2;
  padding: 0.5em;
}
.highlight figcaption::before,
.highlight figcaption::after {
  content: ' ';
  display: table;
}
.highlight figcaption::after {
  clear: both;
}
.highlight figcaption a {
  color: #4d4d4c;
  float: right;
}
.highlight figcaption a:hover {
  border-bottom-color: #4d4d4c;
}
.highlight .gutter pre {
  background: #eff2f3;
  color: #869194;
  padding-left: 10px;
  padding-right: 10px;
  text-align: right;
  -moz-user-select: none;
  -ms-user-select: none;
  -webkit-user-select: none;
  user-select: none;
}
.highlight .code pre {
  background: #f7f7f7;
  padding-left: 10px;
  width: 100%;
}
.gist table {
  width: auto;
}
.gist table td {
  border: 0;
}
pre {
  overflow: auto;
  padding: 10px;
}
pre code {
  background: none;
  color: #4d4d4c;
  font-size: 0.875em;
  padding: 0;
  text-shadow: none;
}
pre .deletion {
  background: #fdd;
}
pre .addition {
  background: #dfd;
}
pre .meta {
  color: #eab700;
  -moz-user-select: none;
  -ms-user-select: none;
  -webkit-user-select: none;
  user-select: none;
}
pre .comment {
  color: #8e908c;
}
pre .variable,
pre .attribute,
pre .tag,
pre .name,
pre .regexp,
pre .ruby .constant,
pre .xml .tag .title,
pre .xml .pi,
pre .xml .doctype,
pre .html .doctype,
pre .css .id,
pre .css .class,
pre .css .pseudo {
  color: #c82829;
}
pre .number,
pre .preprocessor,
pre .built_in,
pre .builtin-name,
pre .literal,
pre .params,
pre .constant,
pre .command {
  color: #f5871f;
}
pre .ruby .class .title,
pre .css .rules .attribute,
pre .string,
pre .symbol,
pre .value,
pre .inheritance,
pre .header,
pre .ruby .symbol,
pre .xml .cdata,
pre .special,
pre .formula {
  color: #718c00;
}
pre .title,
pre .css .hexcolor {
  color: #3e999f;
}
pre .function,
pre .python .decorator,
pre .python .title,
pre .ruby .function .title,
pre .ruby .title .keyword,
pre .perl .sub,
pre .javascript .title,
pre .coffeescript .title {
  color: #4271ae;
}
pre .keyword,
pre .javascript .function {
  color: #8959a8;
}
.blockquote-center {
  border-left: none;
  margin: 40px 0;
  padding: 0;
  position: relative;
  text-align: center;
}
.blockquote-center::before,
.blockquote-center::after {
  background-repeat: no-repeat;
  background-size: 22px 22px;
  content: ' ';
  display: block;
  height: 24px;
  opacity: 0.2;
  position: absolute;
  width: 100%;
}
.blockquote-center::before {
  background-image: url("../images/quote-l.svg");
  background-position: 0 -6px;
  border-top: 1px solid #ccc;
  top: -20px;
}
.blockquote-center::after {
  background-image: url("../images/quote-r.svg");
  background-position: 100% 8px;
  border-bottom: 1px solid #ccc;
  bottom: -20px;
}
.blockquote-center p,
.blockquote-center div {
  text-align: center;
}
.post-body .group-picture img {
  border: 0;
  margin: 0 auto;
  padding: 0 3px;
}
.group-picture-row {
  margin-bottom: 6px;
  overflow: hidden;
}
.group-picture-column {
  float: left;
  margin-bottom: 10px;
}
.post-body .label {
  display: inline;
  padding: 0 2px;
}
.post-body .label.default {
  background: #f0f0f0;
}
.post-body .label.primary {
  background: #efe6f7;
}
.post-body .label.info {
  background: #e5f2f8;
}
.post-body .label.success {
  background: #e7f4e9;
}
.post-body .label.warning {
  background: #fcf6e1;
}
.post-body .label.danger {
  background: #fae8eb;
}
.post-body .tabs {
  margin-bottom: 20px;
}
.post-body .tabs,
.tabs-comment {
  display: block;
  padding-top: 10px;
  position: relative;
}
.post-body .tabs ul.nav-tabs,
.tabs-comment ul.nav-tabs {
  display: flex;
  flex-wrap: wrap;
  margin: 0;
  margin-bottom: -1px;
  padding: 0;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs,
  .tabs-comment ul.nav-tabs {
    display: block;
    margin-bottom: 5px;
  }
}
.post-body .tabs ul.nav-tabs li.tab,
.tabs-comment ul.nav-tabs li.tab {
  background: #fff;
  border-bottom: 1px solid #ddd;
  border-left: 1px solid transparent;
  border-right: 1px solid transparent;
  border-top: 3px solid transparent;
  flex-grow: 1;
  list-style-type: none;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab,
  .tabs-comment ul.nav-tabs li.tab {
    border-bottom: 1px solid transparent;
    border-left: 3px solid transparent;
    border-right: 1px solid transparent;
    border-top: 1px solid transparent;
  }
}
.post-body .tabs ul.nav-tabs li.tab a,
.tabs-comment ul.nav-tabs li.tab a {
  border-bottom: initial;
  display: block;
  line-height: 1.8;
  outline: 0;
  padding: 0.25em 0.75em;
  text-align: center;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-out;
}
.post-body .tabs ul.nav-tabs li.tab a i,
.tabs-comment ul.nav-tabs li.tab a i {
  width: 1.285714285714286em;
}
.post-body .tabs ul.nav-tabs li.tab.active,
.tabs-comment ul.nav-tabs li.tab.active {
  border-bottom: 1px solid transparent;
  border-left: 1px solid #ddd;
  border-right: 1px solid #ddd;
  border-top: 3px solid #fc6423;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab.active,
  .tabs-comment ul.nav-tabs li.tab.active {
    border-bottom: 1px solid #ddd;
    border-left: 3px solid #fc6423;
    border-right: 1px solid #ddd;
    border-top: 1px solid #ddd;
  }
}
.post-body .tabs ul.nav-tabs li.tab.active a,
.tabs-comment ul.nav-tabs li.tab.active a {
  color: #555;
  cursor: default;
}
.post-body .tabs .tab-content .tab-pane,
.tabs-comment .tab-content .tab-pane {
  border: 1px solid #ddd;
  padding: 20px 20px 0 20px;
}
.post-body .tabs .tab-content .tab-pane:not(.active),
.tabs-comment .tab-content .tab-pane:not(.active) {
  display: none;
}
.post-body .tabs .tab-content .tab-pane.active,
.tabs-comment .tab-content .tab-pane.active {
  display: block;
}
.post-body .note {
  margin-bottom: 20px;
  padding: 15px;
  position: relative;
  border: 1px solid #eee;
  border-left-width: 5px;
  border-radius: 3px;
}
.post-body .note h2,
.post-body .note h3,
.post-body .note h4,
.post-body .note h5,
.post-body .note h6 {
  margin-top: 0;
  border-bottom: initial;
  margin-bottom: 0;
  padding-top: 0;
}
.post-body .note p:first-child,
.post-body .note ul:first-child,
.post-body .note ol:first-child,
.post-body .note table:first-child,
.post-body .note pre:first-child,
.post-body .note blockquote:first-child,
.post-body .note img:first-child {
  margin-top: 0;
}
.post-body .note p:last-child,
.post-body .note ul:last-child,
.post-body .note ol:last-child,
.post-body .note table:last-child,
.post-body .note pre:last-child,
.post-body .note blockquote:last-child,
.post-body .note img:last-child {
  margin-bottom: 0;
}
.post-body .note.default {
  border-left-color: #777;
}
.post-body .note.default h2,
.post-body .note.default h3,
.post-body .note.default h4,
.post-body .note.default h5,
.post-body .note.default h6 {
  color: #777;
}
.post-body .note.primary {
  border-left-color: #6f42c1;
}
.post-body .note.primary h2,
.post-body .note.primary h3,
.post-body .note.primary h4,
.post-body .note.primary h5,
.post-body .note.primary h6 {
  color: #6f42c1;
}
.post-body .note.info {
  border-left-color: #428bca;
}
.post-body .note.info h2,
.post-body .note.info h3,
.post-body .note.info h4,
.post-body .note.info h5,
.post-body .note.info h6 {
  color: #428bca;
}
.post-body .note.success {
  border-left-color: #5cb85c;
}
.post-body .note.success h2,
.post-body .note.success h3,
.post-body .note.success h4,
.post-body .note.success h5,
.post-body .note.success h6 {
  color: #5cb85c;
}
.post-body .note.warning {
  border-left-color: #f0ad4e;
}
.post-body .note.warning h2,
.post-body .note.warning h3,
.post-body .note.warning h4,
.post-body .note.warning h5,
.post-body .note.warning h6 {
  color: #f0ad4e;
}
.post-body .note.danger {
  border-left-color: #d9534f;
}
.post-body .note.danger h2,
.post-body .note.danger h3,
.post-body .note.danger h4,
.post-body .note.danger h5,
.post-body .note.danger h6 {
  color: #d9534f;
}
.pagination .prev,
.pagination .next,
.pagination .page-number,
.pagination .space {
  display: inline-block;
  margin: 0 10px;
  padding: 0 11px;
  position: relative;
  top: -1px;
}
@media (max-width: 767px) {
  .pagination .prev,
  .pagination .next,
  .pagination .page-number,
  .pagination .space {
    margin: 0 5px;
  }
}
.pagination {
  border-top: 1px solid #eee;
  margin: 120px 0 0;
  text-align: center;
}
.pagination .prev,
.pagination .next,
.pagination .page-number {
  border-bottom: 0;
  border-top: 1px solid #eee;
  transition-property: border-color;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.pagination .prev:hover,
.pagination .next:hover,
.pagination .page-number:hover {
  border-top-color: #222;
}
.pagination .space {
  margin: 0;
  padding: 0;
}
.pagination .prev {
  margin-left: 0;
}
.pagination .next {
  margin-right: 0;
}
.pagination .page-number.current,
.algolia-pagination .current .page-number {
  background: #ccc;
  border-top-color: #ccc;
  color: #fff;
}
@media (max-width: 767px) {
  .pagination {
    border-top: none;
  }
  .pagination .prev,
  .pagination .next,
  .pagination .page-number {
    border-bottom: 1px solid #eee;
    border-top: 0;
    margin-bottom: 10px;
    padding: 0 10px;
  }
  .pagination .prev:hover,
  .pagination .next:hover,
  .pagination .page-number:hover {
    border-bottom-color: #222;
  }
}
.comments {
  margin: 60px 20px 0;
  overflow: hidden;
}
.comment-button-group {
  display: flex;
  flex-wrap: wrap-reverse;
  justify-content: center;
  margin: 1em 0;
}
.comment-button-group .comment-button {
  margin: 0.1em 0.2em;
}
.comment-button-group .comment-button.active {
  background: #222;
  border-color: #222;
  color: #fff;
}
.comment-position {
  display: none;
}
.comment-position.active {
  display: block;
}
.tabs-comment {
  background: #fff;
  margin-top: 4em;
  padding-top: 0;
}
.tabs-comment .comments {
  border: 0;
  box-shadow: none;
  margin-top: 0;
  padding-top: 0;
}
.container {
  min-height: 100%;
  position: relative;
}
.main-inner {
  margin: 0 auto;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .main-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .main-inner {
    width: 73%;
  }
}
.header {
  background: transparent;
}
.header-inner {
  margin: 0 auto;
  position: relative;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .header-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .header-inner {
    width: 73%;
  }
}
.headband {
  background: #222;
  height: 3px;
}
.site-meta {
  margin: 0;
  text-align: center;
}
@media (max-width: 767px) {
  .site-meta {
    text-align: center;
  }
}
.brand {
  background: #222;
  border-bottom: none;
  color: #fff;
  display: inline-block;
  line-height: 1.375em;
  padding: 0 40px;
  position: relative;
}
.brand:hover {
  color: #fff;
}
.site-title {
  display: inline-block;
  font-family: 'Monda', "PingFang SC", "Microsoft YaHei", sans-serif;
  font-size: 1.375em;
  font-weight: normal;
  line-height: 1.5;
  vertical-align: top;
}
.site-subtitle {
  color: #ddd;
  font-size: 0.8125em;
  margin-top: 10px;
}
.use-motion .brand {
  opacity: 0;
}
.use-motion .site-title,
.use-motion .site-subtitle,
.use-motion .custom-logo-image {
  opacity: 0;
  position: relative;
  top: -10px;
}
.site-nav-toggle {
  display: none;
  left: 10px;
  position: absolute;
}
@media (max-width: 767px) {
  .site-nav-toggle {
    display: block;
  }
}
.site-nav-toggle .toggle {
  background: transparent;
  border: 0;
  margin-top: 2px;
  padding: 10px;
  width: 22px;
}
.site-nav-toggle .toggle .toggle-line {
  background: #555;
  border-radius: 1px;
}
.site-nav {
  display: block;
}
@media (max-width: 767px) {
  .site-nav {
    border-top: 1px solid #ddd;
    clear: both;
    display: none;
    margin: 0 -10px;
    padding: 0 10px;
  }
}
.site-nav.site-nav-on {
  display: block;
}
.menu {
  margin-top: 20px;
  padding-left: 0;
  text-align: center;
}
.menu-item {
  display: inline-block;
  list-style: none;
  margin: 0 10px;
}
@media (max-width: 767px) {
  .menu-item {
    margin-top: 10px;
  }
}
.menu-item a,
.menu-item span.exturl {
  border-bottom: 0;
  display: block;
  font-size: 0.8125em;
  transition-property: border-color;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
@media (hover: none) {
  .menu-item a:hover,
  .menu-item span.exturl:hover {
    border-bottom-color: transparent !important;
  }
}
.menu-item .fa {
  margin-right: 8px;
}
.menu-item .badge {
  display: inline-block;
  font-weight: 700;
  line-height: 1;
  margin-left: 0.35em;
  margin-top: 0.35em;
  text-align: center;
  white-space: nowrap;
}
@media (max-width: 767px) {
  .menu-item .badge {
    float: right;
    margin-left: 0;
  }
}
.use-motion .menu-item {
  opacity: 0;
}
.github-corner :hover .octo-arm {
  animation: octocat-wave 560ms ease-in-out;
}
.github-corner svg {
  border: 0;
  color: #fff;
  fill: #222;
  position: absolute;
  right: 0;
  top: 0;
  z-index: 1000;
}
@media (max-width: 991px) {
  .github-corner svg {
    color: #222;
    fill: #fff;
  }
  .github-corner .github-corner:hover .octo-arm {
    animation: none;
  }
  .github-corner .github-corner .octo-arm {
    animation: octocat-wave 560ms ease-in-out;
  }
}
@-moz-keyframes octocat-wave {
  0%, 100% {
    transform: rotate(0);
  }
  20%, 60% {
    transform: rotate(-25deg);
  }
  40%, 80% {
    transform: rotate(10deg);
  }
}
@-webkit-keyframes octocat-wave {
  0%, 100% {
    transform: rotate(0);
  }
  20%, 60% {
    transform: rotate(-25deg);
  }
  40%, 80% {
    transform: rotate(10deg);
  }
}
@-o-keyframes octocat-wave {
  0%, 100% {
    transform: rotate(0);
  }
  20%, 60% {
    transform: rotate(-25deg);
  }
  40%, 80% {
    transform: rotate(10deg);
  }
}
@keyframes octocat-wave {
  0%, 100% {
    transform: rotate(0);
  }
  20%, 60% {
    transform: rotate(-25deg);
  }
  40%, 80% {
    transform: rotate(10deg);
  }
}
.sidebar {
  background: #222;
  bottom: 0;
  box-shadow: inset 0 2px 6px #000;
  position: fixed;
  top: 0;
  z-index: 1200;
}
.sidebar a,
.sidebar span.exturl {
  border-bottom-color: #555;
  color: #999;
}
.sidebar a:hover,
.sidebar span.exturl:hover {
  border-bottom-color: #eee;
  color: #eee;
}
@media (max-width: 991px) {
  .sidebar {
    display: none;
  }
}
.sidebar-inner {
  color: #999;
  padding: 20px 10px;
  text-align: center;
}
.site-overview-wrap {
  overflow-x: hidden;
  overflow-y: auto;
}
.cc-license {
  margin-top: 10px;
  text-align: center;
}
.cc-license .cc-opacity {
  border-bottom: none;
  opacity: 0.7;
}
.cc-license .cc-opacity:hover {
  opacity: 0.9;
}
.cc-license img {
  display: inline-block;
}
.site-author-image {
  border: 1px solid #eee;
  display: block;
  height: auto;
  margin: 0 auto;
  max-width: 120px;
  padding: 2px;
  border-radius: 50%;
}
.site-author-name {
  color: #222;
  font-weight: 600;
  margin: 0;
  text-align: center;
}
.site-description {
  color: #999;
  font-size: 0.8125em;
  margin-top: 0;
  text-align: center;
}
.links-of-author {
  margin-top: 15px;
}
.links-of-author a,
.links-of-author span.exturl {
  border-bottom-color: #555;
  display: inline-block;
  font-size: 0.8125em;
  margin-bottom: 10px;
  margin-right: 10px;
  vertical-align: middle;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.links-of-author a::before,
.links-of-author span.exturl::before {
  background: #ffffed;
  border-radius: 50%;
  content: ' ';
  display: inline-block;
  height: 4px;
  margin-right: 3px;
  vertical-align: middle;
  width: 4px;
}
.feed-link,
.chat {
  margin-top: 15px;
}
.feed-link a,
.chat a {
  border: 1px solid #fc6423;
  border-radius: 4px;
  color: #fc6423;
  display: inline-block;
  padding: 0 15px;
}
.feed-link a .fa,
.chat a .fa {
  margin-right: 5px;
}
.feed-link a:hover,
.chat a:hover {
  background: #fc6423;
  border: 1px solid #fc6423;
  color: #fff;
}
.feed-link a:hover .fa,
.chat a:hover .fa {
  color: #fff;
}
.links-of-blogroll {
  font-size: 0.8125em;
  margin-top: 10px;
}
.links-of-blogroll-title {
  font-size: 0.875em;
  font-weight: 600;
  margin-top: 0;
}
.links-of-blogroll-list {
  list-style: none;
  margin: 0;
  padding: 0;
}
.links-of-blogroll-item {
  padding: 2px 10px;
}
.links-of-blogroll-item a,
.links-of-blogroll-item span.exturl {
  box-sizing: border-box;
  display: inline-block;
  max-width: 280px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
#sidebar-dimmer {
  display: none;
}
@media (max-width: 767px) {
  #sidebar-dimmer {
    background: #000;
    display: block;
    height: 100%;
    left: 100%;
    opacity: 0;
    position: fixed;
    top: 0;
    width: 100%;
    z-index: 1100;
  }
  .sidebar-active + #sidebar-dimmer {
    opacity: 0.7;
    transform: translateX(-100%);
    transition: opacity 0.5s;
  }
}
.sidebar-nav {
  margin: 0;
  padding-bottom: 20px;
  padding-left: 0;
}
.sidebar-nav li {
  border-bottom: 1px solid transparent;
  color: #555;
  cursor: pointer;
  display: inline-block;
  font-size: 0.875em;
}
.sidebar-nav li.sidebar-nav-overview {
  margin-left: 10px;
}
.sidebar-nav li:hover {
  color: #fc6423;
}
.sidebar-nav .sidebar-nav-active {
  border-bottom-color: #fc6423;
  color: #fc6423;
}
.sidebar-nav .sidebar-nav-active:hover {
  color: #fc6423;
}
.sidebar-panel {
  display: none;
}
.sidebar-panel-active {
  display: block;
}
.sidebar-toggle {
  background: #222;
  bottom: 45px;
  cursor: pointer;
  height: 14px;
  left: 30px;
  padding: 5px;
  position: fixed;
  width: 14px;
  z-index: 1300;
}
@media (max-width: 991px) {
  .sidebar-toggle {
    left: 20px;
    opacity: 0.8;
    display: none;
  }
}
.sidebar-toggle:hover .toggle-line {
  background: #fc6423;
}
.post-toc-wrap {
  overflow-x: hidden;
  overflow-y: auto;
}
.post-toc {
  font-size: 0.875em;
}
.post-toc ol {
  list-style: none;
  margin: 0;
  padding: 0 2px 5px 10px;
  text-align: left;
}
.post-toc ol > ol {
  padding-left: 0;
}
.post-toc ol a {
  border-bottom-color: #ccc;
  color: #666;
  transition-property: all;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.post-toc ol a:hover {
  border-bottom-color: #000;
  color: #000;
}
.post-toc .nav-item {
  line-height: 1.8;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.post-toc .nav .nav-child {
  display: none;
}
.post-toc .nav .active > .nav-child {
  display: block;
}
.post-toc .nav .active-current > .nav-child {
  display: block;
}
.post-toc .nav .active-current > .nav-child > .nav-item {
  display: block;
}
.post-toc .nav .active > a {
  border-bottom-color: #fc6423;
  color: #fc6423;
}
.post-toc .nav .active-current > a {
  color: #fc6423;
}
.post-toc .nav .active-current > a:hover {
  color: #fc6423;
}
.site-state {
  display: flex;
  justify-content: center;
  line-height: 1.4;
  margin-top: 10px;
  overflow: hidden;
  text-align: center;
  white-space: nowrap;
}
.site-state-item {
  padding: 0 15px;
}
.site-state-item:not(:first-child) {
  border-left: 1px solid #eee;
}
.site-state-item a {
  border-bottom: none;
}
.site-state-item-count {
  color: inherit;
  display: block;
  font-size: 1em;
  font-weight: 600;
  text-align: center;
}
.site-state-item-name {
  color: #999;
  font-size: 0.8125em;
}
.footer {
  color: #999;
  font-size: 0.875em;
  padding: 20px 0;
}
.footer.footer-fixed {
  bottom: 0;
  left: 0;
  position: absolute;
  right: 0;
}
.footer img {
  border: 0;
}
.footer-inner {
  box-sizing: border-box;
  margin: 0 auto;
  text-align: center;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .footer-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .footer-inner {
    width: 73%;
  }
}
.with-love {
  color: red;
  display: inline-block;
  margin: 0 5px;
  animation: iconAnimate 1.33s ease-in-out infinite;
}
.powered-by,
.theme-info {
  display: inline-block;
}
@-moz-keyframes iconAnimate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
@-webkit-keyframes iconAnimate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
@-o-keyframes iconAnimate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
@keyframes iconAnimate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
.back-to-top {
  background: #eee;
  font-size: 12px;
  margin: 8px -10px -20px;
  opacity: 0;
  text-align: center;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.back-to-top.back-to-top-on {
  cursor: pointer;
  opacity: 0.6;
}
.back-to-top.back-to-top-on:hover {
  opacity: 0.8;
}
.post-body {
  font-family: 'Monda', "PingFang SC", "Microsoft YaHei", sans-serif;
  overflow-wrap: break-word;
  word-wrap: break-word;
}
@media (min-width: 1200px) {
  .post-body {
    font-size: 1.125em;
  }
}
.post-body span.exturl .fa {
  font-size: 0.875em;
  margin-left: 4px;
}
.post-body .image-caption,
.post-body .figure .caption {
  color: #999;
  font-size: 0.875em;
  font-weight: bold;
  line-height: 1;
  margin: -20px auto 15px;
  text-align: center;
}
.post-sticky-flag {
  display: inline-block;
  transform: rotate(30deg);
}
.post-button {
  margin-top: 40px;
  text-align: center;
}
.use-motion .post-block,
.use-motion .pagination,
.use-motion .comments {
  opacity: 0;
}
.use-motion .post-header {
  opacity: 0;
}
.use-motion .post-body {
  opacity: 0;
}
.use-motion .collection-header {
  opacity: 0;
}
.posts-collapse {
  margin-left: 55px;
  position: relative;
}
@media (max-width: 767px) {
  .posts-collapse {
    margin-left: 20px;
    margin-right: 20px;
  }
}
.posts-collapse .collection-title {
  font-size: 1.125em;
  position: relative;
}
.posts-collapse .collection-title::before {
  background: #999;
  border: 1px solid #fff;
  border-radius: 50%;
  content: ' ';
  height: 10px;
  left: 0;
  margin-left: -6px;
  margin-top: -4px;
  position: absolute;
  top: 50%;
  width: 10px;
}
.posts-collapse .collection-year {
  margin: 60px 0;
  position: relative;
}
.posts-collapse .collection-year::before {
  background: #bbb;
  border-radius: 50%;
  content: ' ';
  height: 8px;
  left: 0;
  margin-left: -4px;
  margin-top: -4px;
  position: absolute;
  top: 50%;
  width: 8px;
}
.posts-collapse .collection-header {
  display: inline-block;
  margin: 0 0 0 20px;
}
.posts-collapse .collection-header small {
  color: #bbb;
  margin-left: 5px;
}
.posts-collapse .post-header {
  border-bottom: 1px dashed #ccc;
  margin: 30px 0;
  padding-left: 15px;
  position: relative;
  transition-property: border;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.posts-collapse .post-header::before {
  background: #bbb;
  border: 1px solid #fff;
  border-radius: 50%;
  content: ' ';
  height: 6px;
  left: 0;
  margin-left: -4px;
  position: absolute;
  top: 0.75em;
  transition-property: background;
  width: 6px;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.posts-collapse .post-header:hover {
  border-bottom-color: #666;
}
.posts-collapse .post-header:hover::before {
  background: #222;
}
.posts-collapse .post-meta {
  display: inline;
  font-size: 0.75em;
  margin-right: 10px;
}
.posts-collapse .post-title {
  display: inline;
  font-size: 1em;
  font-weight: normal;
  margin-bottom: 0;
  margin-top: 0;
}
.posts-collapse .post-title a,
.posts-collapse .post-title span.exturl {
  border-bottom: none;
  color: #666;
}
.posts-collapse::before {
  background: #f5f5f5;
  content: ' ';
  height: 100%;
  left: 0;
  margin-left: -2px;
  position: absolute;
  top: 1.25em;
  width: 4px;
}
.posts-collapse .fa-external-link {
  font-size: 0.875em;
  margin-left: 5px;
}
.post-eof {
  background: #ccc;
  height: 1px;
  margin: 80px auto 60px;
  text-align: center;
  width: 8%;
}
.post-block:last-child .post-eof {
  display: none;
}
.posts-expand {
  padding-top: 40px;
}
@media (max-width: 767px) {
  .posts-expand {
    margin: 0 20px;
  }
}
@media (min-width: 992px) {
  .post-body {
    text-align: left;
  }
}
@media (max-width: 991px) {
  .post-body {
    text-align: left;
  }
}
.post-body h2,
.post-body h3,
.post-body h4,
.post-body h5,
.post-body h6 {
  padding-top: 10px;
}
.post-body h2 .header-anchor,
.post-body h3 .header-anchor,
.post-body h4 .header-anchor,
.post-body h5 .header-anchor,
.post-body h6 .header-anchor {
  border-bottom-style: none;
  color: #ccc;
  float: right;
  margin-left: 10px;
  visibility: hidden;
}
.post-body h2 .header-anchor:hover,
.post-body h3 .header-anchor:hover,
.post-body h4 .header-anchor:hover,
.post-body h5 .header-anchor:hover,
.post-body h6 .header-anchor:hover {
  color: inherit;
}
.post-body h2:hover .header-anchor,
.post-body h3:hover .header-anchor,
.post-body h4:hover .header-anchor,
.post-body h5:hover .header-anchor,
.post-body h6:hover .header-anchor {
  visibility: visible;
}
.post-body img {
  border: 1px solid #ddd;
  box-sizing: border-box;
  padding: 3px;
}
@media (max-width: 767px) {
  .post-body img {
    padding: initial;
  }
}
.post-body iframe,
.post-body img,
.post-body video {
  margin-bottom: 20px;
}
.post-body .video-container {
  height: 0;
  margin-bottom: 20px;
  overflow: hidden;
  padding-top: 75%;
  position: relative;
  width: 100%;
}
.post-body .video-container iframe,
.post-body .video-container object,
.post-body .video-container embed {
  height: 100%;
  left: 0;
  margin: 0;
  position: absolute;
  top: 0;
  width: 100%;
}
.post-gallery {
  border-collapse: separate;
  display: table;
  table-layout: fixed;
  width: 100%;
}
.post-gallery .post-gallery-img {
  border: 0;
  display: table-cell;
  text-align: center;
  vertical-align: middle;
}
.post-gallery .post-gallery-img img {
  border: 0;
  max-height: 100%;
  max-width: 100%;
}
.post-gallery-row {
  display: table-row;
}
.posts-expand .post-header {
  font-size: 1.125em;
}
.posts-expand .post-title {
  font-weight: 400;
  margin: initial;
  text-align: center;
  overflow-wrap: break-word;
  word-wrap: break-word;
}
.posts-expand .post-title-link {
  border-bottom: none;
  color: #555;
  display: inline-block;
  position: relative;
  vertical-align: top;
}
.posts-expand .post-title-link::before {
  background: #000;
  bottom: 0;
  content: '';
  height: 2px;
  left: 0;
  position: absolute;
  transform: scaleX(0);
  visibility: hidden;
  width: 100%;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.posts-expand .post-title-link:hover::before {
  transform: scaleX(1);
  visibility: visible;
}
.posts-expand .post-title-link .fa {
  font-size: 0.875em;
  margin-left: 5px;
}
.posts-expand .post-meta {
  color: #999;
  font-family: 'Monda', "PingFang SC", "Microsoft YaHei", sans-serif;
  font-size: 0.75em;
  margin: 3px 0 60px 0;
  text-align: center;
}
.posts-expand .post-meta .post-description {
  font-size: 0.875em;
  margin-top: 2px;
}
.posts-expand .post-meta time {
  border-bottom: 1px dashed #999;
  cursor: pointer;
}
.post-meta .post-meta-item + .post-meta-item::before {
  content: '|';
  margin: 0 0.5em;
}
.post-meta-divider {
  margin: 0 0.5em;
}
.post-meta-item-icon {
  margin-right: 3px;
}
@media (max-width: 991px) {
  .post-meta-item-icon {
    display: inline-block;
  }
}
@media (max-width: 991px) {
  .post-meta-item-text {
    display: none;
  }
}
.post-nav {
  border-top: 1px solid #eee;
  display: table;
  margin-top: 15px;
  width: 100%;
}
.post-nav-divider {
  display: table-cell;
  width: 10%;
}
.post-nav-item {
  display: table-cell;
  padding: 10px 0 0 0;
  vertical-align: top;
  width: 45%;
}
.post-nav-item a {
  border-bottom: none;
  color: #555;
  display: block;
  font-size: 0.875em;
  line-height: 1.6;
  position: relative;
}
.post-nav-item a:hover {
  border-bottom: none;
  color: #222;
}
.post-nav-item a:active {
  top: 2px;
}
.post-nav-item .fa {
  font-size: 0.75em;
  margin-right: 5px;
}
.post-nav-next a {
  padding-left: 5px;
}
.post-nav-prev {
  text-align: right;
}
.post-nav-prev a {
  padding-right: 5px;
}
.post-nav-prev .fa {
  margin-left: 5px;
}
.rtl.post-body p,
.rtl.post-body a,
.rtl.post-body h1,
.rtl.post-body h2,
.rtl.post-body h3,
.rtl.post-body h4,
.rtl.post-body h5,
.rtl.post-body h6,
.rtl.post-body li,
.rtl.post-body ul,
.rtl.post-body ol {
  direction: rtl;
  font-family: UKIJ Ekran;
}
.rtl.post-title {
  font-family: UKIJ Ekran;
}
.post-tags {
  margin-top: 40px;
  text-align: center;
}
.post-tags a {
  display: inline-block;
  font-size: 0.8125em;
}
.post-tags a:not(:last-child) {
  margin-right: 10px;
}
.post-widgets {
  border-top: 1px solid #eee;
  margin-top: 15px;
  text-align: center;
}
.wp_rating {
  height: 20px;
  line-height: 20px;
  margin-top: 10px;
  padding-top: 6px;
  text-align: center;
}
.social-like {
  display: flex;
  font-size: 0.875em;
  justify-content: center;
  text-align: center;
}
.reward-container {
  margin: 20px auto;
  padding: 10px 0;
  text-align: center;
  width: 90%;
}
.reward-container button {
  background: #ff2a2a;
  border: 0;
  border-radius: 5px;
  color: #fff;
  cursor: pointer;
  line-height: 2;
  outline: 0;
  padding: 0 15px;
  vertical-align: text-top;
}
.reward-container button:hover {
  background: #f55;
}
#qr {
  padding-top: 20px;
}
#qr a {
  border: 0;
}
#qr img {
  display: inline-block;
  margin: 0.8em 2em 0 2em;
  max-width: 100%;
  width: 180px;
}
#qr p {
  text-align: center;
}
.post-copyright {
  background: #f5f5f5;
  border-left: 3px solid #ff2a2a;
  list-style: none;
  margin: 2em 0 0;
  padding: 0.5em 1em;
}
.category-all-page .category-all-title {
  text-align: center;
}
.category-all-page .category-all {
  margin-top: 20px;
}
.category-all-page .category-list {
  list-style: none;
  margin: 0;
  padding: 0;
}
.category-all-page .category-list-item {
  margin: 5px 10px;
}
.category-all-page .category-list-count {
  color: #bbb;
}
.category-all-page .category-list-count::before {
  content: ' (';
  display: inline;
}
.category-all-page .category-list-count::after {
  content: ') ';
  display: inline;
}
.category-all-page .category-list-child {
  padding-left: 10px;
}
.event-list {
  padding: 0;
}
.event-list hr {
  background: #222;
  margin: 20px 0 45px 0;
}
.event-list hr::after {
  background: #222;
  color: #fff;
  content: 'NOW';
  display: inline-block;
  font-weight: bold;
  padding: 0 5px;
  text-align: right;
}
.event-list .event {
  background: #222;
  margin: 20px 0;
  min-height: 40px;
  padding: 15px 0 15px 10px;
}
.event-list .event .event-summary {
  color: #fff;
  margin: 0;
  padding-bottom: 3px;
}
.event-list .event .event-summary::before {
  animation: dot-flash 1s alternate infinite ease-in-out;
  color: #fff;
  content: '\f111';
  display: inline-block;
  font-family: 'FontAwesome';
  font-size: 10px;
  margin-right: 25px;
  vertical-align: middle;
}
.event-list .event .event-relative-time {
  color: #bbb;
  display: inline-block;
  font-size: 12px;
  font-weight: 400;
  padding-left: 12px;
}
.event-list .event .event-details {
  color: #fff;
  display: block;
  line-height: 18px;
  margin-left: 56px;
  padding-bottom: 6px;
  padding-top: 3px;
  text-indent: -24px;
}
.event-list .event .event-details::before {
  color: #fff;
  display: inline-block;
  font-family: 'FontAwesome';
  margin-right: 9px;
  text-align: center;
  text-indent: 0;
  width: 14px;
}
.event-list .event .event-details.event-location::before {
  content: '\f041';
}
.event-list .event .event-details.event-duration::before {
  content: '\f017';
}
.event-list .event-past {
  background: #f5f5f5;
}
.event-list .event-past .event-summary,
.event-list .event-past .event-details {
  color: #bbb;
  opacity: 0.9;
}
.event-list .event-past .event-summary::before,
.event-list .event-past .event-details::before {
  animation: none;
  color: #bbb;
}
@-moz-keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}
@-webkit-keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}
@-o-keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}
@keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}
ul.breadcrumb {
  font-size: 0.75em;
  list-style: none;
  margin: 1em 0;
  padding: 0 2em;
  text-align: center;
}
ul.breadcrumb li {
  display: inline;
}
ul.breadcrumb li + li::before {
  content: '/\00a0';
  font-weight: normal;
  padding: 0.5em;
}
ul.breadcrumb li + li:last-child {
  font-weight: bold;
}
.tag-cloud {
  text-align: center;
}
.tag-cloud a {
  display: inline-block;
  margin: 10px;
}
.tag-cloud a:hover {
  color: #222 !important;
}
.gt-header a,
.gt-comments a,
.gt-popup a {
  border-bottom: none;
}
.gt-container .gt-popup .gt-action.is--active::before {
  top: 0.7em;
}
.search-pop-overlay {
  background: rgba(0,0,0,0.3);
  display: none;
  height: 100%;
  left: 0;
  overflow: hidden;
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 1400;
}
.search-popup {
  background: #fff;
  border-radius: 5px;
  color: #333;
  display: none;
  height: 80%;
  left: 50%;
  margin-left: -350px;
  padding: 0;
  position: fixed;
  top: 10%;
  width: 700px;
  z-index: 1500;
}
@media (max-width: 767px) {
  .search-popup {
    border-radius: 0;
    height: 100%;
    left: 0;
    margin: 0;
    padding: 0;
    top: 0;
    width: 100%;
  }
}
.search-popup .search-icon,
.search-popup .popup-btn-close {
  color: #999;
  display: inline-block;
  font-size: 18px;
  height: 36px;
  padding-left: 10px;
  padding-right: 10px;
  width: 18px;
}
.search-popup .popup-btn-close {
  border-left: 1px solid #eee;
  cursor: pointer;
  float: right;
}
.search-popup .popup-btn-close:hover .fa {
  color: #222;
}
.search-popup .search-header {
  background: #f5f5f5;
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
  padding: 5px;
}
.search-input {
  display: inline-block;
  width: calc(90% - 30px);
}
.search-input input {
  background: transparent;
  border: 0;
  outline: 0;
  padding: 5px 0;
  width: 100%;
}
.search-input .ais-search-box--magnifier svg,
.search-input .ais-search-box--reset svg {
  display: none;
}
.algolia-powered {
  float: right;
}
.algolia-powered img {
  display: inline-block;
  height: 18px;
  vertical-align: middle;
}
.algolia-results {
  height: calc(100% - 55px);
  overflow: auto;
  padding: 5px 30px;
  position: relative;
}
.algolia-results hr {
  margin: 10px 0;
}
.algolia-results .highlight {
  color: #f00;
  font-size: inherit;
  font-style: normal;
  margin: 0;
  padding: 0 2px;
}
.algolia-hits {
  margin-top: 20px;
}
.algolia-hit-item {
  margin: 15px 0;
}
.algolia-hit-item-link {
  border-bottom: 1px dashed #ccc;
  display: block;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.algolia-pagination .pagination {
  border-top: none;
  margin: 40px 0;
  opacity: 1;
  padding: 0;
}
.algolia-pagination .pagination-item {
  display: inline-block;
}
.algolia-pagination .page-number {
  border-top: none;
}
.algolia-pagination .page-number:hover {
  border-bottom: 1px solid #222;
}
.algolia-pagination .disabled-item {
  visibility: hidden;
}
.header {
  margin: 0 auto;
  position: relative;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .header {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .header {
    width: 73%;
  }
}
@media (max-width: 991px) {
  .header {
    width: auto;
  }
}
.header-inner {
  background: #fff;
  border-radius: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12);
  overflow: hidden;
  padding: 0;
  position: absolute;
  top: 0;
  width: 240px;
}
@media (min-width: 1200px) {
  .header-inner {
    width: 240px;
  }
}
@media (max-width: 991px) {
  .header-inner {
    border-radius: initial;
    position: relative;
    width: auto;
  }
}
.main::before,
.main::after {
  content: ' ';
  display: table;
}
.main::after {
  clear: both;
}
@media (max-width: 991px) {
  .main-inner {
    width: auto;
  }
}
.content-wrap {
  background: #fff;
  border-radius: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12);
  box-sizing: border-box;
  float: right;
  padding: 40px;
  width: calc(100% - 252px);
}
@media (max-width: 991px) {
  .content-wrap {
    border-radius: initial;
    padding: 20px;
    width: 100%;
  }
}
.sidebar {
  background: #eee;
  box-shadow: none;
  float: left;
  position: static;
  width: 240px;
}
@media (max-width: 991px) {
  .sidebar {
    display: none;
  }
}
.sidebar-toggle {
  display: none;
}
.footer-inner {
  padding-left: 260px;
}
.back-to-top {
  left: auto;
  right: 30px;
}
@media (max-width: 991px) {
  .back-to-top {
    right: 20px;
  }
}
@media (max-width: 991px) {
  .footer-inner {
    padding-left: 0;
    padding-right: 0;
    width: auto;
  }
}
.site-brand-container {
  position: relative;
}
.site-meta {
  background: #222;
  color: #fff;
  padding: 20px 0;
}
@media (max-width: 991px) {
  .site-meta {
    box-shadow: 0 0 16px rgba(0,0,0,0.5);
  }
}
.brand {
  background: none;
  padding: 0;
}
.brand:hover {
  color: #fff;
}
.site-subtitle {
  font-weight: initial;
  margin: 10px 10px 0;
}
.custom-logo-image {
  margin-top: 20px;
}
@media (max-width: 991px) {
  .custom-logo-image {
    display: none;
  }
}
.site-nav-toggle {
  left: 20px;
  top: 50%;
  transform: translateY(-50%);
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav-toggle {
    display: block;
  }
}
.site-nav-toggle .toggle .toggle-line {
  background: #fff;
}
.site-nav {
  border-top: none;
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav {
    display: none;
  }
}
.menu-item-active a,
.menu .menu-item a:hover,
.menu .menu-item span.exturl:hover {
  background: #f5f5f5;
}
.menu-item-active a::after,
.menu .menu-item a:hover::after,
.menu .menu-item span.exturl:hover::after {
  background: #bbb;
  border-radius: 50%;
  content: ' ';
  height: 6px;
  margin-top: -3px;
  position: absolute;
  right: 15px;
  top: 50%;
  width: 6px;
}
.menu .menu-item {
  display: block;
  margin: 0;
}
.menu .menu-item a,
.menu .menu-item span.exturl {
  padding: 5px 20px;
  position: relative;
  text-align: left;
  transition-property: background-color;
}
.menu .menu-item .badge {
  background: #ccc;
  border-radius: 10px;
  color: #fff;
  float: right;
  padding: 2px 5px;
  text-shadow: 1px 1px 0 rgba(0,0,0,0.1);
  vertical-align: middle;
}
.sub-menu {
  background: #fff;
  border-bottom: 1px solid #ddd;
  margin: 0;
  padding: 6px 0;
}
.sub-menu .menu-item {
  display: inline-block;
}
.sub-menu .menu-item a,
.sub-menu .menu-item span.exturl {
  margin: 5px 10px;
  padding: initial;
}
.sub-menu .menu-item a:hover,
.sub-menu .menu-item span.exturl:hover {
  background: initial;
  color: #fc6423;
}
.sub-menu .menu-item a::after,
.sub-menu .menu-item span.exturl::after {
  content: initial !important;
}
.sub-menu .menu-item-active a {
  background: #fff;
  border-bottom-color: #fc6423;
  color: #fc6423;
}
.sub-menu .menu-item-active a:hover {
  background: #fff;
  border-bottom-color: #fc6423;
}
.sidebar {
  bottom: auto;
  right: auto;
}
.sidebar a,
.sidebar span.exturl {
  color: #555;
}
.sidebar a:hover,
.sidebar span.exturl:hover {
  border-bottom-color: #222;
  color: #222;
}
.sidebar-inner {
  background: #fff;
  border-radius: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12), 0 -1px 0.5px 0 rgba(0,0,0,0.09);
  box-sizing: border-box;
  color: #555;
  width: 240px;
  opacity: 0;
}
.sidebar-inner.affix {
  position: fixed;
  top: 12px;
}
.sidebar-inner.affix-bottom {
  position: absolute;
}
.site-state-item {
  padding: 0 10px;
}
.feed-link,
.chat {
  border-bottom: 1px dotted #ccc;
  border-top: 1px dotted #ccc;
  margin-top: 10px;
  text-align: center;
}
.feed-link a,
.chat a {
  border: 0;
  color: #fc6423;
  display: block;
}
.feed-link a:hover,
.chat a:hover {
  background: none;
  border: 0;
  color: #e34603;
}
.feed-link a:hover .fa,
.chat a:hover .fa {
  color: #e34603;
}
.links-of-author {
  display: flex;
  flex-wrap: wrap;
  margin-top: 10px;
  justify-content: center;
}
.links-of-author-item {
  margin: 5px 0 0;
}
.links-of-author-item a,
.links-of-author-item span.exturl {
  box-sizing: border-box;
  display: inline-block;
  margin-bottom: 0;
  margin-right: 0;
  max-width: 216px;
  overflow: hidden;
  padding: 0 5px;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.links-of-author-item a,
.links-of-author-item span.exturl {
  border-bottom: none;
  display: block;
  text-decoration: none;
}
.links-of-author-item a::before,
.links-of-author-item span.exturl::before {
  display: none;
}
.links-of-author-item a:hover,
.links-of-author-item span.exturl:hover {
  background: #eee;
  border-radius: 4px;
}
.links-of-author-item .fa {
  margin-right: 2px;
}
.links-of-blogroll-item {
  padding: 0;
}
.content-wrap {
  background: initial;
  box-shadow: initial;
  padding: initial;
}
.post-block {
  background: #fff;
  border-radius: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12);
  padding: 40px;
}
.post-block + .post-block {
  border-radius: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12), 0 -1px 0.5px 0 rgba(0,0,0,0.09);
  margin-top: 12px;
}
.comments {
  background: #fff;
  border-radius: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12), 0 -1px 0.5px 0 rgba(0,0,0,0.09);
  margin: auto;
  margin-top: 12px;
  padding: 40px;
}
.tabs-comment {
  margin-top: 1em;
}
.posts-expand {
  padding-top: initial;
}
.post-nav-divider {
  width: 4%;
}
.post-nav-item {
  width: 48%;
}
.post-eof {
  display: none;
}
.pagination {
  background: #fff;
  border-radius: initial;
  border-top: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12), 0 -1px 0.5px 0 rgba(0,0,0,0.09);
  margin: 12px 0 0;
  padding: 10px 0 10px;
}
.pagination .prev,
.pagination .next,
.pagination .page-number {
  margin-bottom: initial;
  top: initial;
}
.main {
  padding-bottom: initial;
}
.footer {
  bottom: auto;
}
.sub-menu {
  border-bottom: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12);
}
.sub-menu + .content .post-block {
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12), 0 -1px 0.5px 0 rgba(0,0,0,0.09);
  margin-top: 12px;
}
@media (min-width: 768px) and (max-width: 991px) {
  .sub-menu + .content .post-block {
    margin-top: 10px;
  }
}
@media (max-width: 767px) {
  .sub-menu + .content .post-block {
    margin-top: 8px;
  }
}
.post-body h1,
.post-body h2 {
  border-bottom: 1px solid #eee;
}
.post-body h3 {
  border-bottom: 1px solid #eee;
}
.post-body h4 {
  border-bottom: 1px dotted #eee;
}
@media (min-width: 768px) and (max-width: 991px) {
  .content-wrap {
    padding: 10px;
  }
  .posts-expand {
    margin: initial;
  }
  .posts-expand .post-button {
    margin-top: 20px;
  }
  .post-block {
    border-radius: initial;
    box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12), 0 -1px 0.5px 0 rgba(0,0,0,0.09);
    padding: 20px;
  }
  .post-block + .post-block {
    margin-top: 10px;
  }
  .comments {
    margin-top: 10px;
    padding: 10px 20px;
  }
  .pagination {
    margin: 10px 0 0;
  }
}
@media (max-width: 767px) {
  .content-wrap {
    padding: 8px;
  }
  .posts-expand {
    margin: initial;
  }
  .posts-expand .post-button {
    margin: 12px 0;
  }
  .post-block {
    border-radius: initial;
    box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12), 0 -1px 0.5px 0 rgba(0,0,0,0.09);
    min-height: auto;
    padding: 12px;
  }
  .post-block + .post-block {
    margin-top: 8px;
  }
  .comments {
    margin-top: 8px;
    padding: 10px 12px;
  }
  .pagination {
    margin: 8px 0 0;
  }
}</style><noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<script>function loadCss(l){var d=document,h=d.head,s=d.createElement('link');s.rel='stylesheet';s.href=l;!function e(f){if (d.body)return f();setTimeout(function(){e(f)})}(function(){h.appendChild(s);});}loadCss('/style.css');loadCss('//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext');loadCss('//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css');loadCss('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css');</script><noscript><link rel="stylesheet" href="/style.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"></noscript></head>

<body itemscope="" itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">贝克街的流浪猫</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">技术博客</h1>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input" id="search-input"></div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="algolia-results">
  <div id="algolia-stats"></div>
  <div id="algolia-hits"></div>
  <div id="algolia-pagination" class="algolia-pagination"></div>
</div>

  
</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0JlaUtlSmllRGVMaXVMYW5nTWFv" title="欢迎关注我的 GitHub" aria-label="欢迎关注我的 GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.beikejiedeliulangmao.top/protocol/rtp/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="贝克街的流浪猫">
      <meta itemprop="description" content="贝贝猫">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="贝克街的流浪猫">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          流媒体传输协议之 RTP
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-02-22 08:09:51" itemprop="dateCreated datePublished" datetime="2019-02-22T08:09:51+08:00">2019-02-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Protocol/" itemprop="url" rel="index">
                    <span itemprop="name">Protocol</span>
                  </a>
                </span>
            </span>

          
            <span id="/protocol/rtp/" class="post-meta-item leancloud_visitors" data-flag-title="流媒体传输协议之 RTP" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>27k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 ≈</span>
              <span>25 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>本系列文章将整理各路流媒体传输协议，包括RTP/RTCP，RTMP，希望通过深入理解各个流媒体传输协议的设计细节，对今后流媒体部分的开发工作有一定的启发。</p>
<a id="more"></a>

<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><p>RTP，即real-time transport protocol（实时传输协议），为实时传输交互的音频和视频提供了端到端传输服务。其中包括载荷的类型确认，序列编码，时间戳和传输监控功能。一般应用都是基于UDP协议，来使用RTP的多路技术以及验和服务。然而，RTP还可以与其它适合的协议并用，如果底层网络支持多路分发，RTP还可以将数据传输给多个目标。<br>需要注意的是RTP不提供任何机制以保证数据的实时性和QOS(quality-of-service)，而是依赖底层的服务来提供这些功能，RTP既不保证传输的可靠性也不保证无序传输，同时也不假定底层网络是可信任的和有序的。接收端可以利用RTP中的序列号排序收到的报文。<br><strong>RTP与RTCP</strong></p>
<ul>
<li>实时传输协议(RTP)，传输具有实时特性的数据</li>
<li>RTP控制协议(RTCP)，监控QOS和传递会话中参与者的信息。它没有明确的成员控制功能和Session建立过程，但这些对一个相对宽松的Session控制来说已经足够了，它没有必要包含一个应用的所有控制功能。</li>
</ul>
<p>RTP代表了一种新型协议，它遵循Application level framing 和 Integrated layer processing。即RTP可以比较容易的拓展以传递某些特定需要的内容，而且可以比较容易地集成进某个应用，而不是作为一个独立的补充层。<strong>RTP协议被故意地设计成不完整的协议框架。</strong></p>
<h2 id="RTP的使用场景"><a href="#RTP的使用场景" class="headerlink" title="RTP的使用场景"></a>RTP的使用场景</h2><p>下面的例子描述了RTP的部分特性，选择的例子是用来阐明基于RTP的应用的基本操作，而不是说RTP仅能用于此类应用。</p>
<h3 id="简单的多播音频会议"><a href="#简单的多播音频会议" class="headerlink" title="简单的多播音频会议"></a>简单的多播音频会议</h3><p>一个小组要通过网络开一个音频会议，他们用了IP多播服务。基于某种分配机制，小组得到了一个多播组地址和一对端口，其中一个端口是用来传输音频数据的，另一个是用来传输RTCP报文的。这个组播地址和端口发给了所有与会者。如果想要引入一些安全策略，可以对数据报文和控制报文加密，然后把加密时用到的密钥分发给与会者。<br>这个音频会议软件，可能会一直发送时长为20ms的音频数据包。每个实际音频数据包，都以RTP头数据开始，然后再以UDP协议封装并发送。RTP包的头部标识了该包的数据类型，以便消息发送器来改变数据的编码。例如，针对低带宽的与会者进行一些调节，或者对网络拥堵作出反应。<br>像UDP这类包类型的网络，偶尔会丢包，乱序，延迟不定长时间。为了解决这类意外情况，RTP包中包含了时间信息和序列号，这样接受者就可以通过它们重排数据包的时序。在这个例子中，我们就可以按顺序地播放每个20ms的音频数据。在会议中对每个数据源的RTP报文时序重排都是独立进行的。接受者也可以通过序列号来确定丢失了多少报文。<br>因为这个小组开会期间，会有一些人加入或退出这个网络会议，所以我们需要知道具体是谁加入了会议，以及他们有没有正常地接收到音频数据。出于这个目的，每个网络会议的客户端都会周期性的通过RTCP端口报告使用者的名字以及自己接受数据的情况，如果有人接受数据不正常，可能就需要对应的改变编码。而且，除了用户的名字之外，还会有一些别的信息，用来控制带宽限制。当有人从视频会议中退出时，还需要发送一个RTCP BYE报文。</p>
<h3 id="音频和视频会议"><a href="#音频和视频会议" class="headerlink" title="音频和视频会议"></a>音频和视频会议</h3><p>如果这个会议既要传输音频又要传输视频的话，它们会以独立的RTP Session传输。也就是说，负责音频传输的部分和负责视频传输的部分会通过不同的组播地址（和端口对）分别传输各自的RTP报文和RTCP报文。在RTP协议这一层，音频和视频Session并没有被组合到一起。我们期望与会者用同一个名字来建立音频和视频Session，这样这两个Session就能联系起来了。<br>RTP协议之所以这样设计，一个原因是某些与会者可以选择只接受某一种类型的数据（只接受Audio）。即便Audio数据和Video数据是独立分发的，但是我们仍然可以通过参考RTCP协议中时间信息来同步播放它们。</p>
<h3 id="Mixers-amp-Translators"><a href="#Mixers-amp-Translators" class="headerlink" title="Mixers &amp; Translators"></a>Mixers &amp; Translators</h3><p>到目前为止，我们都是假设所有的与会者想要接收同意格式的媒体数据。但是这显然不太合适，考虑一下，可能某些与会者可能网速相对比较慢，而其他人网速却比较快。对于这种情况，我们不应该强迫所有人都用低带宽并降低音频编码的质量，而是使用RTP级别的中继节点（Mixer）来给周围低带宽用户分发低带宽消耗的数据。这个Mixer将接收到的不同与会者的音频数据同步，并将它们耦合到一个单一流中，然后将这个流用低带宽消耗的编码方案进行压缩，最后发送给那些低带宽的与会者。Mixer可以在RTP头部写一些特殊内容，来表明该Mixer包具体耦合了哪些与会者，这样，接收到该Mixer包的人就能确定当前说话的人是谁了。<br>此外，有些与会者可能处于在应用级防火墙后，无法仅通过IP组播访问。这种情况下Mixer就没有什么意义了，他们需要另一类RTP级别的中继（Translator）。我们需要两个Translator，安装在防火墙的两面，外面的Translator将收到的所有组播报文，通过一个安全连接传输给防火墙里面的Translator。然后，防火墙里的Translator再将这些报文分发给内网的与会者。</p>
<h3 id="层编码"><a href="#层编码" class="headerlink" title="层编码"></a>层编码</h3><p>多媒体应用可以根据接受者的能力或者网络拥堵的情况调整传输速率。许多实现将码率控制的责任放在了发送者。这和组播模式不太兼容，因为各个不同的数据接受者会有不同的带宽情况，这就会产生木桶效应，即带宽最差的接受者会拖垮整个会议的通讯质量。<br>因此，带宽自适应的工作应该放到接受者这里，发送者需要拆分出面向不同带宽与会者的媒体流（500K，2M，5M），它们分别对应了不同的组播地址，数据的接收者根据自己的带宽情况，选择加入适合的组播。</p>
<h2 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h2><ul>
<li>RTP payload：RTP包中传输的数据，比如音频采样数据或者压缩过的视频数据。</li>
<li>RTP packet：由定长RTP头部，数据来源者的列表，RTP payload组成的数据包。一些下层协议可能会自己定义RTP的封装格式。一般来说，一个下层协议包只包含一个RTP包，但是也有可能多个RTP包被合并到一起。</li>
<li>RTCP packet：RTP控制报文，由定长的RTC头部开始，之后会跟着一些结构化的元素，它们在RTCP发挥不同功能时，会有不同的结构。通常多个RTCP包会被合在一起，通过一个下层协议包一起发送。</li>
<li>Port：传输层协议中用来区分某一主机下不同应用的抽象。RTP协议依赖更底层网络提供端口机制，继而提供多播的RTP和RTCP报文。</li>
<li>Transport address：网络地址和端口的组合，用来定位传输层的节点。</li>
<li>RTC media type：一个RTP Session中所用到的所有payload类型的合集。</li>
<li>Multimedia session： 视频会议组中同时工作的一组RTP session。例如，视频会议中的Audio session和Video session。</li>
<li>RTP session：一组参与者利用RTP来通讯的组合。一个参与者可以同时加入到多个RTP session中。在Multimedia session中，除非特意将多媒体编码进同一数据流，否则，每个数据流会通过不同的RTP Session传输。与会者通过Transport address来区分不同的RTP session。同一RTP session的不同与会者会共享同一个Transport address，也可能每个与会者都有自己的Transport address。在单播的情况时，一个与会者可能用同一对端口（RTP&amp;RTCP）来接受所有其他与会者的数据，也可能对不同的与会者采用不同的端口对（RTP&amp;RTCP）。</li>
<li>Synchronization source (SSRC)：RTP报文流的一个Source，由RTP头中定义的32-bit的SSRC identifier来标识，这样做是为了不依赖网络地址。同一个SSRC中发送的所有包都具有同一时序和序列号间隔，因此接收者可以通过SSRC将收到的数据包分组并排序。一个信号源（麦克风，摄像头，Mixer）的报文流会有由一个SSRC的发送器发送。一个SSRC可能会随着时间的变化，改变其数据格式，例如音频编码。SSRC的身份识别码都是随机生成的，但是必须保证整个RTP session中该身份识别码不会重复，这些工作是通过RTCP来完成的。如果一个与会者在一个RTP session中发送不同的媒体数据流，那么每个流的SSRC必须不同。</li>
<li>Contributing source (CSRC)：RTP Mixer所混合的所有数据对应的SSRC的列表。Mixer会将一个SSRC列表写入RTP头中，该列表包含了这个混合报文中包含的所有来源SSRC。</li>
<li>End system：一个生成RTP payload和消费收到的RTP payload的应用。一个End system可以扮演一个或者多个SSRC角色，但是通常是一个。</li>
<li>Mixer：一个中介系统，它接受一个或多个Source的数据，随后它可能会改变这些数据的格式，并将它们合并为一个新的RTP packet。因为，多个输入源的时序通常来说都不一致，所以Mixer通常会同步不同源的时间，并生成一个自己的时序来处理合并数据流。所有从Mixer输出的数据包都会标记上该Mixer的SSRC。</li>
<li>Translator：一个中介系统，它会转发RTP packet但是不改变其原本的SSRC。</li>
<li>Monitor：一个在RTP session中接收RTCP报文的应用，它会总结数据被接受的报告，并为当前分发系统评估QOS，诊断错误，长期统计。Monitor可以集成进会议应用中，也可以是独立的第三方应用，只接受RTCP报文，但是什么都不发送。</li>
<li>Non-RTP means：为了让RTP提供可用服务而加入的协议或者机制。特别是在多媒体会议中，需要一种控制协议来分发组播地址和加密密钥，协调加密算法，定义RTP payload格式和RTP payload类型的动态映射。</li>
</ul>
<h2 id="字节序，数据对齐，时间格式"><a href="#字节序，数据对齐，时间格式" class="headerlink" title="字节序，数据对齐，时间格式"></a>字节序，数据对齐，时间格式</h2><p>所有的整数字段都使用网络字节序（大端序），除了特别声明，数字常量由十进制表示。<br>所有头部数据都会根据其数据的原始长度进行对齐，比如，16-bit的数据会对齐到偶数偏移，32-bit的数据会对齐到可被4整除的偏移。此外，用0来作为填充字节。<br>Wallclock time（绝对日期和时间）是用网络时间协议（NTP）的时间格式来表示，即从1900年一月一日0点到现在的秒数。NTP的时间戳使用了64-bit的无符号固定小数点的形式表示，其中头32-bit用来表示整数部分，后32-bit用来表示小数部分。RTP的时间格式采用了NTP的简化版，他只用了NTP的64-bit数据的中间32-bit，即前16-bit表示整数，后16-bit表示小数。<br>NTP时间戳到2036年就会循环回0，但是因为RTP只会使用不同NTP时间的差值，所以这不会有什么影响。只要一对时间戳都在同一个循环周期里，直接用模块化的架构相减或者比较就可以，NTP的循环问题就不重要了。</p>
<h2 id="RTP数据传输协议"><a href="#RTP数据传输协议" class="headerlink" title="RTP数据传输协议"></a>RTP数据传输协议</h2><h3 id="RTP的定长头字段"><a href="#RTP的定长头字段" class="headerlink" title="RTP的定长头字段"></a>RTP的定长头字段</h3><p>RTP头的格式如下：<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/rtp/rtp-header.png" alt="rtp-header"><br>上图中前96-bit的数据是每个RTP包都有的部分，CSRC部分只有Mixer发送的报文才会有。这些字段的意义如下：</p>
<ul>
<li>Version（V）：2 bits<br>RTP版本号，现在用的是2。（第一个RTP草案用的1）</li>
<li>Padding（P）：1 bit<br>如果设置了该字段，报文的末尾会包含一个或多个填充字节，这些填充字节不是payload的内容。最后一个填充字节标识了总共需要忽略多少个填充字节（包括自己）。Padding可能会被一些加密算法使用，因为有些加密算法需要定长的数据块。Padding也可能被一些更下层的协议使用，用来一次发送多个RTP包。</li>
<li>Extension（X）：1 bit<br>如果设置了该字段，那么头数据后跟着一个拓展数据。</li>
<li>CSRC count（CC）：4 bits<br>CSRC列表的长度。</li>
<li>Marker（M）：1 bit<br>Marker会在预设中进行定义（预设和RTP的关系可以参考<span class="exturl" data-url="aHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzM1NTE=" title="https://tools.ietf.org/html/rfc3551">rfc3551<i class="fa fa-external-link"></i></span>，我的理解是预设是对RTP的补充，以达到某一类实际使用场景的需要），在报文流中用它来划分每一帧的边界。预设中可能会定义附加的marker，或者移除Marker来拓展payload type字段的长度。</li>
<li>Payload type（PT）: 7 bits<br>该字段定义RTP payload的格式和他在预设中的意义。上层应用可能会定义一个（静态的类型码&lt;-&gt;payload格式）映射关系。也可以用RTP协议外的方式来动态地定义payload类型。在一个RTP session中payload类型可能会改变，但是不应该用payload类型来区分不同的媒体流，正如之前所说，不同的媒体流应该通过不同session分别传输。</li>
<li>Sequence number：16 bits<br>每发送一个RTP包该序列号+1，RTP包的接受者可以通过它来确定丢包情况并且利用它来重排包的顺序。这个字段的初始值应该是随机的，这会让<span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvJUU1JUI3JUIyJUU3JTlGJUE1JUU2JTk4JThFJUU2JTk2JTg3JUU2JTk0JUJCJUU1JTg3JUJC" title="https://zh.wikipedia.org/wiki/%E5%B7%B2%E7%9F%A5%E6%98%8E%E6%96%87%E6%94%BB%E5%87%BB">known-plaintext<i class="fa fa-external-link"></i></span>更加困难。</li>
<li>Timestamp：32 bits<br>时间戳反映了RTP数据包生成第一块数据时的时刻。这个时间戳必须恒定地线性增长，因为它会被用来同步数据包和计算网络抖动，此外这个时钟解决方案必须有足够的精度，像是一个视频帧只有一个时钟嘀嗒这样是肯定不够的。如果RTP包是周期性的生成的话，通常会使用采样时钟而不是系统时钟，例如音频传输中每个RTP报文包含20ms的音频数据，那么相邻的下一个RTP报文的时间戳就是增加20ms而不是获取系统时间。<br>和序列号一样时间戳的初始值也应该是随机的，而且如果多个RTP包是一次性生成的，那它们就会有相同的时间戳。<br>不同媒体流的时间戳可能以不同的步幅增长，它们通常都是独立的，具有随机的偏移。这些时间戳虽然足以重建单一媒体流的时序，但是直接比较多个媒体流的时间戳是没办法进行同步的。每一时间戳都会和参考时钟（wallclock）组成时间对&lt;timestamp,wallclockTime&gt;，而且需要同步的不同流会共用同一个参考时钟，通过对比不同流的时间对&lt;timestamp,wallclockTime&gt;，就能计算出不同流的时间戳偏移量。这个时间对&lt;timestamp,wallclockTime&gt;并不是和每个RTP包一同发送，而是通过RTCP协议，以一个相对较低的频率进行共享。</li>
<li>SSRC：32 bits<br>该字段用来确定数据的发送源。这个身份标识应该随机生成，并且要保证同一个RTP session中没有重复的SSRC。虽然SSRC冲突的概率很小，但是每个RTP客户端都应该时刻警惕，如果发现冲突就要去解决。</li>
<li>CSRC list：0 ~ 15 items， 32 bits each<br>CSRC list表示对该payload数据做出贡献的所有SSRC。这个字段包含的SSRC数量由CC字段定义。如果有超过15个SSRC，只有15个可以被记录。</li>
</ul>
<h3 id="RTP-Session多路复用"><a href="#RTP-Session多路复用" class="headerlink" title="RTP Session多路复用"></a>RTP Session多路复用</h3><p>在RTP中，多路复用由目标传输地址（address：port）提供，不同的RTP session有不同的传输地址。<br>独立的音频和视频流不应该包含在同一个RTP session中，也不应该通过payload类型和SSRC来区分不同的流。如果用同一个SSRC发送了不同的数据流，会引入如下问题：</p>
<ol>
<li>假设2个音频流共享了一个RTP session，并且用了同一个SSRC，如果其中一个要改变编码，这就导致了payload类型的改变，但是协议中没有提供方法来让接受者知道具体是哪个音频流改变了编码。</li>
<li>一个SSRC只有一个对应的时序和序列号，如果多个流有不同的时钟周期的话，就需要不同的时序。而且还不能用序列号来确认是哪个流丢包了。</li>
<li>RTCP 发送者报告和接受者报告只描述了时序和序列号而不包含payload类型数据。</li>
<li>Mixer无法将不兼容的两个流合并</li>
<li>如果一个RTP session中包含了多个媒体流后就会失去如下优势：<ol>
<li>使用不同的网络路径或者分配网络资源</li>
<li>只接受某一种媒体数据（网络较差时只接受audio）</li>
<li>接收方对不同的媒体类型做不同的处理</li>
</ol>
</li>
</ol>
<p>不同的流使用不同的SSRC但是仍然用同一个RTP session发送确实可以解决前三个问题，但是仍然无法解决后两个问题。</p>
<h3 id="预设可能对RTP头的改动"><a href="#预设可能对RTP头的改动" class="headerlink" title="预设可能对RTP头的改动"></a>预设可能对RTP头的改动</h3><p>现有的这些RTP报文头对一般应用来说已经足够了。如果有需要，头字段可以根据预设进行一些修改，但仍要保证检测和统计功能的正常使用。</p>
<h4 id="RTP头拓展"><a href="#RTP头拓展" class="headerlink" title="RTP头拓展"></a>RTP头拓展</h4><p>RTP提供了一个拓展机制，让上层应用可以将自定义的信息存储在RTP报文头。如果上层应用收到了无法识别的头部拓展数据，它们会忽略它。<br>值得一提的是，这个头部拓展是有一些限制的。如果附加信息只对某些payload格式才有意义，那么最好还是别把这些信息放到头部拓展中，而是放到payload部分。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/rtp/rtp-header-extension.png" alt="rtp-header-extension"><br>如果RTP Header中的X位设置为1，那么Header后必须跟着一个不定长度的拓展块，紧跟着CSRC list（如果有的话）。拓展部分的头部包含一个16-bit的数据来描述拓展块包含多少个32-bit字（不包括拓展部分的头部）。因为RTP头部后面只能连接一个拓展块，考虑到有些应用可能会有多种类型的拓展块，所以拓展块的头16-bit留给开发者去自定义一些参数。</p>
<h2 id="RTP控制协议"><a href="#RTP控制协议" class="headerlink" title="RTP控制协议"></a>RTP控制协议</h2><p>同一个Session所有参与者会周期性地发送控制报文，RTP控制协议就是通过这种方式进行的，和RTP数据的传播一样采用了组播的机制。下层协议必须提供数据包和控制报文的多路复用功能，例如使用独立的UDP端口分别传输数据和控制报文。RTCP协议具有如下四大功能：</p>
<ol>
<li>最主要的功能是反馈数据分发的质量。这也是RTP作为一个传输协议来说最关键的功能，而且它和流量控制，拥塞控制息息相关。反馈信息可能会直接影响自适应编码的控制。发送反馈报告给所有的参与者可以让它们评估遇到的数据分发问题是个人问题还是全局问题。通过IP组播这样的分发机制，像网络提供商这样的机构即便不加入到这个RTP session中也能收到反馈信息，它们会扮演一个第三方监测者的角色去确认数据分发问题。这个反馈的功能无论是RTCP的发送者还是接受者都会进行报告。</li>
<li>RTCP还会给每个RTP source带一个不变的传输层身份识别符（CNAME），因为SSRC可能会中途改变（程序重启），所以接受者需要这个CNAME来持续追踪每个与会者。而且，接受者可以通过CNAME来将同一个与会者的所有数据流联系在一起，比如同步音频和视频。单个媒体内部的数据同步也需要NTP和RTP时间戳，这些数据都在数据发送者发送的RTCP报文中。</li>
<li>因为前两个功能需要所有的与会者都发送RTCP报文，所以需要适当的控制报文发送的频率以至于RTP协议可以在大量客户端一同加入时也能正常工作。通过每个参与者都广播控制报文的方式，每个人都能独立地计算出参与者的总数。</li>
<li>还有一个可有可无的功能，RTCP可以用来共享小量的session控制信息，例如辨认参与者的身份。它通常来说，会被与那些管理比较松散的Session使用。RTCP可以作为一个方便的与其他参与者沟通的通道，但是你也别期望RTCP可以满足一个应用的所有传输控制需求，这类需求往往是通过一个更高层的session控制协议来满足。</li>
</ol>
<p>这四个功能中，前三个应该会被所有应用场景使用（IP组播机制下）。RTP应用的设计者应该避免自己的应用只能工作在单播模式，RTP应用应该设计成可拓展的，要考虑大量使用者并发时的情况。此外，RTCP的传输应该根据发送者和接受者角色的不同而分别进行控制，例如一些单项连接，接受者的反馈信息就发不出来。<br><strong>提醒</strong>：像是指定源组播路由（SSM），只有一个人可以发送数据，其他接受者不能用组播来和其他人直接通讯。对于这种情况，建议完全关闭接受者的原始RTCP功能，然后为这个SSM设定一个RTCP的适配器，来接受所有的反馈。</p>
<h3 id="RTCP包格式"><a href="#RTCP包格式" class="headerlink" title="RTCP包格式"></a>RTCP包格式</h3><p>RTCP定义了许多包类型来传输不同的控制信息：</p>
<ul>
<li>SR：发送者报告，发送者数据发送和接受的统计。</li>
<li>RR：接收者报告，只接受数据的节点的接受统计。</li>
<li>SDES：Source描述，包括CNAME</li>
<li>BYE：表示退出</li>
<li>APP：上层应用自定义</li>
</ul>
<p>每个RTCP包都有一个和RTP类似的固定格式的头，后面跟着长度不定的结构化数据，在不同RTCP类型时，这些结构化数据各不一样，但是它们必须都要32-bit对齐。RTCP的头部是定长的，而且在头部有一个字段来描述这个RTCP数据的长度，因此RTCP可以被复合成一组一同发送，还不需要任何分隔符来分割出单个的RTCP包。下层协议可能会根据自己的情况决定将多少个RTCP报文复合在一起组成一个复合包。<br>复合包中的每个独立的RTCP报文都是无序的，而且可能会被随意复合。为了让协议的功能正常运作，会有如下限制：</p>
<ul>
<li>接受统计（SR|RR）的发送频率需要达到带宽的最大限制，因此每个周期发送的RTCP复合包都需要包含一个这类报文。</li>
<li>一个新来的接受者需要尽可能快地得到数据源的CNAME，因为它要用CNAME来确定每个数据源分别对应哪个人，并将数据源联系在一起进行同步，所以每个RTCP复合包必须包含SDES CNAME（除非这个复合包被拆成两半一半加密，一般明文，这部分后面会介绍）。</li>
<li>复合包中包类型的数量需要限制，这可以减少其他发错的包或者不相关的包被识别成RTCP包的可能性，还能增加第一个字中固定比特的数量。</li>
</ul>
<p>因此，一个复合包中至少需要含有2种类型的RTCP报文，它的格式如下：</p>
<ul>
<li>Encryption prefix：当且仅当这个复合包需要加密的时，那复合包在头部插入一个随机的32-bit数。如果加密算法需要填充数据的话，需要填充到复合包中的最后一个RTCP包后。</li>
<li>SS 或 RR：复合包中第一个RTCP包必须是一个报告报文，这可以加速报文头部数据的校验。即便没有RTP数据的发送和接受也要有一个报告报文，这种情况下必须发送一个空的RR报文，并且即便是这个复合包中的其他RTCP报文是BYE也要这么做。</li>
<li>Additional RRs：如果接受的RTP数据来自超过31个不同的源，前31个接受报告会写进SR或者RR报文中，多出来的接受报告应该紧跟着默认的报告报文（SR或RR）。</li>
<li>SDES：SDES包必须包含CNAME，每个复合包必须包含一个SDES包。如果上层应用有需要，也可以加入一些别的SDES报文，这视带宽限制而定。</li>
<li>BYE或APP：其他RTCP包类型（包括协议中还未定义的），可能以任意顺序跟在SDES后面，但是希望BYE包写在最后面（BYE包需要和SSRC/CSRC一同发送）。</li>
</ul>
<p>一个单独的RTP参与者应该在一个报告周期中只发送一个复合RTCP包，该周期每个参与者应该视带宽情况来估算，除非一个复合包被拆分加密。如果数据发送者的数量太多，以至于除了增加MTU这个方法之外，没办法将所有RR报文塞进一个复合包时，那么一次只会将部分RR数据塞进这个复合包，其他的数据就不发送了。当然，为了让所有源的接受情况都得到报告，会在多个周期内以环的形式循环共享所有源的接受情况。<br>为了减少数据包的开销，一般建议Translator和Mixer无论何时都能将多个源的RTCP报文复合成一个复合包。下图展示的就是一个Mixer生成的复合包的例子：<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/rtp/rtp-compound-packet.png" alt="rtp-compound-packet"><br>如果一个复合包的长度超过了下层网络协议的MTU的话，这个复合包会被拆分成多个更小的复合包分别发送。这不会对RTCP的带宽估计产生任何影响，因为即便Mixer的复合包被拆分成了多个更小的复合包，但是这个些更小的复合包也要满足”每个复合包都要包含SS或RR”这一条件，所以每个更小的复合包至少也对应了一个参与者，这样Mixer生成的复合包就和它收到的RTCP包数量基本匹配，甚至更少。<br>如果某一客户端收到了它无法解析的RTCP类型的包，那它应该忽略这个包。附加的RTCP包类型会通过<span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3poLWhhbnMvJUU0JUJBJTkyJUU4JTgxJTk0JUU3JUJEJTkxJUU1JThGJUI3JUU3JUEwJTgxJUU1JTg4JTg2JUU5JTg1JThEJUU1JUIxJTgw" title="https://zh.wikipedia.org/zh-hans/%E4%BA%92%E8%81%94%E7%BD%91%E5%8F%B7%E7%A0%81%E5%88%86%E9%85%8D%E5%B1%80">IANA<i class="fa fa-external-link"></i></span>进行注册。</p>
<h3 id="RTCP传输周期"><a href="#RTCP传输周期" class="headerlink" title="RTCP传输周期"></a>RTCP传输周期</h3><p>RTP的设计理念是它要能根据session参与者的人数增加而进行自适应处理。例如，音频会议中同一时刻说话的一般也就那么一两个人（这就从内部限制了音频数据的传输），那么可以认为组播数据分发所用到的带宽资源和与会人数无关。控制信息的发送和音频数据的传输不同，每个人都会不停的发送RTCP报文，如果每个参与者的接受报告以同一个周期发送的话，RTCP报文传输所消耗的资源会随着与会人数的增加而线性增加。因此，当与会人数增加时，RTCP报文的发送间隔应该相应的动态地增大。<br>对每个session来说，会有一个总的带宽限制（Session bandwidth），它会被分配给每个独立的与会者。整个网络的带宽可能会有所保留，并从网络层面强制限制Session的带宽。如果网络的带宽没有保留的话，也可能会有一些别的限制，不过这些都跟网络环境有关，总之最后会得出一个靠谱的Session最大带宽。Session带宽可能会通过实际会消耗的网络资源进行评估，或者中途根据session的剩余可用带宽来变化。这些都和媒体数据的编码无关，但是会根据带宽的限制来选择具体使用哪种编码。通常来说，会预估session中有多少参与者会同时发送数据，然后根据同时发送这类数据大概需要多少带宽这种方式来评估session的带宽。在音频会议中，通常来说就是一个音频发送者所需要的带宽（一般同一时间只会有一个人说话）。对于分层编码这种情况，每一层都在一个独立的RTP session中，这些session都有自己独立的带宽限制。<br>在RTP session中应该有一个管理应用来调整session带宽，但是那些音频会议应用可能会基于session中选用的编码格式，假设只有一个发送者发送数据，给自己设定一个默认的带宽限制。这个音频会议应用可能也会受到组播网络（或其他因素）的带宽限制。同一个session的所有参与者必须使用统一的session带宽限制，因为只有这样大家才是以一个相同的频率发送RTCP包。<br>Session带宽评估过程需要考虑到下层的传输层和网络层是否有一些资源保留机制。而且上层应用也需要知道RTP下层使用了什么协议，但是不需要知道数据链路层及以下的协议，因为从数据链路层开始数据包的头就各不相同了。<br>控制报文的传输应该只使用Session带宽中很小的一部分，这样媒体数据的传输才会不受影响。建议RTCP传输使用session带宽的5%，媒体数据发送者至少要占用1/4的RTCP带宽，因为这样做的话，新加进来的人可以更快的收到媒体数据发送者的CNAME。在某些预设中，如果发送者的数量超过1/4可能会完全关闭接受报告，虽然RTP协议标准并不推荐这样做，但是那些只有单向链路的系统或者不需要接受者反馈的系统一般是这么做的。<br>RTCP报文的传输间隔一般都会稍微长一点，这样，当参与者的数量陡增时，报文的数量就不会超过带宽限制太多。当一个应用启动时，它应该等一段时间（一般是最小RTCP报文间隔的一半）再发送第一个RTCP报文，这样这可让发送间隔的计算更快的收敛。推荐RTCP报文发送的最小间隔是5秒。<br>RTP的上层应用可能会使用更短的RTCP发送间隔，但是也会遵循如下原则：</p>
<ul>
<li>对于组播形式的Session，只有数据发送者会使用更短的RTCP发送间隔。</li>
<li>对于单播形式的Session，无论是发送者还是接受者都有可能使用更短的RTCP间隔，并且它们发送初始RTCP前可能不会等待一段时间。</li>
<li>所有的Session都应该根据最小RTCP发送间隔来确定参与者的超时时间。</li>
<li>推荐的最小RTCP发送间隔时间使用”360 kb/ session带宽（kb/s）”这种方式计算。这样当session带宽大于72kb/s时，RTCP发送间隔会小于5秒。</li>
</ul>
<p>此外，为了让RTCP能在大型session中正常运行，现有的算法还具有如下特点：</p>
<ul>
<li>RTCP报文发送间隔随着session参与者的人数增加而线性地降低。</li>
<li>RTCP发包间隔通常会随机缩放0.5~1.5倍，这样做是为了避免大量的参与者同时发送RTCP报文。</li>
<li>RTCP复合包中包含的控制报文数据会根据收发包情况动态变化</li>
<li>因为RTCP报文间隔是根据已知的session参与者情况计算的，所以当有新的人要加入到session时，可能会错估整个session的规模，而是用了较短的RTCP间隔，尤其是当大批量的人一齐加入session时这种现象更加明显。所以，可能会有一个”发送时机重整”算法，它实现了一个简单的撤回机制，可以在session规模持续增长时，适当的撤回一些RTCP报文。</li>
<li>当有人通过发送BYE报文或者因为超时退出Session时, RTCP的发送间隔应该缩短。</li>
<li>BYE报文和其他RTCP报文相比，有一些特殊的地方。当有人想要退出，并发送BYE报文时，它可以在下一个发送周期到来之前就发送。当然，如果一大批人同时退出时，也会受到前面提到的RTCP报文撤回机制的影响。</li>
</ul>
<h4 id="维护Session成员的数量"><a href="#维护Session成员的数量" class="headerlink" title="维护Session成员的数量"></a>维护Session成员的数量</h4><p>我们已经知道了，计算RTCP发送间隔是需要清楚整个Session中成员数量的，当一个新的节点被监听到时，它就会被加入到Session总数中，并且大家要把它加入到一个SSRC（CSRC）身份识别表中然后持续追踪。大家只有收到这个新节点的多个数据包，或者收到他的SDES包（CNAME）时才觉得这个新节点是靠谱的。当某个节点发了一个BYE之后，它的信息可能就会被大家删了，但是考虑到可能有丢包或者网络拥堵的情况，所以大家会先把它标记为”收到BYE”，然后等一段时间，如果还没收到它的别的报文，这时候才会把它删了。<br>如果一个节点超过一个RTCP周期都没收到另一个节点的报文，它可能就会将其标记为不活跃，或者删了它，这就需要丢包的情况尽可能别发生。但是不丢包是不可能的，所以大家一般会将RTCP传输间隔乘以一个系数（大于1的数）作为超时时间。<br>对于那些参与者很超级多的Session，可能没法去维护一个SSRC表来存储所有参与者的信息。通常大家都会简化这个SSRC表，但是需要注意的是无论怎么简化这个表都不能低估了参与者的总数，可以允许高估参与者总数。</p>
<h3 id="RTCP报文的收发规则"><a href="#RTCP报文的收发规则" class="headerlink" title="RTCP报文的收发规则"></a>RTCP报文的收发规则</h3><p>首先，无论是组播还是多个节点的单播都必须遵循前面提到的RTCP间隔。为了正常完成RTCP报文的收发操作，Session中的每个参与者都会维护如下信息：</p>
<ul>
<li>TP：最后RTCP报文的发送时间</li>
<li>TC：当前时间</li>
<li>TN：下一个要发送报文的时间点</li>
<li>P-Members：计算上一个TN时参考的session成员总数</li>
<li>Members：当前的session成员总是</li>
<li>Senders：数据发送者总数</li>
<li>RTCP_BW：RTCP的目标带宽</li>
<li>WE_Sent： 从倒数第二个RTCP报文发送后，到现在为止，是否发送过数据</li>
<li>AVG_RTCP_Size：平均RTCP复合包大小，包括传输层和网络层的头</li>
<li>initial：是否一个RTCP报文都没发过</li>
</ul>
<h4 id="计算RTCP发送间隔"><a href="#计算RTCP发送间隔" class="headerlink" title="计算RTCP发送间隔"></a>计算RTCP发送间隔</h4><p>为了让RTP协议具有可伸缩性，RTCP的发送间隔需要随着Session总人数的变化而适当的缩放。结合上述的部分状态，我们按如下方式计算RTCP报文间隔：</p>
<ol>
<li>如果媒体流发送者的数量小于总人数的25%时，这个间隔和当前节点是否是媒体流发送者有关（通过WE_Sent判断）。如果是媒体流发送者，计算公式为：<code>Senders * AVG_RTCP_Size / (25% * RTCP_BW)</code>，如果是媒体流的接收者，计算公式为：<code>（Members - Senders）* AVG_RTCP_Size / (75% * RTCP_BW)</code>。当媒体流发送者的数量超过25%时，发送者和接受者会被同等对待，即它们的RTCP周期公式为：<code>Members * AVG_RTCP_Size / RTCP_BW</code>。</li>
<li>如果某个参与者一个RTCP包都还没发送，最小发送间隔间隔（Tmin）为2.5秒，否则为5秒。</li>
<li>决定的发送间隔（Td）会是第一步计算的值和Tmin中较大的那个。</li>
<li>发包时会在Td的基础上随机缩放0.5~1.5倍</li>
<li>最终这个间隔还要除以e-3/2=1.21828，这是为了弥补因为”发送时机重整”算法带来的影响（因为这个算法会导致最终RTCP使用的实际带宽比预计使用的带宽低）。</li>
</ol>
<h4 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h4><p>当一个人刚加入到Session中时，tp=0，tc=0，senders=0，p-members=0，members=1，we_sent=false，<br>rtcp_bw = 5% * session带宽，initial=true，avg_rtcp_size=之后会发送的RTCP包的大小，然后计算发送间隔T时，会根据上述初始状态进行计算，并以此作为参考发送第一个包，最后将自己的SSRC加入到成员列表中。</p>
<h4 id="接受RTP和Non-BYE-RTCP包"><a href="#接受RTP和Non-BYE-RTCP包" class="headerlink" title="接受RTP和Non-BYE RTCP包"></a>接受RTP和Non-BYE RTCP包</h4><p>当RTP或者RTCP包被另一个人（A）接收到了，如果对A来说这个包的SSRC他没见过，那么他就会将其加入到SSRC表中，并更新session总人数（Members）。对每个CSRC也会做同样的操作。<br>如果收到了一个RTP报文，并且其对应的SSRC没在发送者SSRC表中，那他就会把它加进发送者SSRC表中，并更新发送者的总数（Senders）。<br>当每个复合RTCP报文被接受到时，平均RTCP报文大小（AVG_RTCP_Size）的状态就会更新，更新公式为：<code>AVG_RTCP_Size = (1 / 16) * last_rtcp_package_size + (15 / 16) * previous_avg_rtcp_size</code>。</p>
<h4 id="接受RTCP-BYE报文"><a href="#接受RTCP-BYE报文" class="headerlink" title="接受RTCP BYE报文"></a>接受RTCP BYE报文</h4><p>如果接收到了RTCP BYE报文，会在成员列表中确认一下，如果有对应的SSRC项，就会把他移除并更新成员总数（Members）。同时也会在发送者SSRC表中做类似的操作，如果找到了就删除它并更新发送者总数（Senders）。<br>此外，为了让RTCP的传输率跟随Session中人数的变化而动态变化，如下算法会在收到BYE报文时执行：</p>
<ol>
<li>TN按照如下公式更新：TN = TC + (Members / P-Members) * (TN - TC)</li>
<li>TP按照如下公式更新：TP = TC - (Members / P-Members) * (TC - TP)</li>
<li>下一个RTCP报文按照新的TN指示发送（比原来发的更早了）</li>
<li>将P-Members设置成Members的值</li>
</ol>
<p>这个算法没有考虑到一个意外情况，那就是当一大波人（并不是所有人）同时退出Session时，会导致RTCP的周期降到一个非常小的值，这样可能出现错误的Timeout判断，最终它会导致整个Session的总人数降到0。但是，这种情况一般来说很少发生，所以大家都觉得它问题不是很大。</p>
<h4 id="SSRC的超时"><a href="#SSRC的超时" class="headerlink" title="SSRC的超时"></a>SSRC的超时</h4><p>我们需要偶尔确认一下是不是太久没收到某个与会者的报文了，一般来说每个RTCP周期内都必须确认。如果发现了超时，就需要将这个SSRC从成员列表（Members &amp; Senders）中移除，并更新当前人数。</p>
<ul>
<li>Member表： 一般超过5个发送周期（不考虑随机缩放因素）未收到某人的消息，会被确定为超时。</li>
<li>Sender表： 一般是2个发送周期。</li>
</ul>
<p>如果某个成员被确定为超时，上一步介绍的算法就操作起来了。</p>
<h4 id="发送倒计时"><a href="#发送倒计时" class="headerlink" title="发送倒计时"></a>发送倒计时</h4><p>我们已经知道，每个RTCP都是周期性的发送的，当发送完一个RTCP报文时，就会根据TN新建一个倒计时，每次当倒计时归零时就会重复如下操作：</p>
<ol>
<li>计算传输周期T，引入随机缩放因素</li>
<li>如果TP + T &lt;= TC，立即发送一个RTCP报文，并将TP设定为TC，TN设定为TC + T，下一个倒计时会在TN时刻归零。如果TP + T &gt; TC，就不发送了RTCP报文，计算TN = TC + T后，然后重设一个定时器在TN归零。</li>
<li>P-Members设定为Members</li>
</ol>
<p>如果发送了RTCP报文，<code>initial</code>会被设定为FALSE，<code>AVG_RTCP_Size</code>会按如下方式更新：<br><code>AVG_RTCP_Size = (1 / 16) * last_rtcp_package_size + (15 / 16) * previous_avg_rtcp_size</code></p>
<h4 id="发送BYE报文"><a href="#发送BYE报文" class="headerlink" title="发送BYE报文"></a>发送BYE报文</h4><p>当某个人想要退出Session时，他就会发一个BYE报文给其他人。为了防止一大帮人同时退出Session时出现BYE报文井喷的情况，所以当Session人数超过50时，会按下述方式操作：</p>
<ol>
<li>当一个参与者想要离开时，TP会设置成TC，Members和P-Members会设置成1，initial设置成1，we_send设置成false，senders设置成0，avg_rtcp_size设置成复合BYE报文的大小。然后计算RTCP发送间隔T，下个BYE报文会在TN = TC + T后发送。</li>
<li>每当这个要离开的人收到了别人的BYE报文时，Members就会增加1，无论这个人是否在成员列表中。Members的数量只有收到BYE报文时才增加，其他报文都不管。同样，avg_rtcp_size也只管收到的BYE报文的大小。Senders数量也不变。</li>
<li>对了BYE报文来说，除了状态值的维护套路变了，发送逻辑和前面提到的都一样</li>
</ol>
<p>通过上述方案，即可以让BYE报文正确地发送，还能控制整体带宽。最差的情况下，也只会导致RTCP报文传输占用10%的Session总带宽。<br>有些参与者可能不想按照上述的方式发送BYE报文，他们可能什么也不发就离开了。这类情况会被Timeout机制hold住。<br>如果一个参与者要离开时，session的总人数小于50，他可能会直接发送一个BYE报文，也可能按照上述方案来进行。<br>此外还有一个无论如何都要遵循的规则，如果一个参与者一个RTP报文或者RTCP报文都没发送过的话，那他离开Session时绝对不能发送BYE报文。</p>
<h4 id="更新WE-Sent"><a href="#更新WE-Sent" class="headerlink" title="更新WE_Sent"></a>更新WE_Sent</h4><p>当某个参与者最近发送过一个RTP后，他就会将WE_Sent置为true并将自己加入到Senders表中，否则如果超过两个RTCP发送周期的时间内都没发送过RTP报文，那他就会将自己从Sender表中移除，并将WE_Sent置为false。</p>
<h4 id="SDES类报文的带宽分配"><a href="#SDES类报文的带宽分配" class="headerlink" title="SDES类报文的带宽分配"></a>SDES类报文的带宽分配</h4><p>SDES报文中除了必需要有的CNAME之外，还有一些别的信息，比如NAME（个人名称），EMAIL（email地址）等。上层应用也可以自定义的一些报文类型，但是要小心别付加了太多的自定义信息以至于拖慢了整个RTCP协议的运转。建议这些附加内容的带宽占用不要超过整个RTCP协议带宽的20%。此外，也不要觉得每个上层应用都会包含所有的SDES内容。上层应用要根据实际使用的情况给这些内容分配一定的带宽，一般来说他们会通过控制发送间隔来控制这部分的带宽。<br>比如，一个应用的SDES可能只包含CNAME，NAME，和EMAIL，其中NAME可能就会比EMAIL分配更多的带宽。因为NAME会一直显示出来，而EMAIL可能只在点击查看的时候才显示。在每个RTCP发送周期里，SDES中都会包含CNAME。如果假设RTCP周期是5秒的话，可能每15秒SDES才会附带一个除CNAME以外的信息，以2分钟为例，其中7次附带的是NAME信息，1次附带的是EMAIL信息。</p>
<h3 id="Sender-amp-Receiver报告"><a href="#Sender-amp-Receiver报告" class="headerlink" title="Sender &amp; Receiver报告"></a>Sender &amp; Receiver报告</h3><p>RTP使用Sender报告（SR）和Receiver报告（RR）来反馈数据的接受质量，如果是媒体数据的发送者那就会发送SR，否则发送RR。这两类报文是通过头部的报文类型识别码来做区分的。SR相对于RR来说多了20byte的Sender相关信息，除此之外其他内容都是一样的。</p>
<h4 id="SR报文"><a href="#SR报文" class="headerlink" title="SR报文"></a>SR报文</h4><p><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/rtp/rtcp-sr.png" alt="rtcp-sr"><br>SR报文包含三个部分，第一个部分是头部，有8 BYTE，各个字段的含义如下：</p>
<ul>
<li>version (V): 2 bits<br>RTP协议版本</li>
<li>padding (P): 1 bit<br>是否包含填充，最后一个填充字节标识了总共需要忽略多少个填充字节（包括自己）。Padding可能会被一些加密算法使用，因为有些加密算法需要定长的数据块。在复合包中，只有最后一个RTCP包需要添加填充。</li>
<li>reception report count (RC): 5 bits<br>有多少个接受报告。可以为0。</li>
<li>packet type (PT): 8 bits<br>200表示SR报文。</li>
<li>length: 16 bits<br>报文长度（按32-bit字统计），包含头部和填充字节。</li>
<li>SSRC: 32 bits<br>身份定位符。</li>
</ul>
<p>第二部分是发送者信息，包含20 BYTE的数据，总结了这个发送的的传输统计，各个字段的含义如下：</p>
<ul>
<li>NTP timestamp: 64 bits<br>Wallclock time，用于计算RTT。</li>
<li>RTP timestamp: 32 bits<br>RTP时间戳，基于NTP的某一随机偏移量。用于媒体数据内同步。</li>
<li>sender’s packet count: 32 bits<br>这个SSRC总共发送了多少包</li>
<li>sender’s octet count: 32 bits<br>这个SSRC总共发送了多少BYTE的数据。</li>
</ul>
<p>第三部分可能什么都没有，也可能有多个接收报告，这取决的上次报告以后收到了多少个Sender的数据。每个报告块统计了一个SSRC的包数。具体内容如下：</p>
<ul>
<li>SSRC_n (source identifier): 32 bits<br>这个信息块对应的SSRC。</li>
<li>fraction lost: 8 bits<br>上次SR或RR发送后到目前为止的丢包率。</li>
<li>cumulative number of packets lost: 24 bits<br>整体过程的丢包总数。</li>
<li>extended highest sequence number received: 32 bits<br>低16-bit是收到的最新的RTP报文序列号，高16-bit是序列号循环的次数。</li>
<li>interarrival jitter: 32 bits<br>RTP数据报文抵达时间的抖动。如果Si代表i包中包含的RTP时间戳，Ri代表i包被接受时的RTP时间戳，那两个包i和j的到达时间抖动算法如下：<br><code>D(i,j) = (Rj - Ri) - (Sj - Si) = (Rj - Sj) - (Ri - Si)</code>。<br>我们在计算这个抖动时，要结合每个包的抖动，来计算一个平均值，计算平均值的方案如下：<br><code>J(i) = J(i-1) * (15 / 16) + (|D(i-1,i)|)/16</code></li>
<li>last SR timestamp (LSR): 32 bits<br>该SSRC最后一个RTCP报文（SR）中带的NTP时间。</li>
<li>delay since last SR (DLSR): 32 bits<br>从该SSSR最后一个RTCP报文（SR）被收到以来经过的时间。</li>
</ul>
<p>数据的发送者可以通过当前时间A，接收到RR部分中的LSR和DLSR来计算RTT，计算示意图如下:<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/rtp/rtp-rtt.png" alt="rtp-rtt"></p>
<h4 id="RR报文"><a href="#RR报文" class="headerlink" title="RR报文"></a>RR报文</h4><p><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/rtp/rtp-rr.png" alt="rtp-rr"><br>接受报告的格式和发送报文格式一样，只不过它在头部中用201表示这是一个RR报文。此外RR报文中不含有上述SR报文中的第二部分。如果RR报文是空的那么需要在头部标明<code>RC=0</code>。</p>
<h4 id="发送-接受报文的拓展"><a href="#发送-接受报文的拓展" class="headerlink" title="发送/接受报文的拓展"></a>发送/接受报文的拓展</h4><p>一些预设可能根据自己的需求，要在接受报告和发送报告中附加一些信息。那么这些附加内容应该在SR或者RR的结尾之后。如果这些内容只有发送者相关，那么RR中就不包含这些信息。</p>
<h4 id="分析发送报告和接受报告"><a href="#分析发送报告和接受报告" class="headerlink" title="分析发送报告和接受报告"></a>分析发送报告和接受报告</h4><p>这些接受质量的报告信息可能不光只有发送者要使用，接受者或者第三方监控器也会使用。发送者可能根据接受质量调整自己的传输策略。接受者可以根据这个信息来确定自己遇到的问题是本地网络的问题还是整个Session的问题。网络的管理者可以根据这些信息来评估整个网络环境的情况。</p>
<h3 id="SDES报文"><a href="#SDES报文" class="headerlink" title="SDES报文"></a>SDES报文</h3><p><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/rtp/rtp-sdes.png" alt="rtp-sdes"><br>SDES是一个三级结构，它包含一个头和0个或多个数据块，每一个数据块对应了一个SSRC或CSRC，它又由多个描述字段组成。头部的信息如下：</p>
<ul>
<li>version (V), padding (P), length:<br>和上面一样</li>
<li>packet type (PT): 8 bits<br>202表示SDES类型</li>
<li>source count (SC): 5 bits<br>SSRC/CSRC块的数量。</li>
</ul>
<p>每一个块中都包含多个描述内容，这些描述内容都是32对齐的，其中前8-bit描述了类型，接着8-bit描述了信息长度（不包含前16-bit），然后信息内容。注意信息部分不能超过255 BYTE，这和前面的很多工作类似是为了约束RTCP的带宽。<br>描述的文本内容是UTF-8编码的。如果要使用多字节的编码，需要在醒目的地方表示用的什么的编码。<br>各个描述部分是没有中间分隔的，所以要用空字节来填充以达到对齐的效果。注意这里的填充和RTCP头部的P不是一个概念。<br>末端节点发送的SDES包含他自己的数据源标识。而Mixer发送的SDES包含多个CSRC，如果CSRC的数量超过了31个，会拆分成多个SDES报文。<br>SDES的所有类型会在后面一一介绍。其中只有CNAME是强制要有的。可能有一些类型的的描述只有部分预设才会使用。但是这些内容都是在一个共通的地方来记载，以防止不同的预设使用的描述类型发生冲突。如果要注册新的类型，需要通过IANA注册。</p>
<h4 id="CNAME：权威的末端节点身份标识"><a href="#CNAME：权威的末端节点身份标识" class="headerlink" title="CNAME：权威的末端节点身份标识"></a>CNAME：权威的末端节点身份标识</h4><p><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/rtp/rtp-cname.png" alt="rtp-cname"><br>CNAME有如下特征：</p>
<ul>
<li>因为SSRC在许多意外情况下会重新生成，所以CNAME被用来绑定旧的SSRC和新的SSRC，来保持数据源的连续。</li>
<li>和SSRC一样，CNAME也需要保证唯一性（同一个Session中）</li>
<li>为了让同一个参与者的多个SSRC绑定在一起，我们需要CNAME是固定的</li>
<li>为了让第三方监控用起来方便，CNAME应该即方便程序使用，也要设计成可读的，可以根据它确认来源</li>
</ul>
<p>因此CNAME应该通过算法来生成而不是手动生成。为了满足如上需要，一般来说是按照如下的格式来描述CNAME:</p>
<ul>
<li>“user@host” eg: “<span class="exturl" data-url="bWFpbHRvOmRvZUAxOTIuMC4yLjg5" title="mailto:doe@192.0.2.89">doe@192.0.2.89<i class="fa fa-external-link"></i></span>“ or “doe@2201:056D::112E:144A:1E24”</li>
<li>“host”, 如果是单用户系统，获取不到user时只使用host。eg: “sleepy.example.com”,”192.0.2.89” or “2201:056D::112E:144A:1E24”</li>
</ul>
<p>有些人可能会发现，如果上述的host使用的是子网地址的话，就没办法保证整个Session的唯一性了，通常这类没有直接IP的使用者是通过一个RTP级别的Translator来访问公共网络。这个Translator会处理从私有地址到公网地址的转换工作。</p>
<h4 id="NAME：用户名"><a href="#NAME：用户名" class="headerlink" title="NAME：用户名"></a>NAME：用户名</h4><p><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/rtp/rtp-name.png" alt="rtp-name"><br>这个是描述数据源的真实名字，eg:”John Doe, Bit Recycler”。整个Session过程中希望这个值不变。全Session不需要唯一。</p>
<h4 id="EMAIL：电子邮箱地址"><a href="#EMAIL：电子邮箱地址" class="headerlink" title="EMAIL：电子邮箱地址"></a>EMAIL：电子邮箱地址</h4><p><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/rtp/rtp-email.png" alt="rtp-email"><br>电子邮箱地址，eg: “<span class="exturl" data-url="bWFpbHRvOkpvaG4uRG9lQGV4YW1wbGUuY29t" title="mailto:John.Doe@example.com">John.Doe@example.com<i class="fa fa-external-link"></i></span>“。整个Session过程中希望这个值不变。</p>
<h4 id="PHONE：电话号码"><a href="#PHONE：电话号码" class="headerlink" title="PHONE：电话号码"></a>PHONE：电话号码</h4><p><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/rtp/rtp-phone.png" alt="rtp-phone"><br>电话号码需要以国际访问码开头，eg: “+1 908 555 1212”</p>
<h4 id="LOC：用户地理地址"><a href="#LOC：用户地理地址" class="headerlink" title="LOC：用户地理地址"></a>LOC：用户地理地址</h4><p><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/rtp/rtp-loc.png" alt="rtp-loc"><br>视应用不同，详细程度会各不相同。</p>
<h4 id="TOOL：应用名或工具名"><a href="#TOOL：应用名或工具名" class="headerlink" title="TOOL：应用名或工具名"></a>TOOL：应用名或工具名</h4><p><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/rtp/rtp-tool.png" alt="rtp-tool"><br>带版本号的应用名，可以用来DEBUG。</p>
<h4 id="NOTE：提醒-状态"><a href="#NOTE：提醒-状态" class="headerlink" title="NOTE：提醒/状态"></a>NOTE：提醒/状态</h4><p><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/rtp/rtp-note.png" alt="rtp-note"><br>用来发送暂时性的消息描述当前状态。eg: “on the phone, can’t talk”</p>
<h4 id="PRIV：自定义拓展"><a href="#PRIV：自定义拓展" class="headerlink" title="PRIV：自定义拓展"></a>PRIV：自定义拓展</h4><p><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/rtp/rtp-priv.png" alt="rtp-priv"><br>上层应用自定义的格式。一般都是用过一个前缀描述消息类型，然后后面跟着消息正文。</p>
<h3 id="BYE报文"><a href="#BYE报文" class="headerlink" title="BYE报文"></a>BYE报文</h3><p><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/rtp/rtp-bye.png" alt="rtp-bye"><br>BYE报文表示一个或者多个SSRC已经走远了。</p>
<ul>
<li>version (V), padding (P), length:<br>同上</li>
<li>packet type (PT): 8 bits<br>203表示BYE报文</li>
<li>source count (SC): 5 bits<br>退出Session的SSRC的数量</li>
</ul>
<p>如果BYE报文被Mixer收到了，Mixer应该啥都不改动，就发给下一节点。如果Mixer关闭了，它要发送一个包含它管理的所有SSRC的BYE报文。BYE报文中可能也会跟着带一些离开原因的描述。这些描述和SDES中带的描述类似，需要32对齐，用空字节填补空缺。</p>
<h3 id="APP：应用定义的RTCP报文"><a href="#APP：应用定义的RTCP报文" class="headerlink" title="APP：应用定义的RTCP报文"></a>APP：应用定义的RTCP报文</h3><p><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/rtp/rtp-app.png" alt="rtp-app"><br>APP报文一般用于实验性的功能和开发。如果识别到了不认识NAME那么上层应用一般都会忽略它。如果开发或者测试功能稳定了，一般是要通过IANA注册一个新的RTCP报文类型。</p>
<ul>
<li>version (V), padding (P), length:<br>同上</li>
<li>subtype: 5 bits<br>APP报文子类型，一般是上层应用定义。</li>
<li>packet type (PT): 8 bits<br>204表示APP类型的RTCP报文。</li>
<li>name: 4 octets<br>一般是应用名，防止subtype冲突。</li>
<li>application-dependent data: variable length<br>和上层应用相关的内容，需要32-bit对齐。</li>
</ul>
<h2 id="RTP-Translator-amp-Mixer"><a href="#RTP-Translator-amp-Mixer" class="headerlink" title="RTP Translator &amp; Mixer"></a>RTP Translator &amp; Mixer</h2><p>作为末端节点的补充，RTP引入了Translator和Mixer的概念，它们是RTP层的中间件。虽然这多少增加了协议的复杂度，但是它们对音视频通话应用来说它们还是很关键的，因为他们能解决防火墙问题和低带宽连接的问题。</p>
<h3 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h3><p>一个RTP Translator/Mixer 连接至少两个传输层的用户组。通常来说，这里提到的用户组是公共网络的概念，传输层协议会为其生成一个组播地址（ip：port）。网络层协议，像是IPv4和IPv6对RTP协议来说是隐藏的。一个系统可能会有多个Translator和Mixer（多个Session），它们中的每一个都可以看作是一个用户组的逻辑分割。<br>为了避免创建在创建Translator和Mixer造成了网络包循环，必须遵循下列规则：</p>
<ul>
<li>每个通过连接Translator和Mixer而加入Session的用户组，要么需要网络层隔离，要么最少互相知道知道（protocol，address，port）中的一个。</li>
<li>由上一个规则推广的话，各个用户组绝对不能同时连接多个Translator或者Mixer，除非有某种机制能保证他们之间数据被阻断</li>
</ul>
<p><strong>Translator</strong>：在不改变RTP报文SSRC的条件下，向后传播该报文，正因为如此，报文的接受者才能识别到Translator转发后的报文到底是来自哪个人。有些Translator可能直接转发报文，不做任何改动，也有可能改变数据编码，payload类型和时间戳。如果多个数据报文被重新编码并合并到一起的话，Translator必须为这类报文指定一个组新的序列号。这样，输入报文的丢失就会导致输出报文的断层。数据的接受者一般是不知道Translator的存在的，除非通过payload类型的不同或者传输层报文的源地址来判断。<br><strong>Mixer</strong>：从一个或多个数据源那里接收数据，随后可能会改变数据的格式，然后将这些数据合并，并传递给下家。因为多个数据源的时序并不一定是同步的，所以Mixer需要整合各个数据源的时序关系，并将其映射到自己的一套时序上，所以Mixer也是一个SSRC，所有通过Mixer的报文必须打上该Mixer的SSRC。为了表示这些数据的原始数据源，一般会通过CSRC列表来记录。有些Mixer可能自己也是一个原始数据源，所以他自己的SSRC也会出现在CSRC列表中。有些应用可能不希望Mixer的SSRC出现在CSRC中，但是这样可能就无法发现循环网络包。</p>
<p><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/rtp/rtp-translator-mixer.png" alt="rtp-translator-mixer"><br>上图是一个Mixers和Translators连接的例子。[]代表末端节点,()代表Mixer,&lt;&gt;代表Translator，”M1:48(1, 17)”表示Mixer1的报文，48是Mixer1的SSRC，括号里的1，17是CSRC，它合并了E1:17和E2:1这两个节点的数据。</p>
<h3 id="Translator处理RTCP"><a href="#Translator处理RTCP" class="headerlink" title="Translator处理RTCP"></a>Translator处理RTCP</h3><p>除了要转发数据包，进行数据包的更改，Translator和Mixer也要发送RTCP报文。在很多情况下，它会将收到的末端节点的RTCP报文合并到复合包中。当再次收到这些包时或者自己的RTCP周期到时，它会将复合包发送出去。<br>有的Translator可能对收到的RTCP报文不做任何改动，只是简单的转发这个包。如果这个Translator改变了报文数据的payload，它必须对SR或者RR做相关的改动。通常来说，Translator不能将多个数据源的SR和RR合并，因为这样会导致RTT的计算出现问题（LSR，DLSR）。</p>
<ul>
<li>SR中的发送者信息: Translator不会创建自己的发送者信息，它会将收到SR传给下家。其中SSRC不会发生任何改动，但是发送者信息有必要的话一定要做适当的改动。如果Translator改变了数据编码，那”byte count”字段就要更改。如果他将多个数据报文合并，那它需要修改”sender’s packet count”字段。如果它改变了时间频率，那就需要修改”RTP timestamp”。</li>
<li>SR/RR中的接受者信息：SSRC不会发生任何改动，如果Translator改变了序列号，那就需要修改”extended last sequence number”，在某些极端情况下，它可能完全没有接受反馈，或者根据接收到的SR/RR来构建自己的接受报告。<br>一般情况下Translator是不需要自己的SSRC的，但是如果是为了表示自己的数据接受情况，它可能也会生成自己的SSRC，并将这些RTCP报文发送过所有的连接者。</li>
<li>SDES：一般Translator收到SDES后会什么都不改就发给下家，但是也有可能为了节约带宽筛掉CNAME之外的信息的，如果Translator要发送自己的RR信息，那它一定要发送一个自己的SDES给所有连接者。</li>
<li>BYE：无改动转发，如果Translator有自己的SSRC也要发送自己的BYE。</li>
<li>APP：无改动转发。</li>
</ul>
<h3 id="Mixer处理RTCP"><a href="#Mixer处理RTCP" class="headerlink" title="Mixer处理RTCP"></a>Mixer处理RTCP</h3><p>因为Mixer会生成自己的数据流，所以他不会转发经过他的SR和RR而是为连接双方发送自己的SR和RR报文。</p>
<ul>
<li>SR的发送者信息：Mixer不转发数据来源的发送信息。它会生成自己的发送者信息并把它发送给下家。</li>
<li>SR/RR中的接受者信息：Mixer会生成自己的接受信息，然后发送给所有数据来源，它绝对不能做接受报告的转发工作，或者把自己的接收信息发给错误的对象。</li>
<li>SDES：Mixers通常会不做任何改动就转发SDES信息，但是也有可能为了节约带宽过滤除了CNAME之外的其他信息。Mixer必须发送自己的SDES报文。通常，Mixer会将多个收到的SDES打包一起发送。</li>
<li>BYE：Mixer必须转发BYE报文。如果Mixer要退出时，它会将所有数据来源的SSRC放进BYE报文，也包括自己的SSRC。</li>
<li>APP：视上层应用。</li>
</ul>
<h3 id="瀑布型Mixer"><a href="#瀑布型Mixer" class="headerlink" title="瀑布型Mixer"></a>瀑布型Mixer</h3><p><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/rtp/rtp-translator-mixer.png" alt="rtp-translator-mixer"><br>一个RTP Session可能包含多个Mixer和Translator，就像上图一样。如果Mixer是瀑布型的，就像M2和M3，一个Mixer收到的数据可能是已经合并过的，它有自己的CSRC列表。那么第二个Mixer需要将之前的CSRC和自己接受的所有SSRC合并。就像图中M3的输出是M3:89(64,45)。</p>
<h2 id="SSRC的分配和使用"><a href="#SSRC的分配和使用" class="headerlink" title="SSRC的分配和使用"></a>SSRC的分配和使用</h2><p>前面已经说过SSRC是一个随机的32-bit数，它需要在整个Session内保证唯一性。所以同一个网络下的参与者在刚加入Session时使用不同的SSRC至关重要。<br>我们不能简单的用本地的网络地址，因为可能不唯一。也不能不考虑初始状态而简单地调一个随机数函数。</p>
<h3 id="碰撞的可能性"><a href="#碰撞的可能性" class="headerlink" title="碰撞的可能性"></a>碰撞的可能性</h3><p>因为SSRC是随机选择的，这就可能多个数据源选用了相同的SSRC。如果大家是同时加入Session的话，这个碰撞的几率就更高。如果SSRC的数量是N，L是SSRC的数据长度（这里是32），那么碰撞的可能性是<code>1 - exp(-N**2 / 2**(L+1))</code>，当N=1000时，碰撞率大概是10**-4。</p>
<p>通常来说，实际的碰撞率会比上述的最坏情况要低。通常一个新节点加入时，其他节点已经有了自己的唯一SSRC，这时候碰撞的概率只是生成的新SSRC在这些现有SSRC之中的可能性。这时候碰撞率是<code>N/2**L</code>。当N=1000时，碰撞率大约是2<em>10*</em>-7。<br>因为新加入的节点会先接受一段时间的报文然后才发送自己的第一个报文，所以在它生成SSRC时可以避开已知的SSRC，这也有效的降低了碰撞的几率。</p>
<h3 id="碰撞的解决方案和循环的发现"><a href="#碰撞的解决方案和循环的发现" class="headerlink" title="碰撞的解决方案和循环的发现"></a>碰撞的解决方案和循环的发现</h3><p>通常来说SSRC碰撞的可能性很小，所有的RTP实现必须有发现冲突的机制，并在发现冲突时作出适当的处理。如果数据源发现了任何一个别的数据源和自己使用同一个SSRC，它必须用原来的SSRC发送一个BYE报文，然后选用一个新的SSRC。如果一个数据的接受者发现了多个数据源的SSRC碰撞了（通过传输地址或者CNAME），那么它会只接受其中一个人的报文，丢弃另一个人的所有报文。<br>因为整个Session中的SSRC是唯一的，所以它也可以被用来发现环型报文。环形报文会导致数据的重复以及控制信息的重复。</p>
<ul>
<li>Translator可能会错误地将报文发送回该报文来的地方。</li>
<li>两个Translator错误地同时启动，它们两个都会转发同样的数据。</li>
<li>Mixer可能会错误地将合并报文发送回这些报文来的地方。</li>
</ul>
<p>一个数据源可能发现自己的或者别人的报文被循环发送了。无论是报文循环还是SSRC的碰撞都会导致同一个现象，即SSRC相同但是传输地址不同的报文。因此，如果数据源改变了自己的传输地址，那它就需要同时改变自己的SSRC来避免被检测成环形报文。有一个需要注意的内容是，如果一个Translator再重启的过程中改变了自己的传输地址，那么这个Translator转发的所有数据都会被检测成环。这类情况的解决方案一般有如下两个：</p>
<ul>
<li>重启的时候不改变传输地址</li>
<li>接受者的超时机制</li>
</ul>
<p>如果循环或者碰撞发生在离Translator和Mixer很远的地方，我们就不能通过传输地址来发现。但是我们仍然可以通过CNAME的不同来发现SSRC碰撞。<br>为了解决上述问题，RTP的实现必须包含一个类似如下的算法。这个算法不包括多个数据源SSRC碰撞的情况，这类情况通常下都是先用原来的SSRC发送一个BYE然后重新选择一个新的SSRC。<br>这个算法需要维护一个SSRC和传输地址的映射关系。因为RTP的数据和RTCP传输使用的是两个不同的端口，所以一个SSRC对应的是两个传输地址。<br>每次收到RTP报文和RTCP报文都会将其SSRC和CSRC在上述的表中进行比对。如果发现了传输地址对不上的情况，我们就可以说发现了一个循环或者碰撞。对于RTCP数据来说，可能每个数据块都有自己独立的SSRC，比如SDES数据，对于这种情况就需要分别比对。如果没有在表中找到这个SSRC或者CSRC，就需要新添加一项。当收到BYE报文时，需要先比对这个BYE的传输地址，如果传输地址匹配上了，就将这一项从表中删除。或者基于超时机制，将超时的数据从表中移除。<br>为了追踪自己的数据报文循环情况，必须维护另一个列表，这个表存储冲突报文的传输地址和收到该报文的时间。如果超过10个RTCP周期都没有收到这个传输地址的冲突报文，就将该项从表中删除。<br>下面的算法还假设参与者自己的SSRC和状态都包含在SSRC表中，它会先比对自己的SSRC。</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (SSRC <span class="keyword">or</span> CSRC identifier is <span class="keyword">not</span> found in the source</span><br><span class="line">          identifier table) {</span><br><span class="line">          create a <span class="keyword">new</span> entry storing the data <span class="keyword">or</span> control source</span><br><span class="line">              transport address, the SSRC <span class="keyword">or</span> CSRC <span class="keyword">and</span> other state;</span><br><span class="line">      }</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Identifier is found in the table */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (table entry was created on receipt of a control packet</span><br><span class="line">         <span class="keyword">and</span> <span class="keyword">this</span> is the first data packet <span class="keyword">or</span> vice versa) {</span><br><span class="line">    store the source transport address from <span class="keyword">this</span> packet;</span><br><span class="line">}</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (source transport address from the packet does <span class="keyword">not</span> match</span><br><span class="line">         the one saved in the table entry <span class="keyword">for</span> <span class="keyword">this</span> identifier) {</span><br><span class="line">    <span class="comment">/* An identifier collision or a loop is indicated */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (source identifier is <span class="keyword">not</span> the participant<span class="number">'</span>s own) {</span><br><span class="line">        <span class="comment">/* OPTIONAL error counter step */</span></span><br><span class="line">        <span class="keyword">if</span> (source identifier is from an RTCP SDES chunk</span><br><span class="line">            containing a CNAME item that differs from the CNAME</span><br><span class="line">            in the table entry) {</span><br><span class="line">            count a third-party collision;</span><br><span class="line">        } <span class="keyword">else</span> {</span><br><span class="line">            count a third-party loop;</span><br><span class="line">        }</span><br><span class="line">        <span class="built_in">abort</span> processing of data packet <span class="keyword">or</span> control element;</span><br><span class="line">        <span class="comment">/* MAY choose a different policy to keep new source */</span></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* A collision or loop of the participant's own packets */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (source transport address is found in the <span class="built_in">list</span> of</span><br><span class="line">             conflicting data <span class="keyword">or</span> control source transport</span><br><span class="line">             addresses) {</span><br><span class="line">        <span class="comment">/* OPTIONAL error counter step */</span></span><br><span class="line">        <span class="keyword">if</span> (source identifier is <span class="keyword">not</span> from an RTCP SDES chunk</span><br><span class="line">            containing a CNAME item <span class="keyword">or</span> CNAME is the</span><br><span class="line">            participant<span class="number">'</span>s own) {</span><br><span class="line">            count occurrence of own traffic looped;</span><br><span class="line">        }</span><br><span class="line">        mark current time in conflicting address <span class="built_in">list</span> entry;</span><br><span class="line">        <span class="built_in">abort</span> processing of data packet <span class="keyword">or</span> control element;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* New collision, change SSRC identifier */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> {</span><br><span class="line">        <span class="built_in">log</span> occurrence of a collision;</span><br><span class="line">        create a <span class="keyword">new</span> entry in the conflicting data <span class="keyword">or</span> control</span><br><span class="line">            source transport address <span class="built_in">list</span> <span class="keyword">and</span> mark current time;</span><br><span class="line">        send an RTCP BYE packet with the old SSRC identifier;</span><br><span class="line">        choose a <span class="keyword">new</span> SSRC identifier;</span><br><span class="line">        create a <span class="keyword">new</span> entry in the source identifier table with</span><br><span class="line">            the old SSRC plus the source transport address from</span><br><span class="line">            the data <span class="keyword">or</span> control packet being processed;</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<h3 id="层级编码"><a href="#层级编码" class="headerlink" title="层级编码"></a>层级编码</h3><p>对于不同Session的层级编码传输，一般都是所有层都使用同一个SSRC，如果其中某一层发现了SSRC冲突，那么只改变这一层的SSRC，而且他层的SSRC不做改变。</p>
<h2 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h2><p>下层协议可能会提供RTP应用所需要的所有安全服务，包括认证，数据完整性，数据保密性。这些服务在IP协议中都有解决方案。因为Audio和Video初始化过程中需要数据加密，而这时候IP协议这一层的安全服务还没有提供。所以，RTP需要实现一个RTP专用的保密服务。这个保密服务是非常轻量级的，而且保密部分的服务向后兼容，以后可以随时进行更换。或者，某些预设会提供这部分加密服务，比如SRTP（Secure Real-time Transport Protocol），SRTP是基于Advanced Encryption Standard (AES)提供了一个比RTP默认加密服务更强大的实现。</p>
<h3 id="保密性"><a href="#保密性" class="headerlink" title="保密性"></a>保密性</h3><p>保密性是指我们的报文只希望一些特定的接受者可以解码成明文，而其他人只能得到无用的信息，保密性是通过加密编码来提供的。<br>当需要为RTP和RTCP报文提供加密服务时，所有传输的内容都会在下层报文那里进行加密。对于RTCP来说，需要一个32-bit的随机数作为前缀。而RTP报文不需要前缀，取而代之的是随机序列号和时间戳偏移。因为随机部分很少，所以可以说这是一个非常弱的<span class="exturl" data-url="aHR0cHM6Ly96aC53aWtpcGVkaWEub3JnL3dpa2kvJUU1JTg4JTlEJUU1JUE3JThCJUU1JTkwJTkxJUU5JTg3JThG" title="https://zh.wikipedia.org/wiki/%E5%88%9D%E5%A7%8B%E5%90%91%E9%87%8F">初始向量<i class="fa fa-external-link"></i></span>。此外，SSRC也可被破解者修改，这是这个加密方案的另一个薄弱的环节。<br>对于RTCP来说，可能会将一个复合包分成两批，第一批加密，后一批明文发送。例如，SDES部分的信息可能加密，而接受报告部分不加密就发送出去，因为只有这样那些第三方监控器才能在不知道密钥的情况下统计网络状况。如下图所示，SDES信息必须跟在一个空的RR后，并且要有一个随机前缀。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/rtp/rtp-encryption.png" alt="rtp-encryption"><br>RTP协议使用的Data Encryption Standard (DES)算法，使用cipher block chaining(CBC)模式，这需要数据填充到64-bit对齐。密码算法使用零作为初始向量，因为RTCP报文中已经有一个随机前缀了。<br>RTP之所以选择这个默认协议是因为它用起来很容易，但是因为DES太容易破解了。所以推荐预设中使用更健壮的加密算法来替换这个默认方案，例如Triple-DES。这些算法普遍需要一个随机初始化块，RTCP使用了32-bit的随机数作为前缀，RTP使用了时间戳和序列号的随机偏移，可是相邻的RTP报文之间的随机性就很差。需要注意的是，无论是RTCP还是RTP，它们的随机性都有限。加密型更好的应用，需要考虑更多的保密措施。例如SRTP配置文件，就基于AES来加密，它的加密方案就更完备，选择这个预设来使用RTP就挺不错的。<br>前面提到过也可以用IP级的加密方案或者RTP级的加密，一些预设可能会定义别的payload类型来加密。这种方案，可能只加密payload部分而头部分使用明文，因为只有payload部分才是应用真正需要的内容。这可能对硬件设备来说非常有用，它即处理解密过程，又处理解码过程。</p>
<h3 id="身份认证和消息完整性"><a href="#身份认证和消息完整性" class="headerlink" title="身份认证和消息完整性"></a>身份认证和消息完整性</h3><p>RTP协议这一层没有身份认证和消息完整性服务，因为有些上层服务可能没有认证就能使用。而消息完整性服务依赖下层协议来实现。</p>
<h2 id="拥塞控制"><a href="#拥塞控制" class="headerlink" title="拥塞控制"></a>拥塞控制</h2><p>所有的网络传输协议都需要拥塞控制，RTP也不例外，但是因为RTP的数据传输不会发生特别大的激变（固定频率发送，控制了带宽），所以RTP的拥塞控制会和TCP这类的实现有很大差别，RTP不会像TCP那样占用所有带宽。RTP的这种数据传输模式虽然降低了拥塞的风险，但是一旦发生了拥塞，也不能莽莽地减少网络负载。<br>因为RTP面向的是各种各样的上层应用，没有一个拥塞控制机制能适用于所有的情况。因此，拥塞控制部分应该定义在预设中，或者上层应用中。在有些预设中，会根据RTCP的反馈来适当的调整数据传输带宽。</p>
<h2 id="RTP下的网络层和传输层协议"><a href="#RTP下的网络层和传输层协议" class="headerlink" title="RTP下的网络层和传输层协议"></a>RTP下的网络层和传输层协议</h2><p>RTP需要下层协议提供多路复用机制。对于UDP这类应用，推荐RTP应该使用一个偶数端口传输数据，和它相关的RTCP流应该是用高一位的奇数端口。在单播模式下，每个参与者都需要一对端口来传输RTP和RTCP报文。两个参与者可能使用相同的端口。绝对不能以接收到的报文网络地址直接作为目标地址发送报文。<br>建议层编码模式是，使用相邻的端口，因此对于层N来说，数据端口是P+2N，控制端口是P+2N+1。对于IP组播来说，可能不会得到相邻的组播地址。<br>RTP数据报文没有描述报文长度的信息。所以RTP报文依赖下层协议提供长度标识。所以一个RTP报文的最大长度由下层协议限制。<br>如果RTP报文使用的下层协议是流传输协议的话，必须定义一套数据帧分割机制。</p>
<h2 id="参考内容"><a href="#参考内容" class="headerlink" title="参考内容"></a>参考内容</h2><p>[1] <span class="exturl" data-url="aHR0cHM6Ly90b29scy5pZXRmLm9yZy9odG1sL3JmYzM1NTA=" title="https://tools.ietf.org/html/rfc3550">rfc3550<i class="fa fa-external-link"></i></span></p>

    </div>

    
    
    

      
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
  <img id="wechat_subscriber_qcode" src="/images/qrcode_for_wechat.jpg" alt="贝克街的流浪猫 wechat" style="width: 400px; max-width: 100%;">
  <div></div>
</div>

      
        <div class="reward-container">
  <div>您的打赏将鼓励我继续分享!</div>
  <button disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechat.jpg" alt="贝克街的流浪猫 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpg" alt="贝克街的流浪猫 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>贝克街的流浪猫
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://www.beikejiedeliulangmao.top/protocol/rtp/" title="流媒体传输协议之 RTP">https://www.beikejiedeliulangmao.top/protocol/rtp/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9udWxs"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议，转载请注明出处！
  </li>
  <li class="post-copyright-license">
    <strong>创作声明： </strong>本文基于上述所有参考内容进行创作，其中可能涉及复制、修改或者转换，图片均来自网络，如有侵权请联系我，我会第一时间进行删除。
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Stream-Media/" rel="tag"># Stream Media</a>
              <a href="/tags/RTP/" rel="tag"># RTP</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/webrtc/nat-traversal/" rel="next" title="NAT 穿透">
                  <i class="fa fa-chevron-left"></i> NAT 穿透
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/protocol/rtmp/" rel="prev" title="流媒体传输协议之 RTMP">
                  流媒体传输协议之 RTMP <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="gitalk-container"></div>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%95%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">引言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%8B%E7%BB%8D"><span class="nav-number">2.</span> <span class="nav-text">介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RTP%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">3.</span> <span class="nav-text">RTP的使用场景</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E7%9A%84%E5%A4%9A%E6%92%AD%E9%9F%B3%E9%A2%91%E4%BC%9A%E8%AE%AE"><span class="nav-number">3.1.</span> <span class="nav-text">简单的多播音频会议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%9F%B3%E9%A2%91%E5%92%8C%E8%A7%86%E9%A2%91%E4%BC%9A%E8%AE%AE"><span class="nav-number">3.2.</span> <span class="nav-text">音频和视频会议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mixers-amp-Translators"><span class="nav-number">3.3.</span> <span class="nav-text">Mixers &amp; Translators</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B1%82%E7%BC%96%E7%A0%81"><span class="nav-number">3.4.</span> <span class="nav-text">层编码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9A%E4%B9%89"><span class="nav-number">4.</span> <span class="nav-text">定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AD%97%E8%8A%82%E5%BA%8F%EF%BC%8C%E6%95%B0%E6%8D%AE%E5%AF%B9%E9%BD%90%EF%BC%8C%E6%97%B6%E9%97%B4%E6%A0%BC%E5%BC%8F"><span class="nav-number">5.</span> <span class="nav-text">字节序，数据对齐，时间格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RTP%E6%95%B0%E6%8D%AE%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE"><span class="nav-number">6.</span> <span class="nav-text">RTP数据传输协议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RTP%E7%9A%84%E5%AE%9A%E9%95%BF%E5%A4%B4%E5%AD%97%E6%AE%B5"><span class="nav-number">6.1.</span> <span class="nav-text">RTP的定长头字段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RTP-Session%E5%A4%9A%E8%B7%AF%E5%A4%8D%E7%94%A8"><span class="nav-number">6.2.</span> <span class="nav-text">RTP Session多路复用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%A2%84%E8%AE%BE%E5%8F%AF%E8%83%BD%E5%AF%B9RTP%E5%A4%B4%E7%9A%84%E6%94%B9%E5%8A%A8"><span class="nav-number">6.3.</span> <span class="nav-text">预设可能对RTP头的改动</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#RTP%E5%A4%B4%E6%8B%93%E5%B1%95"><span class="nav-number">6.3.1.</span> <span class="nav-text">RTP头拓展</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RTP%E6%8E%A7%E5%88%B6%E5%8D%8F%E8%AE%AE"><span class="nav-number">7.</span> <span class="nav-text">RTP控制协议</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#RTCP%E5%8C%85%E6%A0%BC%E5%BC%8F"><span class="nav-number">7.1.</span> <span class="nav-text">RTCP包格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RTCP%E4%BC%A0%E8%BE%93%E5%91%A8%E6%9C%9F"><span class="nav-number">7.2.</span> <span class="nav-text">RTCP传输周期</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%B4%E6%8A%A4Session%E6%88%90%E5%91%98%E7%9A%84%E6%95%B0%E9%87%8F"><span class="nav-number">7.2.1.</span> <span class="nav-text">维护Session成员的数量</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#RTCP%E6%8A%A5%E6%96%87%E7%9A%84%E6%94%B6%E5%8F%91%E8%A7%84%E5%88%99"><span class="nav-number">7.3.</span> <span class="nav-text">RTCP报文的收发规则</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%A1%E7%AE%97RTCP%E5%8F%91%E9%80%81%E9%97%B4%E9%9A%94"><span class="nav-number">7.3.1.</span> <span class="nav-text">计算RTCP发送间隔</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">7.3.2.</span> <span class="nav-text">初始化</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%A5%E5%8F%97RTP%E5%92%8CNon-BYE-RTCP%E5%8C%85"><span class="nav-number">7.3.3.</span> <span class="nav-text">接受RTP和Non-BYE RTCP包</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8E%A5%E5%8F%97RTCP-BYE%E6%8A%A5%E6%96%87"><span class="nav-number">7.3.4.</span> <span class="nav-text">接受RTCP BYE报文</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SSRC%E7%9A%84%E8%B6%85%E6%97%B6"><span class="nav-number">7.3.5.</span> <span class="nav-text">SSRC的超时</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%91%E9%80%81%E5%80%92%E8%AE%A1%E6%97%B6"><span class="nav-number">7.3.6.</span> <span class="nav-text">发送倒计时</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%91%E9%80%81BYE%E6%8A%A5%E6%96%87"><span class="nav-number">7.3.7.</span> <span class="nav-text">发送BYE报文</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9B%B4%E6%96%B0WE-Sent"><span class="nav-number">7.3.8.</span> <span class="nav-text">更新WE_Sent</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SDES%E7%B1%BB%E6%8A%A5%E6%96%87%E7%9A%84%E5%B8%A6%E5%AE%BD%E5%88%86%E9%85%8D"><span class="nav-number">7.3.9.</span> <span class="nav-text">SDES类报文的带宽分配</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Sender-amp-Receiver%E6%8A%A5%E5%91%8A"><span class="nav-number">7.4.</span> <span class="nav-text">Sender &amp; Receiver报告</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SR%E6%8A%A5%E6%96%87"><span class="nav-number">7.4.1.</span> <span class="nav-text">SR报文</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RR%E6%8A%A5%E6%96%87"><span class="nav-number">7.4.2.</span> <span class="nav-text">RR报文</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%91%E9%80%81-%E6%8E%A5%E5%8F%97%E6%8A%A5%E6%96%87%E7%9A%84%E6%8B%93%E5%B1%95"><span class="nav-number">7.4.3.</span> <span class="nav-text">发送/接受报文的拓展</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%88%86%E6%9E%90%E5%8F%91%E9%80%81%E6%8A%A5%E5%91%8A%E5%92%8C%E6%8E%A5%E5%8F%97%E6%8A%A5%E5%91%8A"><span class="nav-number">7.4.4.</span> <span class="nav-text">分析发送报告和接受报告</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SDES%E6%8A%A5%E6%96%87"><span class="nav-number">7.5.</span> <span class="nav-text">SDES报文</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#CNAME%EF%BC%9A%E6%9D%83%E5%A8%81%E7%9A%84%E6%9C%AB%E7%AB%AF%E8%8A%82%E7%82%B9%E8%BA%AB%E4%BB%BD%E6%A0%87%E8%AF%86"><span class="nav-number">7.5.1.</span> <span class="nav-text">CNAME：权威的末端节点身份标识</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NAME%EF%BC%9A%E7%94%A8%E6%88%B7%E5%90%8D"><span class="nav-number">7.5.2.</span> <span class="nav-text">NAME：用户名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#EMAIL%EF%BC%9A%E7%94%B5%E5%AD%90%E9%82%AE%E7%AE%B1%E5%9C%B0%E5%9D%80"><span class="nav-number">7.5.3.</span> <span class="nav-text">EMAIL：电子邮箱地址</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PHONE%EF%BC%9A%E7%94%B5%E8%AF%9D%E5%8F%B7%E7%A0%81"><span class="nav-number">7.5.4.</span> <span class="nav-text">PHONE：电话号码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#LOC%EF%BC%9A%E7%94%A8%E6%88%B7%E5%9C%B0%E7%90%86%E5%9C%B0%E5%9D%80"><span class="nav-number">7.5.5.</span> <span class="nav-text">LOC：用户地理地址</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#TOOL%EF%BC%9A%E5%BA%94%E7%94%A8%E5%90%8D%E6%88%96%E5%B7%A5%E5%85%B7%E5%90%8D"><span class="nav-number">7.5.6.</span> <span class="nav-text">TOOL：应用名或工具名</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NOTE%EF%BC%9A%E6%8F%90%E9%86%92-%E7%8A%B6%E6%80%81"><span class="nav-number">7.5.7.</span> <span class="nav-text">NOTE：提醒/状态</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#PRIV%EF%BC%9A%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8B%93%E5%B1%95"><span class="nav-number">7.5.8.</span> <span class="nav-text">PRIV：自定义拓展</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BYE%E6%8A%A5%E6%96%87"><span class="nav-number">7.6.</span> <span class="nav-text">BYE报文</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#APP%EF%BC%9A%E5%BA%94%E7%94%A8%E5%AE%9A%E4%B9%89%E7%9A%84RTCP%E6%8A%A5%E6%96%87"><span class="nav-number">7.7.</span> <span class="nav-text">APP：应用定义的RTCP报文</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RTP-Translator-amp-Mixer"><span class="nav-number">8.</span> <span class="nav-text">RTP Translator &amp; Mixer</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%8F%E8%BF%B0"><span class="nav-number">8.1.</span> <span class="nav-text">描述</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Translator%E5%A4%84%E7%90%86RTCP"><span class="nav-number">8.2.</span> <span class="nav-text">Translator处理RTCP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Mixer%E5%A4%84%E7%90%86RTCP"><span class="nav-number">8.3.</span> <span class="nav-text">Mixer处理RTCP</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%80%91%E5%B8%83%E5%9E%8BMixer"><span class="nav-number">8.4.</span> <span class="nav-text">瀑布型Mixer</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#SSRC%E7%9A%84%E5%88%86%E9%85%8D%E5%92%8C%E4%BD%BF%E7%94%A8"><span class="nav-number">9.</span> <span class="nav-text">SSRC的分配和使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A2%B0%E6%92%9E%E7%9A%84%E5%8F%AF%E8%83%BD%E6%80%A7"><span class="nav-number">9.1.</span> <span class="nav-text">碰撞的可能性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A2%B0%E6%92%9E%E7%9A%84%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E5%92%8C%E5%BE%AA%E7%8E%AF%E7%9A%84%E5%8F%91%E7%8E%B0"><span class="nav-number">9.2.</span> <span class="nav-text">碰撞的解决方案和循环的发现</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B1%82%E7%BA%A7%E7%BC%96%E7%A0%81"><span class="nav-number">9.3.</span> <span class="nav-text">层级编码</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%89%E5%85%A8"><span class="nav-number">10.</span> <span class="nav-text">安全</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BF%9D%E5%AF%86%E6%80%A7"><span class="nav-number">10.1.</span> <span class="nav-text">保密性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E5%92%8C%E6%B6%88%E6%81%AF%E5%AE%8C%E6%95%B4%E6%80%A7"><span class="nav-number">10.2.</span> <span class="nav-text">身份认证和消息完整性</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6"><span class="nav-number">11.</span> <span class="nav-text">拥塞控制</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#RTP%E4%B8%8B%E7%9A%84%E7%BD%91%E7%BB%9C%E5%B1%82%E5%92%8C%E4%BC%A0%E8%BE%93%E5%B1%82%E5%8D%8F%E8%AE%AE"><span class="nav-number">12.</span> <span class="nav-text">RTP下的网络层和传输层协议</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E5%86%85%E5%AE%B9"><span class="nav-number">13.</span> <span class="nav-text">参考内容</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="贝克街的流浪猫" src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">贝克街的流浪猫</p>
  <div class="site-description" itemprop="description">贝贝猫</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">120</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">158</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0JlaUtlSmllRGVMaXVMYW5nTWFv" title="GitHub → https://github.com/BeiKeJieDeLiuLangMao"><i class="fa fa-fw fa-github"></i></span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vY18xMTY3NDI5NTg4NzExMzM3OTg1" title="知乎 → https://zhuanlan.zhihu.com/c_1167429588711337985"><i class="fa fa-fw fa-book"></i></span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOjUxNzM3NTY4NUBxcS5jb20=" title="E-Mail → mailto:517375685@qq.com"><i class="fa fa-fw fa-envelope"></i></span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS91c2Vycy84NzgyOTY0L3lhbmctY2hlbj90YWI9cHJvZmlsZQ==" title="StackOverflow → https://stackoverflow.com/users/8782964/yang-chen?tab=profile"><i class="fa fa-fw fa-stack-overflow"></i></span>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        
  <div class="beian"><span class="exturl" data-url="aHR0cDovL3d3dy5iZWlhbi5taWl0Lmdvdi5jbg==">辽ICP备19017854号 </span>
  </div>

<div class="copyright">
  
  © 2019 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">贝克街的流浪猫</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">1.5m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 ≈</span>
    <span title="站点阅读时长">22:36</span>
</div>

        
<div class="busuanzi-count">
  <script async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        贝贝猫有
        <span id="busuanzi_value_site_uv"></span>
        位同学
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        笔记被翻阅
        <span id="busuanzi_value_site_pv"></span>
        次
      </span>
    </span>
</div>






  






        
      </div>
    </footer>
  </div>

  
  
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  
  














  
  




  

<script src="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.js"></script>

















  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  







<script type="text/javascript" src="/bundle.js"></script><script type="text/javascript">function leancloudSelector(url) {
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = visitors.getAttribute('id').trim();
      var title = visitors.getAttribute('data-flag-title').trim();

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
              leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .catch(error => {
                console.log('Failed to save visitor count', error);
              })
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return element.getAttribute('id').trim();
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            leancloudSelector(url).innerText = time;
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=gmT3IkYtHVMymcwAjbwHhtiv-gzGzoHsz')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id': 'gmT3IkYtHVMymcwAjbwHhtiv-gzGzoHsz',
            'X-LC-Key': 'co6tpmcyS9za2D1uqQyMFtnN',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        const localhost = /http:\/\/(localhost|127.0.0.1|0.0.0.0)/;
        if (localhost.test(document.URL)) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });;(function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();;if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme: 'forest',
      logLevel: 3,
      flowchart: { curve: 'linear' },
      gantt: { axisFormat: '%m/%d/%Y' },
      sequence: { actorMargin: 50 }
    });
  }, window.mermaid);
};window.addEventListener('load', () => {
      quicklink({
        timeout: 3000,
        priority: true,
        ignores: [uri => uri.includes('#'),uri => uri == 'https://www.beikejiedeliulangmao.top/protocol/rtp/',]
      });
      });;NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '6201d1cc2825a93aa161',
      clientSecret: '71c60f650595a3eedba64b844f811b90acac3798',
      repo: 'HexoBlogComment',
      owner: 'BeiKeJieDeLiuLangMao',
      admin: ['BeiKeJieDeLiuLangMao'],
      id: '86bfbec2afa649311af0429e376b8b28',
        language: 'zh-CN',
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);;window.imageLazyLoadSetting = {
                isSPA: false,
                processImages: null,
            };;window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});;!function(n){n.imageLazyLoadSetting.processImages=o;var i=n.imageLazyLoadSetting.isSPA,l=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){i&&(l=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var r=0;r<l.length;r++)t=l[r],void 0,0<=(e=t.getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(n.innerHeight||document.documentElement.clientHeight)&&function(t){var e,n,i,o,a=l[r];e=a,n=function(){l=l.filter(function(t){return a!==t})},i=new Image,o=e.getAttribute("data-original"),i.onload=function(){e.src=o,n&&n()},i.src=o}();var t,e}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body></html>