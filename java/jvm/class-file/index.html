<!DOCTYPE html><html lang="zh-CN"><head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/avatar.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/avatar.jpg">
  <link rel="mask-icon" href="/images/avatar.jpg" color="#222">
  <link rel="alternate" href="/atom.xml" title="贝克街的流浪猫" type="application/atom+xml">
  <meta http-equiv="Cache-Control" content="no-transform">
  <meta http-equiv="Cache-Control" content="no-siteapp">
  <meta name="google-site-verification" content="PB8pKbwvyCztAdFAxM1AdLMfqXY7wDk6xWZIy3BYn0M">
  <meta name="baidu-site-verification" content="lHxDkbImj8">





  
  


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.5.0',
    exturl: true,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":null},
    back2top: {"enable":true,"sidebar":true,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: true,
    lazyload: false,
    pangu: true,
    algolia: {
      appID: 'XKULKGLQCN',
      apiKey: '59d463bff59108a7719f93aa31f249f3',
      indexName: 'Hexo Blog',
      hits: {"per_page":10},
      labels: {"input_placeholder":"文章查询","hits_empty":"很抱歉，贝贝猫没有发表关于 \"${query}\" 的文章","hits_stats":"找到了 ${hits} 篇文章，耗时 ${time} 毫秒"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="引言本文着重介绍 JVM 中 Class 文件相关的内容，更多关于 JVM 的文章均收录于<JVM系列文章>。">
<meta property="og:type" content="article">
<meta property="og:title" content="JVM Class 文件结构">
<meta property="og:url" content="https://www.beikejiedeliulangmao.top/java/jvm/class-file/index.html">
<meta property="og:site_name" content="贝克街的流浪猫">
<meta property="og:description" content="引言本文着重介绍 JVM 中 Class 文件相关的内容，更多关于 JVM 的文章均收录于<JVM系列文章>。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="og:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">
<meta property="article:published_time" content="2019-12-16T07:39:17.000Z">
<meta property="article:modified_time" content="2021-01-17T04:25:41.386Z">
<meta property="article:author" content="贝克街的流浪猫">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="JVM">
<meta property="article:tag" content="HotSpot">
<meta property="article:tag" content="ClassFile">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.beikejiedeliulangmao.top/images/loading-cat.gif">

<link rel="canonical" href="https://www.beikejiedeliulangmao.top/java/jvm/class-file/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>JVM Class 文件结构 | 贝克街的流浪猫</title>
  
    <script>
      function sendPageView() {
        var host = window.location.hostname;
        if (host == "localhost" && true) return;
        var uid = localStorage.getItem('uid') || (Math.random() + '.' + Math.random());
        localStorage.setItem('uid', uid);
        navigator.sendBeacon('https://www.google-analytics.com/collect', new URLSearchParams({
          v  : 1,
          tid: 'UA-146830566-1',
          cid: uid,
          t  : 'pageview',
          dp : encodeURIComponent(location.pathname)
        }));
      }
      document.addEventListener('pjax:complete', sendPageView);
      sendPageView();
    </script>


  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?818a8e6061ff2bd0b5531a739f216601";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <style>body {
  background-image: url("https://www.beikejiedeliulangmao.top/images/background.jpeg") !important;
  background-attachment: fixed !important;
  background-repeat: no-repeat !important;
  background-size: 100% 100% !important;
}
.bg_content {
  position: fixed;
  top: 0;
  z-index: -1;
  width: 100%;
  height: 100%;
}
.copyright {
  color: #000;
}
::-webkit-scrollbar {
  width: 8px;
  height: 8px;
  background-color: #fff;
}
::-webkit-scrollbar-button {
  width: 0;
  height: 0;
}
::-webkit-scrollbar-button:start:increment,
::-webkit-scrollbar-button:end:decrement {
  display: none;
}
::-webkit-scrollbar-corner {
  display: block;
}
::-webkit-scrollbar-thumb {
  border-radius: 6px;
  background-color: rgba(0,0,0,0.4);
}
::-webkit-scrollbar-thumb:hover {
  border-radius: 6px;
  background-color: rgba(0,0,0,0.6);
}
::-webkit-scrollbar-track,
::-webkit-scrollbar-thumb {
  border-right: 1px solid transparent;
  border-left: 1px solid transparent;
}
::-webkit-scrollbar-button:start {
  width: 8px;
  height: 8px;
}
::-webkit-scrollbar-button:end {
  width: 6px;
  height: 6px;
}
html {
  line-height: 1.15; 
  -webkit-text-size-adjust: 100%; 
}
body {
  margin: 0;
}
main {
  display: block;
}
h1 {
  font-size: 2em;
  margin: 0.67em 0;
}
hr {
  box-sizing: content-box; 
  height: 0; 
  overflow: visible; 
}
pre {
  font-family: monospace, monospace; 
  font-size: 1em; 
}
a {
  background: transparent;
}
abbr[title] {
  border-bottom: none; 
  text-decoration: underline; 
  text-decoration: underline dotted; 
}
b,
strong {
  font-weight: bolder;
}
code,
kbd,
samp {
  font-family: monospace, monospace; 
  font-size: 1em; 
}
small {
  font-size: 80%;
}
sub,
sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
sub {
  bottom: -0.25em;
}
sup {
  top: -0.5em;
}
img {
  border-style: none;
}
button,
input,
optgroup,
select,
textarea {
  font-family: inherit; 
  font-size: 100%; 
  line-height: 1.15; 
  margin: 0; 
}
button,
input {

  overflow: visible;
}
button,
select {

  text-transform: none;
}
button,
[type='button'],
[type='reset'],
[type='submit'] {
  -webkit-appearance: button;
}
button::-moz-focus-inner,
[type='button']::-moz-focus-inner,
[type='reset']::-moz-focus-inner,
[type='submit']::-moz-focus-inner {
  border-style: none;
  padding: 0;
}
button:-moz-focusring,
[type='button']:-moz-focusring,
[type='reset']:-moz-focusring,
[type='submit']:-moz-focusring {
  outline: 1px dotted ButtonText;
}
fieldset {
  padding: 0.35em 0.75em 0.625em;
}
legend {
  box-sizing: border-box; 
  color: inherit; 
  display: table; 
  max-width: 100%; 
  padding: 0; 
  white-space: normal; 
}
progress {
  vertical-align: baseline;
}
textarea {
  overflow: auto;
}
[type='checkbox'],
[type='radio'] {
  box-sizing: border-box; 
  padding: 0; 
}
[type='number']::-webkit-inner-spin-button,
[type='number']::-webkit-outer-spin-button {
  height: auto;
}
[type='search'] {
  outline-offset: -2px; 
  -webkit-appearance: textfield; 
}
[type='search']::-webkit-search-decoration {
  -webkit-appearance: none;
}
::-webkit-file-upload-button {
  font: inherit; 
  -webkit-appearance: button; 
}
details {
  display: block;
}
summary {
  display: list-item;
}
template {
  display: none;
}
[hidden] {
  display: none;
}
::selection {
  background: #262a30;
  color: #fff;
}
html,
body {
  height: 100%;
}
body {
  background: #eee;
  color: #555;
  font-family: 'Monda', "PingFang SC", "Microsoft YaHei", sans-serif;
  font-size: 1em;
  line-height: 2;
}
@media (max-width: 991px) {
  body {
    padding-left: 0 !important;
    padding-right: 0 !important;
  }
}
h1,
h2,
h3,
h4,
h5,
h6 {
  font-family: 'Roboto Slab', 'Monda', "PingFang SC", "Microsoft YaHei", sans-serif;
  font-weight: bold;
  line-height: 1.5;
  margin: 20px 0 15px;
  padding: 0;
}
h1 {
  font-size: 1.5em;
}
h2 {
  font-size: 1.375em;
}
h3 {
  font-size: 1.25em;
}
h4 {
  font-size: 1.125em;
}
h5 {
  font-size: 1em;
}
h6 {
  font-size: 0.875em;
}
p {
  margin: 0 0 20px 0;
}
a,
span.exturl {
  border-bottom: 1px solid #999;
  color: #555;
  outline: 0;
  text-decoration: none;
  overflow-wrap: break-word;
  word-wrap: break-word;
  cursor: pointer;
}
a:hover,
span.exturl:hover {
  border-bottom-color: #222;
  color: #222;
}
iframe,
img,
video {
  display: block;
  margin-left: auto;
  margin-right: auto;
  max-width: 100%;
}
hr {
  background-color: #ddd;
  background-image: repeating-linear-gradient(-45deg, #fff, #fff 4px, transparent 4px, transparent 8px);
  border: 0;
  height: 3px;
  margin: 40px 0;
}
blockquote {
  border-left: 4px solid #ddd;
  color: #666;
  margin: 0;
  padding: 0 15px;
}
blockquote cite::before {
  content: '-';
  padding: 0 5px;
}
dt {
  font-weight: 700;
}
dd {
  margin: 0;
  padding: 0;
}
kbd {
  background-color: #f5f5f5;
  background-image: linear-gradient(#eee, #fff, #eee);
  border: 1px solid #ccc;
  border-radius: 0.2em;
  box-shadow: 0.1em 0.1em 0.2em rgba(0,0,0,0.1);
  font-family: inherit;
  padding: 0.1em 0.3em;
  white-space: nowrap;
}
.table-container {
  -webkit-overflow-scrolling: touch;
  overflow: auto;
}
table {
  border-collapse: collapse;
  border-spacing: 0;
  font-size: 0.875em;
  margin: 0 0 20px 0;
  width: 100%;
}
tbody tr:nth-of-type(odd) {
  background: #f9f9f9;
}
tbody tr:hover {
  background: #f5f5f5;
}
caption,
th,
td {
  font-weight: normal;
  padding: 8px;
  text-align: left;
  vertical-align: middle;
}
th,
td {
  border: 1px solid #ddd;
  border-bottom: 3px solid #ddd;
}
th {
  font-weight: 700;
  padding-bottom: 10px;
}
td {
  border-bottom-width: 1px;
}
.btn {
  background: #fff;
  border: 2px solid #555;
  border-radius: 2px;
  color: #555;
  display: inline-block;
  font-size: 0.875em;
  line-height: 2;
  padding: 0 20px;
  text-decoration: none;
  transition-property: background-color;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.btn:hover {
  background: #222;
  border-color: #222;
  color: #fff;
}
.btn + .btn {
  margin: 0 0 8px 8px;
}
.btn .fa-fw {
  text-align: left;
  width: 1.285714285714286em;
}
.toggle {
  line-height: 0;
}
.toggle .toggle-line {
  background: #fff;
  display: inline-block;
  height: 2px;
  left: 0;
  position: relative;
  top: 0;
  transition: all 0.4s;
  vertical-align: top;
  width: 100%;
}
.toggle .toggle-line:not(:first-child) {
  margin-top: 3px;
}
.toggle.toggle-arrow .toggle-line-first {
  left: 50%;
  top: 2px;
  transform: rotate(45deg);
  width: 50%;
}
.toggle.toggle-arrow .toggle-line-middle {
  left: 2px;
  width: 90%;
}
.toggle.toggle-arrow .toggle-line-last {
  left: 50%;
  top: -2px;
  transform: rotate(-45deg);
  width: 50%;
}
.toggle.toggle-close .toggle-line-first {
  transform: rotate(-45deg);
  top: 5px;
}
.toggle.toggle-close .toggle-line-middle {
  opacity: 0;
}
.toggle.toggle-close .toggle-line-last {
  transform: rotate(45deg);
  top: -5px;
}
.highlight-container {
  position: relative;
}
.highlight-container:hover .copy-btn,
.highlight-container .copy-btn:focus {
  opacity: 1;
}
.copy-btn {
  color: #333;
  cursor: pointer;
  display: inline-block;
  font-weight: 700;
  line-height: 1.6;
  opacity: 0;
  outline: 0;
  padding: 2px 6px;
  position: absolute;
  transition: opacity 0.3s ease-in-out;
  vertical-align: middle;
  white-space: nowrap;
  -moz-user-select: none;
  -ms-user-select: none;
  -webkit-user-select: none;
  user-select: none;
  background-color: #eee;
  background-image: linear-gradient(#fcfcfc, #eee);
  border: 1px solid #d5d5d5;
  border-radius: 3px;
  font-size: 0.8125em;
  right: 4px;
  top: 8px;
}
.highlight,
pre {
  background: #f7f7f7;
  color: #4d4d4c;
  line-height: 1.6;
  margin: 0 auto 20px;
}
pre,
code {
  font-family: 'PT Mono', consolas, Menlo, monospace, "PingFang SC", "Microsoft YaHei";
}
code {
  background: #eee;
  border-radius: 3px;
  color: #555;
  padding: 2px 4px;
  overflow-wrap: break-word;
  word-wrap: break-word;
}
.highlight *::selection {
  background: #d6d6d6;
}
.highlight pre {
  border: 0;
  margin: 0;
  padding: 0;
}
.highlight table {
  border: 0;
  margin: 0;
  width: auto;
}
.highlight tr:first-child pre {
  padding-top: 10px;
}
.highlight tr:last-child pre {
  padding-bottom: 10px;
}
.highlight td {
  border: 0;
  padding: 0;
}
.highlight figcaption {
  background: #eee;
  color: #4d4d4c;
  font-size: 0.875em;
  line-height: 1.2;
  padding: 0.5em;
}
.highlight figcaption::before,
.highlight figcaption::after {
  content: ' ';
  display: table;
}
.highlight figcaption::after {
  clear: both;
}
.highlight figcaption a {
  color: #4d4d4c;
  float: right;
}
.highlight figcaption a:hover {
  border-bottom-color: #4d4d4c;
}
.highlight .gutter pre {
  background: #eff2f3;
  color: #869194;
  padding-left: 10px;
  padding-right: 10px;
  text-align: right;
  -moz-user-select: none;
  -ms-user-select: none;
  -webkit-user-select: none;
  user-select: none;
}
.highlight .code pre {
  background: #f7f7f7;
  padding-left: 10px;
  width: 100%;
}
.gist table {
  width: auto;
}
.gist table td {
  border: 0;
}
pre {
  overflow: auto;
  padding: 10px;
}
pre code {
  background: none;
  color: #4d4d4c;
  font-size: 0.875em;
  padding: 0;
  text-shadow: none;
}
pre .deletion {
  background: #fdd;
}
pre .addition {
  background: #dfd;
}
pre .meta {
  color: #eab700;
  -moz-user-select: none;
  -ms-user-select: none;
  -webkit-user-select: none;
  user-select: none;
}
pre .comment {
  color: #8e908c;
}
pre .variable,
pre .attribute,
pre .tag,
pre .name,
pre .regexp,
pre .ruby .constant,
pre .xml .tag .title,
pre .xml .pi,
pre .xml .doctype,
pre .html .doctype,
pre .css .id,
pre .css .class,
pre .css .pseudo {
  color: #c82829;
}
pre .number,
pre .preprocessor,
pre .built_in,
pre .builtin-name,
pre .literal,
pre .params,
pre .constant,
pre .command {
  color: #f5871f;
}
pre .ruby .class .title,
pre .css .rules .attribute,
pre .string,
pre .symbol,
pre .value,
pre .inheritance,
pre .header,
pre .ruby .symbol,
pre .xml .cdata,
pre .special,
pre .formula {
  color: #718c00;
}
pre .title,
pre .css .hexcolor {
  color: #3e999f;
}
pre .function,
pre .python .decorator,
pre .python .title,
pre .ruby .function .title,
pre .ruby .title .keyword,
pre .perl .sub,
pre .javascript .title,
pre .coffeescript .title {
  color: #4271ae;
}
pre .keyword,
pre .javascript .function {
  color: #8959a8;
}
.blockquote-center {
  border-left: none;
  margin: 40px 0;
  padding: 0;
  position: relative;
  text-align: center;
}
.blockquote-center::before,
.blockquote-center::after {
  background-repeat: no-repeat;
  background-size: 22px 22px;
  content: ' ';
  display: block;
  height: 24px;
  opacity: 0.2;
  position: absolute;
  width: 100%;
}
.blockquote-center::before {
  background-image: url("../images/quote-l.svg");
  background-position: 0 -6px;
  border-top: 1px solid #ccc;
  top: -20px;
}
.blockquote-center::after {
  background-image: url("../images/quote-r.svg");
  background-position: 100% 8px;
  border-bottom: 1px solid #ccc;
  bottom: -20px;
}
.blockquote-center p,
.blockquote-center div {
  text-align: center;
}
.post-body .group-picture img {
  border: 0;
  margin: 0 auto;
  padding: 0 3px;
}
.group-picture-row {
  margin-bottom: 6px;
  overflow: hidden;
}
.group-picture-column {
  float: left;
  margin-bottom: 10px;
}
.post-body .label {
  display: inline;
  padding: 0 2px;
}
.post-body .label.default {
  background: #f0f0f0;
}
.post-body .label.primary {
  background: #efe6f7;
}
.post-body .label.info {
  background: #e5f2f8;
}
.post-body .label.success {
  background: #e7f4e9;
}
.post-body .label.warning {
  background: #fcf6e1;
}
.post-body .label.danger {
  background: #fae8eb;
}
.post-body .tabs {
  margin-bottom: 20px;
}
.post-body .tabs,
.tabs-comment {
  display: block;
  padding-top: 10px;
  position: relative;
}
.post-body .tabs ul.nav-tabs,
.tabs-comment ul.nav-tabs {
  display: flex;
  flex-wrap: wrap;
  margin: 0;
  margin-bottom: -1px;
  padding: 0;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs,
  .tabs-comment ul.nav-tabs {
    display: block;
    margin-bottom: 5px;
  }
}
.post-body .tabs ul.nav-tabs li.tab,
.tabs-comment ul.nav-tabs li.tab {
  background: #fff;
  border-bottom: 1px solid #ddd;
  border-left: 1px solid transparent;
  border-right: 1px solid transparent;
  border-top: 3px solid transparent;
  flex-grow: 1;
  list-style-type: none;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab,
  .tabs-comment ul.nav-tabs li.tab {
    border-bottom: 1px solid transparent;
    border-left: 3px solid transparent;
    border-right: 1px solid transparent;
    border-top: 1px solid transparent;
  }
}
.post-body .tabs ul.nav-tabs li.tab a,
.tabs-comment ul.nav-tabs li.tab a {
  border-bottom: initial;
  display: block;
  line-height: 1.8;
  outline: 0;
  padding: 0.25em 0.75em;
  text-align: center;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-out;
}
.post-body .tabs ul.nav-tabs li.tab a i,
.tabs-comment ul.nav-tabs li.tab a i {
  width: 1.285714285714286em;
}
.post-body .tabs ul.nav-tabs li.tab.active,
.tabs-comment ul.nav-tabs li.tab.active {
  border-bottom: 1px solid transparent;
  border-left: 1px solid #ddd;
  border-right: 1px solid #ddd;
  border-top: 3px solid #fc6423;
}
@media (max-width: 413px) {
  .post-body .tabs ul.nav-tabs li.tab.active,
  .tabs-comment ul.nav-tabs li.tab.active {
    border-bottom: 1px solid #ddd;
    border-left: 3px solid #fc6423;
    border-right: 1px solid #ddd;
    border-top: 1px solid #ddd;
  }
}
.post-body .tabs ul.nav-tabs li.tab.active a,
.tabs-comment ul.nav-tabs li.tab.active a {
  color: #555;
  cursor: default;
}
.post-body .tabs .tab-content .tab-pane,
.tabs-comment .tab-content .tab-pane {
  border: 1px solid #ddd;
  padding: 20px 20px 0 20px;
}
.post-body .tabs .tab-content .tab-pane:not(.active),
.tabs-comment .tab-content .tab-pane:not(.active) {
  display: none;
}
.post-body .tabs .tab-content .tab-pane.active,
.tabs-comment .tab-content .tab-pane.active {
  display: block;
}
.post-body .note {
  margin-bottom: 20px;
  padding: 15px;
  position: relative;
  border: 1px solid #eee;
  border-left-width: 5px;
  border-radius: 3px;
}
.post-body .note h2,
.post-body .note h3,
.post-body .note h4,
.post-body .note h5,
.post-body .note h6 {
  margin-top: 0;
  border-bottom: initial;
  margin-bottom: 0;
  padding-top: 0;
}
.post-body .note p:first-child,
.post-body .note ul:first-child,
.post-body .note ol:first-child,
.post-body .note table:first-child,
.post-body .note pre:first-child,
.post-body .note blockquote:first-child,
.post-body .note img:first-child {
  margin-top: 0;
}
.post-body .note p:last-child,
.post-body .note ul:last-child,
.post-body .note ol:last-child,
.post-body .note table:last-child,
.post-body .note pre:last-child,
.post-body .note blockquote:last-child,
.post-body .note img:last-child {
  margin-bottom: 0;
}
.post-body .note.default {
  border-left-color: #777;
}
.post-body .note.default h2,
.post-body .note.default h3,
.post-body .note.default h4,
.post-body .note.default h5,
.post-body .note.default h6 {
  color: #777;
}
.post-body .note.primary {
  border-left-color: #6f42c1;
}
.post-body .note.primary h2,
.post-body .note.primary h3,
.post-body .note.primary h4,
.post-body .note.primary h5,
.post-body .note.primary h6 {
  color: #6f42c1;
}
.post-body .note.info {
  border-left-color: #428bca;
}
.post-body .note.info h2,
.post-body .note.info h3,
.post-body .note.info h4,
.post-body .note.info h5,
.post-body .note.info h6 {
  color: #428bca;
}
.post-body .note.success {
  border-left-color: #5cb85c;
}
.post-body .note.success h2,
.post-body .note.success h3,
.post-body .note.success h4,
.post-body .note.success h5,
.post-body .note.success h6 {
  color: #5cb85c;
}
.post-body .note.warning {
  border-left-color: #f0ad4e;
}
.post-body .note.warning h2,
.post-body .note.warning h3,
.post-body .note.warning h4,
.post-body .note.warning h5,
.post-body .note.warning h6 {
  color: #f0ad4e;
}
.post-body .note.danger {
  border-left-color: #d9534f;
}
.post-body .note.danger h2,
.post-body .note.danger h3,
.post-body .note.danger h4,
.post-body .note.danger h5,
.post-body .note.danger h6 {
  color: #d9534f;
}
.pagination .prev,
.pagination .next,
.pagination .page-number,
.pagination .space {
  display: inline-block;
  margin: 0 10px;
  padding: 0 11px;
  position: relative;
  top: -1px;
}
@media (max-width: 767px) {
  .pagination .prev,
  .pagination .next,
  .pagination .page-number,
  .pagination .space {
    margin: 0 5px;
  }
}
.pagination {
  border-top: 1px solid #eee;
  margin: 120px 0 0;
  text-align: center;
}
.pagination .prev,
.pagination .next,
.pagination .page-number {
  border-bottom: 0;
  border-top: 1px solid #eee;
  transition-property: border-color;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.pagination .prev:hover,
.pagination .next:hover,
.pagination .page-number:hover {
  border-top-color: #222;
}
.pagination .space {
  margin: 0;
  padding: 0;
}
.pagination .prev {
  margin-left: 0;
}
.pagination .next {
  margin-right: 0;
}
.pagination .page-number.current,
.algolia-pagination .current .page-number {
  background: #ccc;
  border-top-color: #ccc;
  color: #fff;
}
@media (max-width: 767px) {
  .pagination {
    border-top: none;
  }
  .pagination .prev,
  .pagination .next,
  .pagination .page-number {
    border-bottom: 1px solid #eee;
    border-top: 0;
    margin-bottom: 10px;
    padding: 0 10px;
  }
  .pagination .prev:hover,
  .pagination .next:hover,
  .pagination .page-number:hover {
    border-bottom-color: #222;
  }
}
.comments {
  margin: 60px 20px 0;
  overflow: hidden;
}
.comment-button-group {
  display: flex;
  flex-wrap: wrap-reverse;
  justify-content: center;
  margin: 1em 0;
}
.comment-button-group .comment-button {
  margin: 0.1em 0.2em;
}
.comment-button-group .comment-button.active {
  background: #222;
  border-color: #222;
  color: #fff;
}
.comment-position {
  display: none;
}
.comment-position.active {
  display: block;
}
.tabs-comment {
  background: #fff;
  margin-top: 4em;
  padding-top: 0;
}
.tabs-comment .comments {
  border: 0;
  box-shadow: none;
  margin-top: 0;
  padding-top: 0;
}
.container {
  min-height: 100%;
  position: relative;
}
.main-inner {
  margin: 0 auto;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .main-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .main-inner {
    width: 73%;
  }
}
.header {
  background: transparent;
}
.header-inner {
  margin: 0 auto;
  position: relative;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .header-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .header-inner {
    width: 73%;
  }
}
.headband {
  background: #222;
  height: 3px;
}
.site-meta {
  margin: 0;
  text-align: center;
}
@media (max-width: 767px) {
  .site-meta {
    text-align: center;
  }
}
.brand {
  background: #222;
  border-bottom: none;
  color: #fff;
  display: inline-block;
  line-height: 1.375em;
  padding: 0 40px;
  position: relative;
}
.brand:hover {
  color: #fff;
}
.site-title {
  display: inline-block;
  font-family: 'Monda', "PingFang SC", "Microsoft YaHei", sans-serif;
  font-size: 1.375em;
  font-weight: normal;
  line-height: 1.5;
  vertical-align: top;
}
.site-subtitle {
  color: #ddd;
  font-size: 0.8125em;
  margin-top: 10px;
}
.use-motion .brand {
  opacity: 0;
}
.use-motion .site-title,
.use-motion .site-subtitle,
.use-motion .custom-logo-image {
  opacity: 0;
  position: relative;
  top: -10px;
}
.site-nav-toggle {
  display: none;
  left: 10px;
  position: absolute;
}
@media (max-width: 767px) {
  .site-nav-toggle {
    display: block;
  }
}
.site-nav-toggle .toggle {
  background: transparent;
  border: 0;
  margin-top: 2px;
  padding: 10px;
  width: 22px;
}
.site-nav-toggle .toggle .toggle-line {
  background: #555;
  border-radius: 1px;
}
.site-nav {
  display: block;
}
@media (max-width: 767px) {
  .site-nav {
    border-top: 1px solid #ddd;
    clear: both;
    display: none;
    margin: 0 -10px;
    padding: 0 10px;
  }
}
.site-nav.site-nav-on {
  display: block;
}
.menu {
  margin-top: 20px;
  padding-left: 0;
  text-align: center;
}
.menu-item {
  display: inline-block;
  list-style: none;
  margin: 0 10px;
}
@media (max-width: 767px) {
  .menu-item {
    margin-top: 10px;
  }
}
.menu-item a,
.menu-item span.exturl {
  border-bottom: 0;
  display: block;
  font-size: 0.8125em;
  transition-property: border-color;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
@media (hover: none) {
  .menu-item a:hover,
  .menu-item span.exturl:hover {
    border-bottom-color: transparent !important;
  }
}
.menu-item .fa {
  margin-right: 8px;
}
.menu-item .badge {
  display: inline-block;
  font-weight: 700;
  line-height: 1;
  margin-left: 0.35em;
  margin-top: 0.35em;
  text-align: center;
  white-space: nowrap;
}
@media (max-width: 767px) {
  .menu-item .badge {
    float: right;
    margin-left: 0;
  }
}
.use-motion .menu-item {
  opacity: 0;
}
.github-corner :hover .octo-arm {
  animation: octocat-wave 560ms ease-in-out;
}
.github-corner svg {
  border: 0;
  color: #fff;
  fill: #222;
  position: absolute;
  right: 0;
  top: 0;
  z-index: 1000;
}
@media (max-width: 991px) {
  .github-corner svg {
    color: #222;
    fill: #fff;
  }
  .github-corner .github-corner:hover .octo-arm {
    animation: none;
  }
  .github-corner .github-corner .octo-arm {
    animation: octocat-wave 560ms ease-in-out;
  }
}
@-moz-keyframes octocat-wave {
  0%, 100% {
    transform: rotate(0);
  }
  20%, 60% {
    transform: rotate(-25deg);
  }
  40%, 80% {
    transform: rotate(10deg);
  }
}
@-webkit-keyframes octocat-wave {
  0%, 100% {
    transform: rotate(0);
  }
  20%, 60% {
    transform: rotate(-25deg);
  }
  40%, 80% {
    transform: rotate(10deg);
  }
}
@-o-keyframes octocat-wave {
  0%, 100% {
    transform: rotate(0);
  }
  20%, 60% {
    transform: rotate(-25deg);
  }
  40%, 80% {
    transform: rotate(10deg);
  }
}
@keyframes octocat-wave {
  0%, 100% {
    transform: rotate(0);
  }
  20%, 60% {
    transform: rotate(-25deg);
  }
  40%, 80% {
    transform: rotate(10deg);
  }
}
.sidebar {
  background: #222;
  bottom: 0;
  box-shadow: inset 0 2px 6px #000;
  position: fixed;
  top: 0;
  z-index: 1200;
}
.sidebar a,
.sidebar span.exturl {
  border-bottom-color: #555;
  color: #999;
}
.sidebar a:hover,
.sidebar span.exturl:hover {
  border-bottom-color: #eee;
  color: #eee;
}
@media (max-width: 991px) {
  .sidebar {
    display: none;
  }
}
.sidebar-inner {
  color: #999;
  padding: 20px 10px;
  text-align: center;
}
.site-overview-wrap {
  overflow-x: hidden;
  overflow-y: auto;
}
.cc-license {
  margin-top: 10px;
  text-align: center;
}
.cc-license .cc-opacity {
  border-bottom: none;
  opacity: 0.7;
}
.cc-license .cc-opacity:hover {
  opacity: 0.9;
}
.cc-license img {
  display: inline-block;
}
.site-author-image {
  border: 1px solid #eee;
  display: block;
  height: auto;
  margin: 0 auto;
  max-width: 120px;
  padding: 2px;
  border-radius: 50%;
}
.site-author-name {
  color: #222;
  font-weight: 600;
  margin: 0;
  text-align: center;
}
.site-description {
  color: #999;
  font-size: 0.8125em;
  margin-top: 0;
  text-align: center;
}
.links-of-author {
  margin-top: 15px;
}
.links-of-author a,
.links-of-author span.exturl {
  border-bottom-color: #555;
  display: inline-block;
  font-size: 0.8125em;
  margin-bottom: 10px;
  margin-right: 10px;
  vertical-align: middle;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.links-of-author a::before,
.links-of-author span.exturl::before {
  background: #f50352;
  border-radius: 50%;
  content: ' ';
  display: inline-block;
  height: 4px;
  margin-right: 3px;
  vertical-align: middle;
  width: 4px;
}
.feed-link,
.chat {
  margin-top: 15px;
}
.feed-link a,
.chat a {
  border: 1px solid #fc6423;
  border-radius: 4px;
  color: #fc6423;
  display: inline-block;
  padding: 0 15px;
}
.feed-link a .fa,
.chat a .fa {
  margin-right: 5px;
}
.feed-link a:hover,
.chat a:hover {
  background: #fc6423;
  border: 1px solid #fc6423;
  color: #fff;
}
.feed-link a:hover .fa,
.chat a:hover .fa {
  color: #fff;
}
.links-of-blogroll {
  font-size: 0.8125em;
  margin-top: 10px;
}
.links-of-blogroll-title {
  font-size: 0.875em;
  font-weight: 600;
  margin-top: 0;
}
.links-of-blogroll-list {
  list-style: none;
  margin: 0;
  padding: 0;
}
.links-of-blogroll-item {
  padding: 2px 10px;
}
.links-of-blogroll-item a,
.links-of-blogroll-item span.exturl {
  box-sizing: border-box;
  display: inline-block;
  max-width: 280px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
#sidebar-dimmer {
  display: none;
}
@media (max-width: 767px) {
  #sidebar-dimmer {
    background: #000;
    display: block;
    height: 100%;
    left: 100%;
    opacity: 0;
    position: fixed;
    top: 0;
    width: 100%;
    z-index: 1100;
  }
  .sidebar-active + #sidebar-dimmer {
    opacity: 0.7;
    transform: translateX(-100%);
    transition: opacity 0.5s;
  }
}
.sidebar-nav {
  margin: 0;
  padding-bottom: 20px;
  padding-left: 0;
}
.sidebar-nav li {
  border-bottom: 1px solid transparent;
  color: #555;
  cursor: pointer;
  display: inline-block;
  font-size: 0.875em;
}
.sidebar-nav li.sidebar-nav-overview {
  margin-left: 10px;
}
.sidebar-nav li:hover {
  color: #fc6423;
}
.sidebar-nav .sidebar-nav-active {
  border-bottom-color: #fc6423;
  color: #fc6423;
}
.sidebar-nav .sidebar-nav-active:hover {
  color: #fc6423;
}
.sidebar-panel {
  display: none;
}
.sidebar-panel-active {
  display: block;
}
.sidebar-toggle {
  background: #222;
  bottom: 45px;
  cursor: pointer;
  height: 14px;
  left: 30px;
  padding: 5px;
  position: fixed;
  width: 14px;
  z-index: 1300;
}
@media (max-width: 991px) {
  .sidebar-toggle {
    left: 20px;
    opacity: 0.8;
    display: none;
  }
}
.sidebar-toggle:hover .toggle-line {
  background: #fc6423;
}
.post-toc-wrap {
  overflow-x: hidden;
  overflow-y: auto;
}
.post-toc {
  font-size: 0.875em;
}
.post-toc ol {
  list-style: none;
  margin: 0;
  padding: 0 2px 5px 10px;
  text-align: left;
}
.post-toc ol > ol {
  padding-left: 0;
}
.post-toc ol a {
  border-bottom-color: #ccc;
  color: #666;
  transition-property: all;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.post-toc ol a:hover {
  border-bottom-color: #000;
  color: #000;
}
.post-toc .nav-item {
  line-height: 1.8;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.post-toc .nav .nav-child {
  display: none;
}
.post-toc .nav .active > .nav-child {
  display: block;
}
.post-toc .nav .active-current > .nav-child {
  display: block;
}
.post-toc .nav .active-current > .nav-child > .nav-item {
  display: block;
}
.post-toc .nav .active > a {
  border-bottom-color: #fc6423;
  color: #fc6423;
}
.post-toc .nav .active-current > a {
  color: #fc6423;
}
.post-toc .nav .active-current > a:hover {
  color: #fc6423;
}
.site-state {
  display: flex;
  justify-content: center;
  line-height: 1.4;
  margin-top: 10px;
  overflow: hidden;
  text-align: center;
  white-space: nowrap;
}
.site-state-item {
  padding: 0 15px;
}
.site-state-item:not(:first-child) {
  border-left: 1px solid #eee;
}
.site-state-item a {
  border-bottom: none;
}
.site-state-item-count {
  color: inherit;
  display: block;
  font-size: 1em;
  font-weight: 600;
  text-align: center;
}
.site-state-item-name {
  color: #999;
  font-size: 0.8125em;
}
.footer {
  color: #999;
  font-size: 0.875em;
  padding: 20px 0;
}
.footer.footer-fixed {
  bottom: 0;
  left: 0;
  position: absolute;
  right: 0;
}
.footer img {
  border: 0;
}
.footer-inner {
  box-sizing: border-box;
  margin: 0 auto;
  text-align: center;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .footer-inner {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .footer-inner {
    width: 73%;
  }
}
.with-love {
  color: red;
  display: inline-block;
  margin: 0 5px;
  animation: iconAnimate 1.33s ease-in-out infinite;
}
.powered-by,
.theme-info {
  display: inline-block;
}
@-moz-keyframes iconAnimate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
@-webkit-keyframes iconAnimate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
@-o-keyframes iconAnimate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
@keyframes iconAnimate {
  0%, 100% {
    transform: scale(1);
  }
  10%, 30% {
    transform: scale(0.9);
  }
  20%, 40%, 60%, 80% {
    transform: scale(1.1);
  }
  50%, 70% {
    transform: scale(1.1);
  }
}
.back-to-top {
  background: #eee;
  font-size: 12px;
  margin: 8px -10px -20px;
  opacity: 0;
  text-align: center;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.back-to-top.back-to-top-on {
  cursor: pointer;
  opacity: 0.6;
}
.back-to-top.back-to-top-on:hover {
  opacity: 0.8;
}
.post-body {
  font-family: 'Monda', "PingFang SC", "Microsoft YaHei", sans-serif;
  overflow-wrap: break-word;
  word-wrap: break-word;
}
@media (min-width: 1200px) {
  .post-body {
    font-size: 1.125em;
  }
}
.post-body span.exturl .fa {
  font-size: 0.875em;
  margin-left: 4px;
}
.post-body .image-caption,
.post-body .figure .caption {
  color: #999;
  font-size: 0.875em;
  font-weight: bold;
  line-height: 1;
  margin: -20px auto 15px;
  text-align: center;
}
.post-sticky-flag {
  display: inline-block;
  transform: rotate(30deg);
}
.post-button {
  margin-top: 40px;
  text-align: center;
}
.use-motion .post-block,
.use-motion .pagination,
.use-motion .comments {
  opacity: 0;
}
.use-motion .post-header {
  opacity: 0;
}
.use-motion .post-body {
  opacity: 0;
}
.use-motion .collection-header {
  opacity: 0;
}
.posts-collapse {
  margin-left: 55px;
  position: relative;
}
@media (max-width: 767px) {
  .posts-collapse {
    margin-left: 20px;
    margin-right: 20px;
  }
}
.posts-collapse .collection-title {
  font-size: 1.125em;
  position: relative;
}
.posts-collapse .collection-title::before {
  background: #999;
  border: 1px solid #fff;
  border-radius: 50%;
  content: ' ';
  height: 10px;
  left: 0;
  margin-left: -6px;
  margin-top: -4px;
  position: absolute;
  top: 50%;
  width: 10px;
}
.posts-collapse .collection-year {
  margin: 60px 0;
  position: relative;
}
.posts-collapse .collection-year::before {
  background: #bbb;
  border-radius: 50%;
  content: ' ';
  height: 8px;
  left: 0;
  margin-left: -4px;
  margin-top: -4px;
  position: absolute;
  top: 50%;
  width: 8px;
}
.posts-collapse .collection-header {
  display: inline-block;
  margin: 0 0 0 20px;
}
.posts-collapse .collection-header small {
  color: #bbb;
  margin-left: 5px;
}
.posts-collapse .post-header {
  border-bottom: 1px dashed #ccc;
  margin: 30px 0;
  padding-left: 15px;
  position: relative;
  transition-property: border;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.posts-collapse .post-header::before {
  background: #bbb;
  border: 1px solid #fff;
  border-radius: 50%;
  content: ' ';
  height: 6px;
  left: 0;
  margin-left: -4px;
  position: absolute;
  top: 0.75em;
  transition-property: background;
  width: 6px;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.posts-collapse .post-header:hover {
  border-bottom-color: #666;
}
.posts-collapse .post-header:hover::before {
  background: #222;
}
.posts-collapse .post-meta {
  display: inline;
  font-size: 0.75em;
  margin-right: 10px;
}
.posts-collapse .post-title {
  display: inline;
  font-size: 1em;
  font-weight: normal;
  margin-bottom: 0;
  margin-top: 0;
}
.posts-collapse .post-title a,
.posts-collapse .post-title span.exturl {
  border-bottom: none;
  color: #666;
}
.posts-collapse::before {
  background: #f5f5f5;
  content: ' ';
  height: 100%;
  left: 0;
  margin-left: -2px;
  position: absolute;
  top: 1.25em;
  width: 4px;
}
.posts-collapse .fa-external-link {
  font-size: 0.875em;
  margin-left: 5px;
}
.post-eof {
  background: #ccc;
  height: 1px;
  margin: 80px auto 60px;
  text-align: center;
  width: 8%;
}
.post-block:last-child .post-eof {
  display: none;
}
.posts-expand {
  padding-top: 40px;
}
@media (max-width: 767px) {
  .posts-expand {
    margin: 0 20px;
  }
}
@media (min-width: 992px) {
  .post-body {
    text-align: left;
  }
}
@media (max-width: 991px) {
  .post-body {
    text-align: left;
  }
}
.post-body h2,
.post-body h3,
.post-body h4,
.post-body h5,
.post-body h6 {
  padding-top: 10px;
}
.post-body h2 .header-anchor,
.post-body h3 .header-anchor,
.post-body h4 .header-anchor,
.post-body h5 .header-anchor,
.post-body h6 .header-anchor {
  border-bottom-style: none;
  color: #ccc;
  float: right;
  margin-left: 10px;
  visibility: hidden;
}
.post-body h2 .header-anchor:hover,
.post-body h3 .header-anchor:hover,
.post-body h4 .header-anchor:hover,
.post-body h5 .header-anchor:hover,
.post-body h6 .header-anchor:hover {
  color: inherit;
}
.post-body h2:hover .header-anchor,
.post-body h3:hover .header-anchor,
.post-body h4:hover .header-anchor,
.post-body h5:hover .header-anchor,
.post-body h6:hover .header-anchor {
  visibility: visible;
}
.post-body img {
  border: 1px solid #ddd;
  box-sizing: border-box;
  padding: 3px;
}
@media (max-width: 767px) {
  .post-body img {
    padding: initial;
  }
}
.post-body iframe,
.post-body img,
.post-body video {
  margin-bottom: 20px;
}
.post-body .video-container {
  height: 0;
  margin-bottom: 20px;
  overflow: hidden;
  padding-top: 75%;
  position: relative;
  width: 100%;
}
.post-body .video-container iframe,
.post-body .video-container object,
.post-body .video-container embed {
  height: 100%;
  left: 0;
  margin: 0;
  position: absolute;
  top: 0;
  width: 100%;
}
.post-gallery {
  border-collapse: separate;
  display: table;
  table-layout: fixed;
  width: 100%;
}
.post-gallery .post-gallery-img {
  border: 0;
  display: table-cell;
  text-align: center;
  vertical-align: middle;
}
.post-gallery .post-gallery-img img {
  border: 0;
  max-height: 100%;
  max-width: 100%;
}
.post-gallery-row {
  display: table-row;
}
.posts-expand .post-header {
  font-size: 1.125em;
}
.posts-expand .post-title {
  font-weight: 400;
  margin: initial;
  text-align: center;
  overflow-wrap: break-word;
  word-wrap: break-word;
}
.posts-expand .post-title-link {
  border-bottom: none;
  color: #555;
  display: inline-block;
  position: relative;
  vertical-align: top;
}
.posts-expand .post-title-link::before {
  background: #000;
  bottom: 0;
  content: '';
  height: 2px;
  left: 0;
  position: absolute;
  transform: scaleX(0);
  visibility: hidden;
  width: 100%;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.posts-expand .post-title-link:hover::before {
  transform: scaleX(1);
  visibility: visible;
}
.posts-expand .post-title-link .fa {
  font-size: 0.875em;
  margin-left: 5px;
}
.posts-expand .post-meta {
  color: #999;
  font-family: 'Monda', "PingFang SC", "Microsoft YaHei", sans-serif;
  font-size: 0.75em;
  margin: 3px 0 60px 0;
  text-align: center;
}
.posts-expand .post-meta .post-description {
  font-size: 0.875em;
  margin-top: 2px;
}
.posts-expand .post-meta time {
  border-bottom: 1px dashed #999;
  cursor: pointer;
}
.post-meta .post-meta-item + .post-meta-item::before {
  content: '|';
  margin: 0 0.5em;
}
.post-meta-divider {
  margin: 0 0.5em;
}
.post-meta-item-icon {
  margin-right: 3px;
}
@media (max-width: 991px) {
  .post-meta-item-icon {
    display: inline-block;
  }
}
@media (max-width: 991px) {
  .post-meta-item-text {
    display: none;
  }
}
.post-nav {
  border-top: 1px solid #eee;
  display: table;
  margin-top: 15px;
  width: 100%;
}
.post-nav-divider {
  display: table-cell;
  width: 10%;
}
.post-nav-item {
  display: table-cell;
  padding: 10px 0 0 0;
  vertical-align: top;
  width: 45%;
}
.post-nav-item a {
  border-bottom: none;
  color: #555;
  display: block;
  font-size: 0.875em;
  line-height: 1.6;
  position: relative;
}
.post-nav-item a:hover {
  border-bottom: none;
  color: #222;
}
.post-nav-item a:active {
  top: 2px;
}
.post-nav-item .fa {
  font-size: 0.75em;
  margin-right: 5px;
}
.post-nav-next a {
  padding-left: 5px;
}
.post-nav-prev {
  text-align: right;
}
.post-nav-prev a {
  padding-right: 5px;
}
.post-nav-prev .fa {
  margin-left: 5px;
}
.rtl.post-body p,
.rtl.post-body a,
.rtl.post-body h1,
.rtl.post-body h2,
.rtl.post-body h3,
.rtl.post-body h4,
.rtl.post-body h5,
.rtl.post-body h6,
.rtl.post-body li,
.rtl.post-body ul,
.rtl.post-body ol {
  direction: rtl;
  font-family: UKIJ Ekran;
}
.rtl.post-title {
  font-family: UKIJ Ekran;
}
.post-tags {
  margin-top: 40px;
  text-align: center;
}
.post-tags a {
  display: inline-block;
  font-size: 0.8125em;
}
.post-tags a:not(:last-child) {
  margin-right: 10px;
}
.post-widgets {
  border-top: 1px solid #eee;
  margin-top: 15px;
  text-align: center;
}
.wp_rating {
  height: 20px;
  line-height: 20px;
  margin-top: 10px;
  padding-top: 6px;
  text-align: center;
}
.social-like {
  display: flex;
  font-size: 0.875em;
  justify-content: center;
  text-align: center;
}
.reward-container {
  margin: 20px auto;
  padding: 10px 0;
  text-align: center;
  width: 90%;
}
.reward-container button {
  background: #ff2a2a;
  border: 0;
  border-radius: 5px;
  color: #fff;
  cursor: pointer;
  line-height: 2;
  outline: 0;
  padding: 0 15px;
  vertical-align: text-top;
}
.reward-container button:hover {
  background: #f55;
}
#qr {
  padding-top: 20px;
}
#qr a {
  border: 0;
}
#qr img {
  display: inline-block;
  margin: 0.8em 2em 0 2em;
  max-width: 100%;
  width: 180px;
}
#qr p {
  text-align: center;
}
.post-copyright {
  background: #f5f5f5;
  border-left: 3px solid #ff2a2a;
  list-style: none;
  margin: 2em 0 0;
  padding: 0.5em 1em;
}
.category-all-page .category-all-title {
  text-align: center;
}
.category-all-page .category-all {
  margin-top: 20px;
}
.category-all-page .category-list {
  list-style: none;
  margin: 0;
  padding: 0;
}
.category-all-page .category-list-item {
  margin: 5px 10px;
}
.category-all-page .category-list-count {
  color: #bbb;
}
.category-all-page .category-list-count::before {
  content: ' (';
  display: inline;
}
.category-all-page .category-list-count::after {
  content: ') ';
  display: inline;
}
.category-all-page .category-list-child {
  padding-left: 10px;
}
.event-list {
  padding: 0;
}
.event-list hr {
  background: #222;
  margin: 20px 0 45px 0;
}
.event-list hr::after {
  background: #222;
  color: #fff;
  content: 'NOW';
  display: inline-block;
  font-weight: bold;
  padding: 0 5px;
  text-align: right;
}
.event-list .event {
  background: #222;
  margin: 20px 0;
  min-height: 40px;
  padding: 15px 0 15px 10px;
}
.event-list .event .event-summary {
  color: #fff;
  margin: 0;
  padding-bottom: 3px;
}
.event-list .event .event-summary::before {
  animation: dot-flash 1s alternate infinite ease-in-out;
  color: #fff;
  content: '\f111';
  display: inline-block;
  font-family: 'FontAwesome';
  font-size: 10px;
  margin-right: 25px;
  vertical-align: middle;
}
.event-list .event .event-relative-time {
  color: #bbb;
  display: inline-block;
  font-size: 12px;
  font-weight: 400;
  padding-left: 12px;
}
.event-list .event .event-details {
  color: #fff;
  display: block;
  line-height: 18px;
  margin-left: 56px;
  padding-bottom: 6px;
  padding-top: 3px;
  text-indent: -24px;
}
.event-list .event .event-details::before {
  color: #fff;
  display: inline-block;
  font-family: 'FontAwesome';
  margin-right: 9px;
  text-align: center;
  text-indent: 0;
  width: 14px;
}
.event-list .event .event-details.event-location::before {
  content: '\f041';
}
.event-list .event .event-details.event-duration::before {
  content: '\f017';
}
.event-list .event-past {
  background: #f5f5f5;
}
.event-list .event-past .event-summary,
.event-list .event-past .event-details {
  color: #bbb;
  opacity: 0.9;
}
.event-list .event-past .event-summary::before,
.event-list .event-past .event-details::before {
  animation: none;
  color: #bbb;
}
@-moz-keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}
@-webkit-keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}
@-o-keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}
@keyframes dot-flash {
  from {
    opacity: 1;
    transform: scale(1);
  }
  to {
    opacity: 0;
    transform: scale(0.8);
  }
}
ul.breadcrumb {
  font-size: 0.75em;
  list-style: none;
  margin: 1em 0;
  padding: 0 2em;
  text-align: center;
}
ul.breadcrumb li {
  display: inline;
}
ul.breadcrumb li + li::before {
  content: '/\00a0';
  font-weight: normal;
  padding: 0.5em;
}
ul.breadcrumb li + li:last-child {
  font-weight: bold;
}
.tag-cloud {
  text-align: center;
}
.tag-cloud a {
  display: inline-block;
  margin: 10px;
}
.tag-cloud a:hover {
  color: #222 !important;
}
.gt-header a,
.gt-comments a,
.gt-popup a {
  border-bottom: none;
}
.gt-container .gt-popup .gt-action.is--active::before {
  top: 0.7em;
}
.search-pop-overlay {
  background: rgba(0,0,0,0.3);
  display: none;
  height: 100%;
  left: 0;
  overflow: hidden;
  position: fixed;
  top: 0;
  width: 100%;
  z-index: 1400;
}
.search-popup {
  background: #fff;
  border-radius: 5px;
  color: #333;
  display: none;
  height: 80%;
  left: 50%;
  margin-left: -350px;
  padding: 0;
  position: fixed;
  top: 10%;
  width: 700px;
  z-index: 1500;
}
@media (max-width: 767px) {
  .search-popup {
    border-radius: 0;
    height: 100%;
    left: 0;
    margin: 0;
    padding: 0;
    top: 0;
    width: 100%;
  }
}
.search-popup .search-icon,
.search-popup .popup-btn-close {
  color: #999;
  display: inline-block;
  font-size: 18px;
  height: 36px;
  padding-left: 10px;
  padding-right: 10px;
  width: 18px;
}
.search-popup .popup-btn-close {
  border-left: 1px solid #eee;
  cursor: pointer;
  float: right;
}
.search-popup .popup-btn-close:hover .fa {
  color: #222;
}
.search-popup .search-header {
  background: #f5f5f5;
  border-top-left-radius: 5px;
  border-top-right-radius: 5px;
  padding: 5px;
}
.search-input {
  display: inline-block;
  width: calc(90% - 30px);
}
.search-input input {
  background: transparent;
  border: 0;
  outline: 0;
  padding: 5px 0;
  width: 100%;
}
.search-input .ais-search-box--magnifier svg,
.search-input .ais-search-box--reset svg {
  display: none;
}
.algolia-powered {
  float: right;
}
.algolia-powered img {
  display: inline-block;
  height: 18px;
  vertical-align: middle;
}
.algolia-results {
  height: calc(100% - 55px);
  overflow: auto;
  padding: 5px 30px;
  position: relative;
}
.algolia-results hr {
  margin: 10px 0;
}
.algolia-results .highlight {
  color: #f00;
  font-size: inherit;
  font-style: normal;
  margin: 0;
  padding: 0 2px;
}
.algolia-hits {
  margin-top: 20px;
}
.algolia-hit-item {
  margin: 15px 0;
}
.algolia-hit-item-link {
  border-bottom: 1px dashed #ccc;
  display: block;
  transition-delay: 0s;
  transition-duration: 0.2s;
  transition-timing-function: ease-in-out;
}
.algolia-pagination .pagination {
  border-top: none;
  margin: 40px 0;
  opacity: 1;
  padding: 0;
}
.algolia-pagination .pagination-item {
  display: inline-block;
}
.algolia-pagination .page-number {
  border-top: none;
}
.algolia-pagination .page-number:hover {
  border-bottom: 1px solid #222;
}
.algolia-pagination .disabled-item {
  visibility: hidden;
}
.header {
  margin: 0 auto;
  position: relative;
  width: calc(100% - 20px);
}
@media (min-width: 1200px) {
  .header {
    width: 1160px;
  }
}
@media (min-width: 1600px) {
  .header {
    width: 73%;
  }
}
@media (max-width: 991px) {
  .header {
    width: auto;
  }
}
.header-inner {
  background: #fff;
  border-radius: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12);
  overflow: hidden;
  padding: 0;
  position: absolute;
  top: 0;
  width: 240px;
}
@media (min-width: 1200px) {
  .header-inner {
    width: 240px;
  }
}
@media (max-width: 991px) {
  .header-inner {
    border-radius: initial;
    position: relative;
    width: auto;
  }
}
.main::before,
.main::after {
  content: ' ';
  display: table;
}
.main::after {
  clear: both;
}
@media (max-width: 991px) {
  .main-inner {
    width: auto;
  }
}
.content-wrap {
  background: #fff;
  border-radius: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12);
  box-sizing: border-box;
  float: right;
  padding: 40px;
  width: calc(100% - 252px);
}
@media (max-width: 991px) {
  .content-wrap {
    border-radius: initial;
    padding: 20px;
    width: 100%;
  }
}
.sidebar {
  background: #eee;
  box-shadow: none;
  float: left;
  position: static;
  width: 240px;
}
@media (max-width: 991px) {
  .sidebar {
    display: none;
  }
}
.sidebar-toggle {
  display: none;
}
.footer-inner {
  padding-left: 260px;
}
.back-to-top {
  left: auto;
  right: 30px;
}
@media (max-width: 991px) {
  .back-to-top {
    right: 20px;
  }
}
@media (max-width: 991px) {
  .footer-inner {
    padding-left: 0;
    padding-right: 0;
    width: auto;
  }
}
.site-brand-container {
  position: relative;
}
.site-meta {
  background: #222;
  color: #fff;
  padding: 20px 0;
}
@media (max-width: 991px) {
  .site-meta {
    box-shadow: 0 0 16px rgba(0,0,0,0.5);
  }
}
.brand {
  background: none;
  padding: 0;
}
.brand:hover {
  color: #fff;
}
.site-subtitle {
  font-weight: initial;
  margin: 10px 10px 0;
}
.custom-logo-image {
  margin-top: 20px;
}
@media (max-width: 991px) {
  .custom-logo-image {
    display: none;
  }
}
.site-nav-toggle {
  left: 20px;
  top: 50%;
  transform: translateY(-50%);
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav-toggle {
    display: block;
  }
}
.site-nav-toggle .toggle .toggle-line {
  background: #fff;
}
.site-nav {
  border-top: none;
}
@media (min-width: 768px) and (max-width: 991px) {
  .site-nav {
    display: none;
  }
}
.menu-item-active a,
.menu .menu-item a:hover,
.menu .menu-item span.exturl:hover {
  background: #f5f5f5;
}
.menu-item-active a::after,
.menu .menu-item a:hover::after,
.menu .menu-item span.exturl:hover::after {
  background: #bbb;
  border-radius: 50%;
  content: ' ';
  height: 6px;
  margin-top: -3px;
  position: absolute;
  right: 15px;
  top: 50%;
  width: 6px;
}
.menu .menu-item {
  display: block;
  margin: 0;
}
.menu .menu-item a,
.menu .menu-item span.exturl {
  padding: 5px 20px;
  position: relative;
  text-align: left;
  transition-property: background-color;
}
.menu .menu-item .badge {
  background: #ccc;
  border-radius: 10px;
  color: #fff;
  float: right;
  padding: 2px 5px;
  text-shadow: 1px 1px 0 rgba(0,0,0,0.1);
  vertical-align: middle;
}
.sub-menu {
  background: #fff;
  border-bottom: 1px solid #ddd;
  margin: 0;
  padding: 6px 0;
}
.sub-menu .menu-item {
  display: inline-block;
}
.sub-menu .menu-item a,
.sub-menu .menu-item span.exturl {
  margin: 5px 10px;
  padding: initial;
}
.sub-menu .menu-item a:hover,
.sub-menu .menu-item span.exturl:hover {
  background: initial;
  color: #fc6423;
}
.sub-menu .menu-item a::after,
.sub-menu .menu-item span.exturl::after {
  content: initial !important;
}
.sub-menu .menu-item-active a {
  background: #fff;
  border-bottom-color: #fc6423;
  color: #fc6423;
}
.sub-menu .menu-item-active a:hover {
  background: #fff;
  border-bottom-color: #fc6423;
}
.sidebar {
  bottom: auto;
  right: auto;
}
.sidebar a,
.sidebar span.exturl {
  color: #555;
}
.sidebar a:hover,
.sidebar span.exturl:hover {
  border-bottom-color: #222;
  color: #222;
}
.sidebar-inner {
  background: #fff;
  border-radius: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12), 0 -1px 0.5px 0 rgba(0,0,0,0.09);
  box-sizing: border-box;
  color: #555;
  width: 240px;
  opacity: 0;
}
.sidebar-inner.affix {
  position: fixed;
  top: 12px;
}
.sidebar-inner.affix-bottom {
  position: absolute;
}
.site-state-item {
  padding: 0 10px;
}
.feed-link,
.chat {
  border-bottom: 1px dotted #ccc;
  border-top: 1px dotted #ccc;
  margin-top: 10px;
  text-align: center;
}
.feed-link a,
.chat a {
  border: 0;
  color: #fc6423;
  display: block;
}
.feed-link a:hover,
.chat a:hover {
  background: none;
  border: 0;
  color: #e34603;
}
.feed-link a:hover .fa,
.chat a:hover .fa {
  color: #e34603;
}
.links-of-author {
  display: flex;
  flex-wrap: wrap;
  margin-top: 10px;
  justify-content: center;
}
.links-of-author-item {
  margin: 5px 0 0;
}
.links-of-author-item a,
.links-of-author-item span.exturl {
  box-sizing: border-box;
  display: inline-block;
  margin-bottom: 0;
  margin-right: 0;
  max-width: 216px;
  overflow: hidden;
  padding: 0 5px;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.links-of-author-item a,
.links-of-author-item span.exturl {
  border-bottom: none;
  display: block;
  text-decoration: none;
}
.links-of-author-item a::before,
.links-of-author-item span.exturl::before {
  display: none;
}
.links-of-author-item a:hover,
.links-of-author-item span.exturl:hover {
  background: #eee;
  border-radius: 4px;
}
.links-of-author-item .fa {
  margin-right: 2px;
}
.links-of-blogroll-item {
  padding: 0;
}
.content-wrap {
  background: initial;
  box-shadow: initial;
  padding: initial;
}
.post-block {
  background: #fff;
  border-radius: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12);
  padding: 40px;
}
.post-block + .post-block {
  border-radius: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12), 0 -1px 0.5px 0 rgba(0,0,0,0.09);
  margin-top: 12px;
}
.comments {
  background: #fff;
  border-radius: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12), 0 -1px 0.5px 0 rgba(0,0,0,0.09);
  margin: auto;
  margin-top: 12px;
  padding: 40px;
}
.tabs-comment {
  margin-top: 1em;
}
.posts-expand {
  padding-top: initial;
}
.post-nav-divider {
  width: 4%;
}
.post-nav-item {
  width: 48%;
}
.post-eof {
  display: none;
}
.pagination {
  background: #fff;
  border-radius: initial;
  border-top: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12), 0 -1px 0.5px 0 rgba(0,0,0,0.09);
  margin: 12px 0 0;
  padding: 10px 0 10px;
}
.pagination .prev,
.pagination .next,
.pagination .page-number {
  margin-bottom: initial;
  top: initial;
}
.main {
  padding-bottom: initial;
}
.footer {
  bottom: auto;
}
.sub-menu {
  border-bottom: initial;
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12);
}
.sub-menu + .content .post-block {
  box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12), 0 -1px 0.5px 0 rgba(0,0,0,0.09);
  margin-top: 12px;
}
@media (min-width: 768px) and (max-width: 991px) {
  .sub-menu + .content .post-block {
    margin-top: 10px;
  }
}
@media (max-width: 767px) {
  .sub-menu + .content .post-block {
    margin-top: 8px;
  }
}
.post-body h1,
.post-body h2 {
  border-bottom: 1px solid #eee;
}
.post-body h3 {
  border-bottom: 1px solid #eee;
}
.post-body h4 {
  border-bottom: 1px dotted #eee;
}
@media (min-width: 768px) and (max-width: 991px) {
  .content-wrap {
    padding: 10px;
  }
  .posts-expand {
    margin: initial;
  }
  .posts-expand .post-button {
    margin-top: 20px;
  }
  .post-block {
    border-radius: initial;
    box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12), 0 -1px 0.5px 0 rgba(0,0,0,0.09);
    padding: 20px;
  }
  .post-block + .post-block {
    margin-top: 10px;
  }
  .comments {
    margin-top: 10px;
    padding: 10px 20px;
  }
  .pagination {
    margin: 10px 0 0;
  }
}
@media (max-width: 767px) {
  .content-wrap {
    padding: 8px;
  }
  .posts-expand {
    margin: initial;
  }
  .posts-expand .post-button {
    margin: 12px 0;
  }
  .post-block {
    border-radius: initial;
    box-shadow: 0 2px 2px 0 rgba(0,0,0,0.12), 0 3px 1px -2px rgba(0,0,0,0.06), 0 1px 5px 0 rgba(0,0,0,0.12), 0 -1px 0.5px 0 rgba(0,0,0,0.09);
    min-height: auto;
    padding: 12px;
  }
  .post-block + .post-block {
    margin-top: 8px;
  }
  .comments {
    margin-top: 8px;
    padding: 10px 12px;
  }
  .pagination {
    margin: 8px 0 0;
  }
}</style><noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<script>function loadCss(l){var d=document,h=d.head,s=d.createElement('link');s.rel='stylesheet';s.href=l;!function e(f){if (d.body)return f();setTimeout(function(){e(f)})}(function(){h.appendChild(s);});}loadCss('/style.css');loadCss('//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext');loadCss('//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css');loadCss('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css');</script><noscript><link rel="stylesheet" href="/style.css"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&amp;display=swap&amp;subset=latin,latin-ext"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css"></noscript></head>

<body itemscope="" itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">贝克街的流浪猫</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">技术博客</h1>
      
  </div>

  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input" id="search-input"></div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="algolia-results">
  <div id="algolia-stats"></div>
  <div id="algolia-hits"></div>
  <div id="algolia-pagination" class="algolia-pagination"></div>
</div>

  
</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    

  <span class="exturl github-corner" data-url="aHR0cHM6Ly9naXRodWIuY29tL0JlaUtlSmllRGVMaXVMYW5nTWFv" title="欢迎关注我的 GitHub" aria-label="欢迎关注我的 GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></span>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
      
  
  
  <article itemscope="" itemtype="http://schema.org/Article" class="post-block " lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://www.beikejiedeliulangmao.top/java/jvm/class-file/">

    <span hidden="" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="贝克街的流浪猫">
      <meta itemprop="description" content="贝贝猫">
    </span>

    <span hidden="" itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="贝克街的流浪猫">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          JVM Class 文件结构
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-16 15:39:17" itemprop="dateCreated datePublished" datetime="2019-12-16T15:39:17+08:00">2019-12-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>
                  ，
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/JVM/" itemprop="url" rel="index">
                    <span itemprop="name">JVM</span>
                  </a>
                </span>
            </span>

          
            <span id="/java/jvm/class-file/" class="post-meta-item leancloud_visitors" data-flag-title="JVM Class 文件结构" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span><br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>28k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 ≈</span>
              <span>26 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>本文着重介绍 JVM 中 Class 文件相关的内容，更多关于 JVM 的文章均收录于<a href="https://www.beikejiedeliulangmao.top/categories/Java/JVM">&lt;JVM系列文章&gt;</a>。</p>
<a id="more"></a>
<h2 id="Class-文件结构"><a href="#Class-文件结构" class="headerlink" title="Class 文件结构"></a>Class 文件结构</h2><p>众所周知，Java 虚拟机提供了 Java 语言的跨平台能力，使同一份 Java 代码可以运行在不同的平台上。除此之外，JVM 作为一个平台，还提供了跨语言特性，从理论上说，无论是哪种语言编写的程序，只要能够编译成 Class 文件，就能通过 JVM 运行在各种平台之上。而实现这一特性的关键，就是统一而强大的 Class 文件结构，它是异构语言与 JVM 之间的重要桥梁。当前，诸如 Groovy、Scala、Jython（Python）等语言都能编译成 Class 文件并运行在 JVM 之上。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/multiple-language-run-in-jvm.png" alt="multiple-language-run-in-jvm"><br>Class 文件的结构并不是一成不变的，随着 JVM 的版本更替，总是不可避免的要对 Class 文件做出一些调整，但是调整归调整，整个 Class 文件的内容组织形式是非常稳定的。接下来，将介绍一下 Class 文件中最常见的内容，Class 文件的整体结构如下图所示。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/class-file-content.png" alt="class-file-content"><br>在 JVM 规范中，Class 文件使用类似于 C 语言结构体的方式进行描述，并且统一使用无符号整数作为基本数据类型，由 u1、u2、u4、u8 分别表示无符号单字节、2 字节、4 字节、8 字节，对于字符串使用 u1 数组进行表示。一个 Class 文件可以非常严谨的被描述为：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">ClassFile {</span><br><span class="line">    u4 magic;</span><br><span class="line">    u2 minor_version;</span><br><span class="line">    u2 major_version;</span><br><span class="line">    u2 constant_pool_count;</span><br><span class="line">    cp_info constant_pool[constant_pool_count<span class="number">-1</span>];</span><br><span class="line">    u2 access_flags;</span><br><span class="line">    u2 this_class;</span><br><span class="line">    u2 super_class;</span><br><span class="line">    u2 interfaces_count;</span><br><span class="line">    u2 interfaces[interfaces_count];</span><br><span class="line">    u2 fields_count;</span><br><span class="line">    field_info fields[fields_count];</span><br><span class="line">    u2 methods_count;</span><br><span class="line">    method_info methods[methods_count];</span><br><span class="line">    u2 attributes_count;</span><br><span class="line">    attribute_info attributes[attributes_count];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>Class 文件的结构严格按照上述结构体定义：</p>
<ol>
<li>文件以一个 4 字节的魔数开头，紧跟着两个 2 字节的大小版本号</li>
<li>版本号之后是常量池，常量池的个数为 constant_pool_count，常量池的表项有 constant_pool_count - 1 个</li>
<li>常量池之后是类的访问修饰符、代表自身类引用、父类引用以及接口数量和实现的接口引用</li>
<li>接口之后有字段数量和描述，方法数量以及方法描述</li>
<li>最后存放着类文件的属性信息</li>
</ol>
<h3 id="魔数"><a href="#魔数" class="headerlink" title="魔数"></a>魔数</h3><p>魔数（Magic Number）是 Class 文件的标志，用来告诉 JVM 这是一个 Class 文件。魔数是一个 4 字节的无符号整数，它固定为 0xCAFEBABE。接下来我们编译如下类 TestClass，来确认编译出来的 Class 文件中魔数的内容。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bbm.jvm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestClass</span> </span>{</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>编译出来的 Class 文件如下所示，可以看到文件的头 4 个字节就是 0xCAFEBABE。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/test-class-1.png" alt="test-class-1"></p>
<h3 id="文件版本"><a href="#文件版本" class="headerlink" title="文件版本"></a>文件版本</h3><p>在魔数之后，紧跟着 Class 的小版本号和大版本号，它们都是 2 字节的无符号整数。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/test-class-2.png" alt="test-class-2"><br>因为之前编译 TestClass 时使用的是 JDK 1.8 ，所以编译出来的版本号是 0x34（十进制数为 52），正好符合下面的 Class 文件版本对应表。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/class-file-version-map.png" alt="class-file-version-map"><br>目前，高版本的 JVM 可以执行由低版本编译器生成的 Class 文件，但是低版本的 JVM 不能执行由高版本编译器生成的 Class 文件，所以在实际的开发中，我们需要特别注意编译时使用的 JDK 版本与生产环境的 JDK 版本是否一致，如果不一致的话，会报出 <code>UnsupportedClassVersionError</code>。</p>
<h3 id="常量池"><a href="#常量池" class="headerlink" title="常量池"></a>常量池</h3><p>常量池是 Class 文件中内容最为丰富的区域之一。随着 Java 虚拟机的不断发展, 常量池的内容也日渐丰富。同时, 常量池对于 Class 文件中的字段和方法解析也有着至关重要的作用, 可以说, 常量池是整个 Class 文件的基石。在版本号之后, 紧跟着的是常量池的数量, 以及若干个常量池表项。</p>
<p>再回到我们的例子中，TestClass 编译出来的 Class 文件中，constant_pool_count 为 0x10，也就是说这个 Class 文件中包含了 <code>16 - 1 = 15</code> 个常量项（常量池 0 为保留项，不存放实际内容）。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/test-class-3.png" alt="test-class-3"><br>在数量之后，就是常量池中各项的实际内容，不同类型的常量项的内容内容结构各不相同，但是一般都是以 “类型-长度-内容” 或者 “类型-内容” 的格式依次排列。在介绍我们的 TestClass 之前，我们先了解一下常量池项的类型都有哪些。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/constant-types.png" alt="constant-types"><br>有了从 TAG 到常量池项类型的映射关系之后，我们就能够分析 TestClass 中的那 15 个常量池项都是什么了。回到我们的 TestClass 中，我们可以看到第一个常量池项的类型是 0x0A（10），也就是说该项的类型是 Methodref。而 Methodref 项的结构如下：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CONSTANT_Methodref_info {</span><br><span class="line">    u1 tag; <span class="comment">// 类型编号 10</span></span><br><span class="line">    u2 class_index; <span class="comment">// 函数所属类对应的 class 常量池项编号</span></span><br><span class="line">    u2 name_and_type_index; <span class="comment">// 描述函数的对应的 name_and_type 常量池项编号</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>理解了 CONSTANT_Methodref_info 的数据结构之后，我们就能分析出第一个常量池项的类型是 Methodref，是一个方法的引用，该方法所属的类名存在第 3（0x03）个常量池项中，方法名存储在第 13（0x0D）个常量池项中。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/test-class-4.png" alt="test-class-4"><br>而第二个常量池项的类型编号是 7（0x07），对应的常量池项结构如下：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">CONSTANT_Class_info {</span><br><span class="line">    u1 tag; <span class="comment">// 类型编号 7</span></span><br><span class="line">    u2 name_index; <span class="comment">// 类名对应的 utf8 常量池项编号</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>理解了 CONSTANT_Class_info 的结构之后，我们就能知道第二个常量池项的的类型是 Class，类名存储在第 14（0x0E）个常量池项中。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/test-class-5.png" alt="test-class-5"><br>第三个常量池项的类型编号也是 7（0x07），说明第三个常量池项也是一个 Class 项，类名存储在第 15（0x0F）个常量池项中。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/test-class-6.png" alt="test-class-6"><br>第四个常量池项的类型编号是 1（0x01），对应的类型是 CONSTANT_Utf8_info，它的结构如下：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CONSTANT_Utf8_info {</span><br><span class="line">    u1 tag; <span class="comment">// 类型编号 1</span></span><br><span class="line">    u2 length; <span class="comment">// utf8 字符串长度</span></span><br><span class="line">    u1 bytes[length]; <span class="comment">// utf8 字符串的内容</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>在 CONSTANT_Utf8_info 中保存的主要内容是字符串的长度，以及字符串的内容。回到我们的例子中，我们可以得出第四个常量池项保存的字符串的长度为 6（0x06），内容为 <code>&lt;init&gt;</code>。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/test-class-7.png" alt="test-class-7"><br>从第五个常量池项开始，到第 12 个常量池项，保存的的类型都是 Utf8，它们存储的内容分别为 <code>()V</code>，<code>Code</code>，<code>LineNumberTable</code>，<code>LocalVariableTable</code>，<code>this</code>，<code>Lbbm/jvm/TestClass;</code>，<code>SourceFile</code>，<code>TestClass.java</code>。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/test-class-8.png" alt="test-class-8"><br>第 13 个常量池项的类型是 12（0x0C），对应的数据结构如下：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CONSTANT_NameAndType_info {</span><br><span class="line">    u1 tag; <span class="comment">// 类型编号 12</span></span><br><span class="line">    u2 name_index; <span class="comment">// 名字对应的 utf8 常量池项编号</span></span><br><span class="line">    u2 descriptor_index; <span class="comment">// 描述符对应的 utf8 常量池项编号</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>descriptor 使用了一组特定的字符串来表示类型，如下表所示：<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/descriptor-table.png" alt="descriptor-table"><br>从上表中我们可以看出，每个基础类型都有一个对应的大写字母，例如 B 对应 byte，D 对应 double。而对象类型总是以 L 开头，紧跟类的全限定名，并用分号（；）结尾，比如本例中的 <code>Lbbm/jvm/TestClass;</code> 表示类 <code>bbm.jvm/TestClass</code>。数组则以左中括号 ‘[‘ 作为标记，比如 String 二维数组则使用 <code>[[Ljava/lang/String;</code> 表示。</p>
</blockquote>
<p>也就是说第 13 个常量池项是 NameAndType，其中名字对应的是第 4(0x04) 个常量池项，描述内容对应的是第 5（0x05）个常量池项。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/test-class-9.png" alt="test-class-9"><br>回顾第 4、5 个常量池项的内容，我们可以得出该项实际表示的是 <code>&lt;init&gt; ()V</code> 也就是无参构造函数。</p>
<p>而 TestClass 中的最后两个常量池项（第 14、15 项）的类型都是 Utf8，表示的内容分别是 <code>bbm/jvm/TestClass</code> 和 <code>java/lang/Object</code>。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/test-class-10.png" alt="test-class-10"><br>通过上述的例子，想必大家已经对常量池的描述方式有了一定的了解，简单地总结一下就是：常量池中的每一项要么直接包含了所要描述的内容，比如 utf8 字符串，要么以编号的形式引用其他项的内容。在本例中，从第一个 Methodref 类型的常量池项开始，进一步地引用了诸如 Class，NameAndType，Utf8 等类型的常量池项。下图就描述了该 Methodref 项的整个引用关系。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/test-class-reference.png" alt="test-class-reference"><br>除了本例中出现了的 4 种常量池项类型外，还有 10 种不同的类型，它们的结构分别是：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">CONSTANT_String_info {</span><br><span class="line">    u1 tag; <span class="comment">// 类型编号 8</span></span><br><span class="line">    u2 string_index; <span class="comment">// String 对应的 utf8 常量池项的编号</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">CONSTANT_Float_info {  </span><br><span class="line">   u1 tag;  <span class="comment">// 类型编号 4</span></span><br><span class="line">   u4 bytes;  <span class="comment">// 值用 4 字节的无符号整形表示</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">CONSTANT_Double_info {  </span><br><span class="line">   u1 tag;  <span class="comment">// 类型编号 6</span></span><br><span class="line">   u4 high_bytes;  <span class="comment">// 高地址的值用 4 字节的无符号整形表示</span></span><br><span class="line">   u4 low_bytes;  <span class="comment">// 低地址的值用 4 字节的无符号整形表示</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">CONSTANT_MethodType_info {</span><br><span class="line">    u1 tag; <span class="comment">// 类型编号 16</span></span><br><span class="line">    u2 descriptor_index; <span class="comment">// 描述符对应的 utf8 常量池项编号</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">CONSTANT_Fieldref_info {</span><br><span class="line">    u1 tag; <span class="comment">// 类型编号 9</span></span><br><span class="line">    u2 class_index; <span class="comment">// 字段所属类对应的 class 常量池项编号</span></span><br><span class="line">    u2 name_and_type_index; <span class="comment">// 描述字段的对应的 name_and_type 常量池项编号</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">CONSTANT_InterfaceMethodref_info {</span><br><span class="line">    u1 tag; <span class="comment">// 类型编号 11</span></span><br><span class="line">    u2 class_index; <span class="comment">// 函数所属接口对应的 class 常量池项编号</span></span><br><span class="line">    u2 name_and_type_index; <span class="comment">// 描述函数的对应的 name_and_type 常量池项编号</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">CONSTANT_Integer_info {  </span><br><span class="line">   u1 tag;  <span class="comment">// 类型编号 3</span></span><br><span class="line">   u4 bytes;  <span class="comment">// 值用 4 字节的无符号整形表示</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">CONSTANT_Long_info {  </span><br><span class="line">   u1 tag;  <span class="comment">// 类型编号 5</span></span><br><span class="line">   u4 high_bytes;  <span class="comment">// 高地址的值用 4 字节的无符号整形表示</span></span><br><span class="line">   u4 low_bytes;  <span class="comment">// 低地址的值用 4 字节的无符号整形表示</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">CONSTANT_MethodHandle_info {  </span><br><span class="line">   u1 tag;  <span class="comment">// 类型编号 15</span></span><br><span class="line">   u1 reference_kind;  <span class="comment">// 方法句柄的类型用 1 字节的无符号整数表示</span></span><br><span class="line">   u2 reference_index;  <span class="comment">// 根据引用类型的不同可能会指向 Fieldref、Methodref、InterfaceMethodref 类型的常量池项</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">CONSTANT_InvokeDynamic_info {  </span><br><span class="line">   u1 tag;  <span class="comment">// 类型编号 18</span></span><br><span class="line">   u2 bootstrap_method_attr_index;  <span class="comment">// 为指向引导方法表中的索引, 即定位到一个引导方法。引导方法用于在动态调用时进行运行时函数查找和绑定。引导方法表属于类文件的属性(Attribute)</span></span><br><span class="line">   u2 name_and_type_index;  <span class="comment">// 表示方法名字和签名的 NameAndType 常量池项的编号</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>这里我们单独解释一下 CONSTANT_MethodHandle_info 中的字段，我们知道 reference_kind 描述的是引用的类型，而 reference_index 会根据引用类型的不同指向不同类型的常量池项，它们之间的对应关系如下图所示。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/method-handle-map.png" alt="method-handle-map"></p>
<h3 id="访问标记"><a href="#访问标记" class="headerlink" title="访问标记"></a>访问标记</h3><p>在常量池后，紧跟着访问标记，该标记使用两个字节表示，用于表明该类的访问信息，如 public、final、abstract 等。每一种访问类型的表示都是通过设置访问标记的特定位来实现的。比如, 若是 public final 的类, 则该标记为 <code>ACC_PUBLIC | ACC_FINAL</code>。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/access-flag.png" alt="access-flag"><br>在本例中访问标记的值为 0x21，因此可以判断出 TestClass 的类为 public，且 ACC_SUPER 标记置为 1。使用 ACC_SUPER 可以让类更准确地定位到父类的方法 <code>super.method()</code>, 现代编译器都会设置并且使用这个标记。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/test-class-11.png" alt="test-class-11"></p>
<h3 id="当前类、父类、接口"><a href="#当前类、父类、接口" class="headerlink" title="当前类、父类、接口"></a>当前类、父类、接口</h3><p>因为之前的例子比较简单，TestClass 中不包含任何字段和函数也没实现任何接口，为了通过该类解释这部分 Class 内容，所以我们现在对 TestClass 进行一定的修改，使其实现一些接口，包含成员变量和成员函数。修改完的 TestClass 如下所示：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bbm.jvm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Closeable;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestClass</span> <span class="keyword">implements</span> <span class="title">Closeable</span>, <span class="title">Cloneable</span> </span>{</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> field1 = <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">        <span class="keyword">try</span> {</span><br><span class="line">            <span class="keyword">boolean</span> temp = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IOException();</span><br><span class="line">        } <span class="keyword">catch</span> (IOException e) {</span><br><span class="line">            System.out.println(e.toString());</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>修改完后，我们回顾一下描述当前类，父类，以及实现接口的格式，其中 this_class, super_class 都是 2 字节的无符号整数，它们指向常量池中的 CONSTANT_Class 项，因为 Java 中只能单继承，所以 super_class 只会指向一个 CONSTANT_Class 项。而一个类中可以实现多个接口，因此需要以数组的形式来保存多个接口的 CONSTANT_Class 项索引。</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ClassFile {</span><br><span class="line">    ...</span><br><span class="line">    u2 this_class;</span><br><span class="line">    u2 super_class;</span><br><span class="line">    u2 interfaces_count;</span><br><span class="line">    u2 interfaces[interfaces_count];</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>回到我们的例子中，分析新的 TestClass 类文件，不难发现 this_class, super_class，指向的常量池项分别是 8（0x08） 和 9（0x09），而且因为 TestClass 实现了两个接口，所以 interfaces_count 为 2（0x02），这两个 interface 指向的常量池项分别是 10（0x0A） 和 11（0x0B）。这 4 个 Class 类型的常量池项分别引用了编号为 40-43(0x28-0x2B) 的 utf8 常量池项，而这四个 utf8 常量池项，分别对应了 <code>bbm/jvm/TestClass</code>, <code>java/lang/Object</code>, <code>java/io/Closeable</code>, <code>java/lang/Cloneable</code>。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/clazzs.png" alt="clazzs"></p>
<h3 id="字段"><a href="#字段" class="headerlink" title="字段"></a>字段</h3><p>在接口描述后，就是类的字段信息，由于一个类会有多个字段，所以要先表明字段数，然后才是字段的描述。</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">ClassFile {</span><br><span class="line">    ...</span><br><span class="line">    u2 fields_count;</span><br><span class="line">    field_info fields[fields_count];</span><br><span class="line">    ...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>字段的数量由一个 2 字节的无符号整数表示。而每个字段的具体信息由 field_info 结构描述，该结构内容如下：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">field_info {</span><br><span class="line">    u2 access_flags; <span class="comment">// 访问标记，例如：private public 等</span></span><br><span class="line">    u2 name_index; <span class="comment">// 字段名称，指向 utf8 常量池项</span></span><br><span class="line">    u2 descriptor_index; <span class="comment">// 字段的类型描述，指向 utf8 常量池项</span></span><br><span class="line">    u2 attributes_count; <span class="comment">// 字段的属性数量</span></span><br><span class="line">    attribute_info attributes[attributes_count]; <span class="comment">// 字段的属性可以用于存储恒量值等，比如 final 类型的字段会有一个 attribute 来描述恒量值</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>在 field_info 中，字段的访问标记非常类似于类的访问标记，该字段的取值参考如下对应表：<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/access-flag-field.png" alt="access-flag-field"><br>下面我们以常量属性为例，来说一下字段的 attribute 数组中可能存储的内容：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ConstantValue_attribute {</span><br><span class="line">    u2 attribute_name_index;</span><br><span class="line">    u4 attribute_length;</span><br><span class="line">    u2 constantvalue_index;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>常量属性的 attribute_name_index 为 2 字节整数, 指向常量池的 CONSTANT_Ut8, 它指向的 utf8 常量池项只可能是如下这几种值，而当一个属性描述的是字段的恒量值时，所对应的字符串为“ConstantValue”。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/attribute-name-utf8.png" alt="attribute-name-utf8"><br>接着, 为 attribute_length, 它由 4 个字节组成, 表示这个属性的剩余长度为多少。对常量属性而言, 这个值恒为 2。最后的 constantvalue_index 表示属性值, 但值并不直接出现在属性中, 而是存放在常量池中, 这里的 constantvalue_index 也是指向常量池的索引, 根据 field 类型的不同，constantvalue_index 可能会指向不同类型的常量池项，具体的对应关系如下图所示。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/field-constant-attribute.png" alt="field-constant-attribute"><br>接下来，回到我们的 TestClass 例子中，我们可以看出 TestClass 中存在 1(0x01) 个变量，该变量的访问标记为 0x12 因为该字段是 <code>private final</code>。变量名对应的编号为 12（0x0C）的 utf8 常量池项，该项的内容为 <code>field1</code>。字段的类型描述对应了编号为 13（0x0D）的 utf8 常量池项，该项的内容为 <code>Z</code> 表示字段的类型为 <code>boolean</code>。紧接着，该字段还有 1（0x01）个属性，该属性的名字指向了编号为 14（0x0E）的 utf8 常量池项，该项的内容为 <code>ConstantValue</code>，这表明该属性描述的是该字段的恒量值，所以 attribute_length 为 0x0002，并且 constantvalue_index 指向了编号为 15（0x0F）的 Integer 类型（0x03）常量池项，该项的内容为 <code>0</code>，也就是说 <code>field1</code> 的恒量值为 <code>false</code>。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/field-class.png" alt="field-class"></p>
<h3 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h3><p>在字段之后，就是类的方法信息，它和字段信息一样由两部分组成：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ClassFile {</span><br><span class="line">    u2 methods_count;</span><br><span class="line">    method_info methods[methods_count];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>其中方法数量用 2 字节的无符号整数表示，接着就是这些函数的信息，每个 method_info 结构表示一个方法。</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">method_info {</span><br><span class="line">    u2 access_flags; <span class="comment">// 访问标记，例如：private public 等</span></span><br><span class="line">    u2 name_index; <span class="comment">// 函数名称，指向 utf8 常量池项</span></span><br><span class="line">    u2 descriptor_index; <span class="comment">// 函数签名，指向 utf8 常量池项</span></span><br><span class="line">    u2 attributes_count; <span class="comment">// 函数的属性数量</span></span><br><span class="line">    attribute_info attributes[attributes_count]; <span class="comment">// 特属于该函数的属性，和字段属性的组织方式相同，只不过类型不同</span></span><br><span class="line">}</span><br><span class="line">attribute_info {</span><br><span class="line">    u2 attribute_name_index; <span class="comment">// 属性的名字，指向 utf8 常量池项</span></span><br><span class="line">    u4 attribute_length; <span class="comment">// 属性的长度</span></span><br><span class="line">    u1 info[attribute_length]; <span class="comment">// 属性的内容，当属性类型不同时，info 的内容各不相同</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>在 method_info 结构中，访问标记（access_flags）和字段的访问标记非常类似，它们的取值如下表所示。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/access-flag-method.png" alt="access-flag-method"><br>紧接着是描述函数名和函数签名的信息，它们都是通过 2 字节的无符号数指向了对应的 utf8 常量池项编号。method_info 中，最后的就是属性部分，它和字段的属性组织方式基本一样，只不过函数使用的属性的类型和字段使用的属性的类型大不相同，方法的主要信息都存放在属性中。</p>
<p>在我们的例子 TestClass 中，我们可以看到它总共有 2（0x02） 个函数，其中第一个函数的 access_flags 为 PUBLIC（0x01），函数名存储在编号为 16（0x10）的常量池项中，内容为 <code>&lt;init&gt;</code> 也就是构造函数，函数的签名存储在编号为 17（0x11）的常量池项中，内容为 <code>()V</code>。该方法有 1（0x01）个属性，该属性的名称存储在 18（0x12）号常量池项中，内容为 <code>Code</code>，说明该属性中保存了代码内容，并且整个 Code 属性的长度为 56（0x38） 字节。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/method1-class.png" alt="method1-class"><br>TestClass 中的第二个函数的 access_flags 也为 PUBLIC（0x01），函数名存储在编号为 23（0x17）的常量池项中，内容为 <code>close</code>，函数的签名存储在编号为 17（0x11）的常量池项中，内容为 <code>()V</code>。该方法有 2（0x02） 个属性，第一个属性的名称存储在在 18（0x12）号常量池项中，内容为 <code>Code</code>，说明该属性中保存了代码内容，并且整个 Code 属性的长度为 120（0x78） 字节。第二个属性的名称存储在 29（0x1D）号常量池项中，内容为 <code>Exceptions</code>，该属性的长度为 4（0x04）字节。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/method2-class.png" alt="method2-class"></p>
<h4 id="方法属性"><a href="#方法属性" class="headerlink" title="方法属性"></a>方法属性</h4><h5 id="Code-属性"><a href="#Code-属性" class="headerlink" title="Code 属性"></a>Code 属性</h5><p>在方法的属性当中最重要的属性当属 Code，它存放着函数的字节码信息，它的结构如下。</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Code_attribute {</span><br><span class="line">    u2 attribute_name_index; <span class="comment">// 指定了该属性的名称, 它是一个指向常量池的索引, 指向的类型为 CONSTANT_Utf8, 对于 Code 属性来说, 该值恒为 “Code”</span></span><br><span class="line">    u4 attribute_length; <span class="comment">// 指定了 Code 属性的长度</span></span><br><span class="line">    u2 max_stack;</span><br><span class="line">    u2 max_locals;</span><br><span class="line">    u4 code_length;</span><br><span class="line">    u1 code[code_length];</span><br><span class="line">    u2 exception_table_length;</span><br><span class="line">    {</span><br><span class="line">        u2 start_pc;</span><br><span class="line">        u2 end_pc;</span><br><span class="line">        u2 handler_pc;</span><br><span class="line">        u2 <span class="keyword">catch</span> type;</span><br><span class="line">    }</span><br><span class="line">    exception_table[exception_table_length];</span><br><span class="line">    u2 attributes_count;</span><br><span class="line">    attribute_info attributes[attributes_count];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>在方法执行过程中, 操作数栈可能不停地变化, 但在整个执行过程中, 操作数栈存在一个最大深度, 该深度由 max_stack 表示。同理, 在方法执行过程中, 局部变量表也可能会不断变化。在整个执行过程中局部变量表的最大值由 max_locals 表示, 它们都是 2 字节的无符号整数。</p>
<p>在 max_locals 之后, 就是作为方法的最重要部分————字节码。它由 code_length 和 <code>code[code_ength]</code> 两部分组成, code_length 表示字节码的长度, 为 4 字节无符号整数, <code>code[code_ength]</code> 为 byte 数组, 为字节码内容本身。</p>
<p>在字节码之后, 存放该方法的异常处理表。异常处理表告诉一个方法该如何处理字节码中可能抛出的异常。异常处理表亦由两部分组成: 表项数量和内容。其中 exception_table_length 表示异常表的表项数量, <code>exception_table[exception_table_length]</code> 结构为异常表。表中每一行由 4 部分组成, 分别是 start_pc, end_pc, handler_pc 和 catch_type。这 4 项表示从方法字节码的 start_pc 偏移量开始到 end_pc 偏移量为止的这段代码中, 如果遇到了 catch_type 所指定的异常, 那么代码就跳转到 handler_pc 的位置执行。在这 4 项中, start_pc、end_pc 和 handler_pc 都是字节码的编译量, 也就是在 <code>code[code_length]</code> 中的位置, 而 catch_type 为指向常量池的索引, 它指向一个 CONSTANT_Class 类, 表示需要处理的异常类型。</p>
<p>至此, Code 属性的主体部分已经介绍完毕, 但是 Code 属性中还可能包舍更多信息, 比如行号、局部变量表等。这些信息都以 attribute 属性的形式内嵌在 Code 属性中, 即除了字段、方法和类文件可以内嵌属性外, 属性本身也可以内嵌其他属性。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/method1-code.png" alt="method1-code"><br>接下来，回到我们的例子 TestClass 中，我们先分析构造函数的 Code 属性部分，因为它更加简短，但是本质上和 <code>close</code> 函数是类似的。上图就展示了构造函数部分的 Code 属性内容（不包括 attribute_name_index 和 attribute_length）。可以看到构造函数的操作数栈最大深度为 2（0x02），最大局部变量数为 1（0x01），这里大家可能会有疑问怎么会有局部变量，这是因为在每个函数中 this 都会占用局部变量表的第一个位置。紧接着是字节码，它的长度为 10（0x0A）, 内容为 <code>2A B7 00 01 2A 03 B5 00 02 B1</code>，在 JVM 中每个指令都有一个对应的字节码，构造函数的字节码翻译成指令后，内容如下：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">0 aload_0 // 将第一个局部变量 this 推到操作栈顶</span><br><span class="line">1 invokespecial #1 &lt;java/lang/Object.&lt;init&gt;&gt; // 执行父类 Object 的构造函数，执行结束后操作数栈清空，你会发现一个指令占1字节，一个引用占两个字节</span><br><span class="line">4 aload_0 // 将第一个局部变量 this 推到操作栈顶</span><br><span class="line">5 iconst_0 // 将 int 0 推到操作栈顶，注意此刻操作数栈中要包含 2 个数据（this 和 0），所以之前的操作数栈的最大深度是 2</span><br><span class="line">6 putfield #2 &lt;bbm/jvm/TestClass.field1&gt; // 为 this 类实例的 field1 字段赋值 0</span><br><span class="line">9 return // 当前函数返回 void</span><br></pre></td></tr></tbody></table></figure>

<p>如果将上述字节码再转化为 Java 代码的话，大致的内容如下：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">super</span>();</span><br><span class="line"><span class="keyword">this</span>.field1 = <span class="keyword">false</span>;</span><br><span class="line"><span class="keyword">return</span>;</span><br></pre></td></tr></tbody></table></figure>

<p>在字节码之后的是异常表和属性表，可以看到 TestClass 的构造函数中异常表长度为 0（0x00），属性表长度为 2（0x02），第一个属性的名称存储在 19（0x13）号常量池项中（LineNumberTable），长度为 6（0x06），第二个属性的名称存储在 20（0x14）号常量池项中（LocalVariableTable），长度为 12（0x0C），这两个属性的具体内容我们后面再介绍。</p>
<p><code>close</code> 函数的 Code 属性如下图所示（不包括 attribute_name_index 和 attribute_length）。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/method2-code.png" alt="method2-code"><br>可以看到 <code>close</code> 函数的操作数栈最大深度为 2（0x02），最大局部变量数为 2（0x01），这里大家可能会有疑问：函数中应该有 temp，this，和异常 e 这三个局部变量啊，为什么局部变量表的长度为 2 呢，实际上因为 temp 和 异常 e 处在不同的代码域中，所以它们会共用同一个局部变量槽位。紧接着是字节码，它的长度为 22（0x16）, 翻译成指令后，内容如下：</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> 0 iconst_0 // 将 int 0 推到操作栈顶</span><br><span class="line"> 1 istore_1 // 将栈顶 int 型值存入第二个局部变量中</span><br><span class="line"> 2 new #3 &lt;java/io/IOException&gt; // 创建一个 IOException 对象，并将其引用压入操作数栈顶</span><br><span class="line"> 5 dup // 复制栈顶数值（IOException 对象引用）并将复制值压入栈顶，至此操作数栈达到最大深度 2</span><br><span class="line"> 6 invokespecial #4 &lt;java/io/IOException.&lt;init&gt;&gt; // 执行 IOException 的构造函数，执行后栈中只剩下一个 IOException 引用</span><br><span class="line"> 9 athrow // 将栈顶的 IOException 异常抛出，执行该指令后，栈中本应为空，但是因为该异常又被 close 函数 catch 住了，所以 IOException 异常最后又会回到栈顶</span><br><span class="line">10 astore_1 // 将栈顶 IOException 引用存入第二个本地变量</span><br><span class="line">11 getstatic #5 &lt;java/lang/System.out&gt; // 获取 System 类的 out 静态属性，并将其压入栈顶</span><br><span class="line">14 aload_1 // 将第二个局部变量 IOException 推送至栈顶</span><br><span class="line">15 invokevirtual #6 &lt;java/io/IOException.toString&gt; // 执行栈顶 IOException 对象的 toString 函数，返回值会被推送至栈顶，此时栈内有两个数据（IOException 的 String，System.out）</span><br><span class="line">18 invokevirtual #7 &lt;java/io/PrintStream.println&gt; // 执行 System.out 的 println 函数，参数是 IOException 的 String，该函数无返回值</span><br><span class="line">21 return // 当前函数返回 void</span><br></pre></td></tr></tbody></table></figure>

<p>在字节码之后的是异常表和属性表，可以看到 TestClass 的 <code>close</code> 函数中异常表长度为 1（0x01），start_pc = 0（0x00），end_pc = 10（0x0A），handler_pc = 10（0x0A），意为从字节码 0 偏移 到 10（不包含 10）偏移发生和第3（0x03）个常量池项匹配的异常后，应该调到偏移为 10 的字节码继续执行，而第 3 个常量池项是一个 Class 类型的项，它内部又指向了编号为 34（0x22）的 utf8 常量池项，内容为 <code>java/io/IOException</code>。</p>
<p>异常表后的属性表长度为 3（0x03），第一个属性的名称存储在 19（0x13）号常量池项中（LineNumberTable），长度为 22（0x16），第二个属性的名称存储在 20（0x14）号常量池项中（LocalVariableTable），长度为 32（0x20），最后一个属性的名称存储在 27（0x1B）号常量池项中（StackMapTable），长度为 6（0x06）。</p>
<h5 id="LineNumberTable-属性"><a href="#LineNumberTable-属性" class="headerlink" title="LineNumberTable 属性"></a>LineNumberTable 属性</h5><p>Code 属性本身也包含着其他属性以进一步存储一些额外信息。首先, 来看一下 LineNumberTable, 它是 Code 属性的属性, 用于描述 Code 属性。LineNumberTable 用来记录字节码偏移量和行号的对应关系, 在软件调试时, 该属性有着至关重要的作用, 若没有它, 则调试器无法定位到对应的源码。LineNumberTable 属性的结构如下:</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">LineNumberTable_attribute {</span><br><span class="line">    u2 attribute_name_index; <span class="comment">// 为指向常量池的索引, 在 LineNumberTable 属性中, 该值为"LineNumberTable"</span></span><br><span class="line">    u4 attribute_length; <span class="comment">// 为 4 字节无符号整数, 表示属性的长度(不含前 6 个字节)</span></span><br><span class="line">    u2 line_number_table_length; <span class="comment">// 表明了表项有多少条记录</span></span><br><span class="line">    {</span><br><span class="line">        u2 start_pc;</span><br><span class="line">        u2 line_number;</span><br><span class="line">    } line_number_table[line_number_table_length] <span class="comment">// 表的实际内容</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>line_number_table 中包含 line_number_table_length 个 &lt;start_pc, line_number&gt; 元组, 其中, start_pc 为字节码偏移量, line_number 为对应的行号。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/method2-line-number.png" alt="method2-line-number"><br>在 TestClass <code>close</code> 函数的 LineNumberTable_attribute 中，有 5（0x05）个行号表项，起始字节码偏移到行号的映射关系如下，结合 <code>close</code> 函数的字节码和 Java 文件，不难看到它们的对应关系和 Class 文件中的内容完全一致。</p>
<ul>
<li>PC：0（0x00） -&gt; line: 12(0x0C) (为 temp 赋值)</li>
<li>PC：2（0x02）-&gt; line: 13(0x0D) (抛出异常)</li>
<li>PC：10（0x0A）-&gt; line: 14(0x0E) (catch 异常)</li>
<li>PC：11（0x0B）-&gt; line: 15(0x0F) (打印异常)</li>
<li>PC：21 (0x15）-&gt; line: 17(0x11) (函数结尾的括号)</li>
</ul>
<h5 id="LocalVariableTable-属性"><a href="#LocalVariableTable-属性" class="headerlink" title="LocalVariableTable 属性"></a>LocalVariableTable 属性</h5><p>对 Code 属性而言, 另外一个重要的属性是 LocalVariableTable, 也就是局部变量表, 它记录了一个方法中所有的局部变量, 它的结构如下:</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">LocalVariableTable_attribute {</span><br><span class="line">    u2 attribute_name_index; <span class="comment">// 当前属性的名字, 它是指向常量池的索引。对局部变量表而言, 该值为"LocalVariableTable"</span></span><br><span class="line">    u4 attribute_length; <span class="comment">// 属性的长度</span></span><br><span class="line">    u2 local_variable_table_length; <span class="comment">// 局部变量表表项条目</span></span><br><span class="line">    {</span><br><span class="line">        u2 start_pc;</span><br><span class="line">        u2 length;</span><br><span class="line">        u2 name_index;</span><br><span class="line">        u2 descriptor_index;</span><br><span class="line">        u2 index;</span><br><span class="line">    } local_variable_table[local_variable_table_length]</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>局部变量表的每一条记录由以下几个部分组成:</p>
<ul>
<li>start_pc、length: 表示当前局部变量的开始位置(start_pc)和结束位置(start_pc + length, 不含最后一个字节)。</li>
<li>name_index: 局部变量的名称, 这是一个指向常量池的索引。</li>
<li>descriptor_index: 局部变量的类型描述, 指向常量池的索引。使用和字段描述符一样的方式描述局部变量。</li>
<li>index: 局部变量在当前帧栈的局部变量表中的槽位。对于 long 和 double 的数据, 它们会占据局部变量表中的两个槽位。</li>
</ul>
<p>TestClass 的 <code>close</code> 函数的局部变量表信息如下所示，其中 0x14 就是 “LocalVariableTable” 局部变量项的编号 20，而局部变量表的长度为 32（0x20），局部变量表中总共包含 3（0x03）项。第一项的 start_pc = 2(0x02), length = 8(0x08), 变量名存储在 24（0x18）号常量池项中，内容为 <code>temp</code>，类型描述符存储在 13（0x0D）号常量池项中，内容为 <code>Z</code>，该项占用的局部变量表槽位为 1（0x01）。第二项的 start_pc = 11（0x0B），length = 10（0x0A），局部变量名存储在 25（0x19）号常量池项中，内容为 <code>e</code>，类型描述符存储在 26（0x1A）号常量池项中，内容为 <code>Ljava/io/IOException</code>，该项占用的局部变量表槽位为 1（0x01）。第三项的 start_pc = 0（0x00），length = 22（0x16），局部变量名存储在 21（0x15）号常量池项中，内容为 <code>this</code>，类型描述符存储在 22（0x16）号常量池项中，内容为 <code>Lbbm/jvm/TestClass</code>, 该项占用的局部变量表槽位为 0（0x00）。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/method2-variable.png" alt="method2-variable"><br>总结一下，表中各项的内容如下：<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/method2-variable-table.png" alt="method2-variable-table"><br>可以看到，局部变量表中第 0 项一直是 <code>this</code>，而变量 <code>temp</code> 和异常 <code>e</code> 因为所处的执行域不同，所以它们共用了槽位 1，对照 <code>close</code> 函数的字节码后，你就会发现异常 <code>e</code> 的 start_pc = 11, 正好在 <code>10 astore_1 // 将栈顶 IOException 引用存入第二个本地变量</code> 之后。</p>
<h5 id="StackMapTable-属性"><a href="#StackMapTable-属性" class="headerlink" title="StackMapTable 属性"></a>StackMapTable 属性</h5><p>对于 JDK1.6 以后的类文件, 每个方法的 Code 属性还可能含有一个 StackMapTable 的属性结构。该结构中存有若干个叫做栈映射帧(stack map frame)的数据。该属性不包含运行时所需的信息，仅用作 Class 文件的类型检验。StackMapTable 的结构如下：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">StackMapTable_attribute {</span><br><span class="line">    u2 attribute_name_index; <span class="comment">// 常量池索引，恒为 “StackMapTable”</span></span><br><span class="line">    u4 attribute_length; <span class="comment">// 属性长度</span></span><br><span class="line">    u2 number_of_entries; <span class="comment">// 栈映射帧的数量</span></span><br><span class="line">    stack_map_fram entries[number_of_entries]; <span class="comment">// 具体的内容</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>每一个栈映射帧都是为了说明在一个特定的字节码偏移位置上, 系统的数据类型是什么(包括局部变量表的类型和操作数栈的类型)。每一帧都会显式或者隐式地指定一个字节码偏移量的变化值 offset_delta,使用 offset_delta 可以计算出这一帧数据的字节码偏移位置。计算方法就是将 offset delta+1 和上一帧的字节码偏移量相加。如果上一帧是方法的初始帧, 那么, 字节码偏移量为 offset_delta 本身。</p>
<p>这里说的“帧”, 和帧栈的帧不是同一个概念。这里更接近于一个跳转语句, 跳转语句将函数划分成不同的块, 每一块的概念就接近于这里所说的栈映射帧中的“帧”。</p>
<p>StackMapTable 结构中的 stack_map_frame 被定义为一个枚举值, 它可能的取值如下:</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">union</span> <span class="title">stack_map_frame</span> <span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    same_frame;</span></span></span><br><span class="line"><span class="function"><span class="params">    same_locals_1_stack_item_frame;</span></span></span><br><span class="line"><span class="function"><span class="params">    same_locals_1_stack_item_frame_extended;</span></span></span><br><span class="line"><span class="function"><span class="params">    chop_frame;</span></span></span><br><span class="line"><span class="function"><span class="params">    same_frame_extended;</span></span></span><br><span class="line"><span class="function"><span class="params">    append_frame;</span></span></span><br><span class="line"><span class="function"><span class="params">    full_frame;</span></span></span><br><span class="line"><span class="function"><span class="params">}</span></span></span><br></pre></td></tr></tbody></table></figure>

<p>第 1 个取值 same_frame 定义如下, 它表示当前代码所在位置和上一个比较位置的局部变量表是完全相同的, 并且操作数栈为空。它的取值为 0-63, 这个取值也是隐含的 offset_delta, 表示距离上一个帧块的偏移量。</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">same_frame {</span><br><span class="line">    u1 frame_type = SAME; <span class="comment">/* 0-63 */</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>第 2 个取值 same_locals_1_stack_item_frame 的定义如下，其中, frame_type 的范围为 64-127, 如果栈映射帧为该值, 则表示当前帧和上一帧有相同的局部变量, 并且操作数栈中变量数量为 1。它有一个隐式的 offset_delta, 使用 frame_type-64 可以计算得来。之后的 verification_type_info, 就表示该操作数中的变量类型。</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">same_locals_1_stack_item_frame {</span><br><span class="line">    u1 frame_type = SAME_LOCALS_1_STACK_ITEM; <span class="comment">/* 64-127 */</span></span><br><span class="line">    verification_type_info <span class="built_in">stack</span>[<span class="number">1</span>];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>其中 verification_type_info 也是一个枚举值，它的可能取值如下：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">union</span> verification_type_info {</span><br><span class="line">    Top_variable_info;</span><br><span class="line">    Integer_variable_info;</span><br><span class="line">    Float_variable_info;</span><br><span class="line">    Long_variable_info;</span><br><span class="line">    Double_variable_info;</span><br><span class="line">    Null_variable_info;</span><br><span class="line">    UninitializedThis_variable_info;</span><br><span class="line">    Object_variable_info;</span><br><span class="line">    Uninitialized_variable_info;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Top_variable_info {</span><br><span class="line">    u1 tag = ITEM_Top; <span class="comment">// 0</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Integer_variable_info {</span><br><span class="line">    u1 tag = ITEM_Integer; <span class="comment">// 1</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Float_variable_info {</span><br><span class="line">    u1 tag = ITEM_Float; <span class="comment">// 2</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Long_variable_info {</span><br><span class="line">    u1 tag = ITEM_Long; <span class="comment">// 4</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Double_variable_info {</span><br><span class="line">    u1 tag = ITEM_Double; <span class="comment">// 3</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Null_variable_info {</span><br><span class="line">    u1 tag = ITEM_Null; <span class="comment">// 5</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">UninitializedThis_variable_info {</span><br><span class="line">    u1 tag = ITEM_UninitializedThis; <span class="comment">// 6</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Object_variable_info {</span><br><span class="line">    u1 tag = ITEM_Object; <span class="comment">// 7</span></span><br><span class="line">    u2 cpool_index;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Uninitialized_variable_info {</span><br><span class="line">    u1 tag = ITEM_Uninitialized <span class="comment">// 8</span></span><br><span class="line">    uoffset offset;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>在我们的 TestClass 的 <code>close</code> 函数中，就包含一个该类型的 stack_map_frame。它保存在 <code>close</code> 函数的第三个属性中，该属性的名字指向 27（0x1B）号常量池项，内容为 “StackMapTable”，属性的长度为 6（0x06）。栈映射帧的数量为 1（0x01），帧类型为 74（0x4A）也就是刚才所说的 same_locals_1_stack_item_frame，同时隐含的 offset_delta = 74 - 64 = 10，那么 offset 为 0 的字节码是什么呢？ <code>10 astore_1 // 将栈顶 IOException 引用存入第二个本地变量</code>，在执行这条指令前栈内只有一份数据，也就是 IOException 对象引用，接下来我们看一下 StackMapTable 中描述的栈内容对不对。根据 verification_type_info 的 tag = 7（0x07）可知该校验类型为 Object，对应的 Object 保存在第 28（0x1C）号常量池项中，该项的类型是 Class 类型，Class 的名称保存在 34（0x22）号常量池项中，内容为 “java/io/IOException”。看来 StackMapTable 中描述的内容和字节码中的执行情况正好匹配，它确实能起到类型验证的作用。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/method2-stack-map.png" alt="method2-stack-map"><br>到这里 TestClass 的 Code 属性就结束了，我们接下来回过头来继续介绍 stack_map_frame 的其他类型，虽然这些类型在例子中没有出现，但是记录在此也能便于以后查阅。</p>
<p>第 3 个取值 same_locals_1_stack_item_frame_extended, 和 same_locals_1_stack_item_frame 含义相同, 但是前者表示的 offset_delta 范围非常有限, 如果超出范围, 则需要使用 same_locals_1_stack_item_frame_extended, 它使用显式的 offset delta。同样, 在结构的最后, 存放着操作数桟的数据类型, 它的结构如下。</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">same_locals_1_stack_item_frame_extended {</span><br><span class="line">    u1 frame_type = SAME_LOCAL_1_STACK_ITEM_EXTENDED; <span class="comment">/* 247 */</span></span><br><span class="line">    u2 offset_delta;</span><br><span class="line">    verification_type_info <span class="built_in">stack</span>[<span class="number">1</span>];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>第 4 个取值 chop_frame 则表示操作数桟为空, 当前局部变量表比前一帧少 k 个局部变量。其中, k 为 251 - frame_type。它的结构如下:</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">chop_frame {</span><br><span class="line">    u1 frame_type = CHOP; <span class="comment">/* 248-250 */</span></span><br><span class="line">    u2 offset_delta;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>第 5 个取值 same_frame_extended 和 same_frame 含义一样, 表示局部变量信息和上一帧相同, 且操作数栈为空。但是 same_frame_extended 显示指定了 offset_delta, 可以表示更大的字节偏移量。它的结构如下:</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">same_frame_extended {</span><br><span class="line">    u1 frame_type = SAME_FRAME_EXTENDED; <span class="comment">/* 251 */</span></span><br><span class="line">    u2 offset_delta;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>第 6 个取值 append_frame 表示当前帧比上一帧多了 k 个局部变量, 且操作数栈为空。其中 k 为 frame_type - 251。在 append_frame 的最后, 还存放着增加的局部变量的类型。它的结构如下:</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">append_frame {</span><br><span class="line">    u1 frame_type = APPEND; <span class="comment">/* 252-254 */</span></span><br><span class="line">    u2 offset_delta;</span><br><span class="line">    verification_type_info locals[frame_type - <span class="number">251</span>];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>以上类型均只保存了前后两个帧中变化的部分, 因此可以减少数据的大小。但是, 如果以上结构都无法表达帧的信息时, 则可以使用第 7 种结构 full_frame。它不用来表示连续两个帧之间的差异, 而是将局部变量表和操作数栈都做了完整的记录。它的结构如下:</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">full_frame {</span><br><span class="line">    u1 frame_type = FULL_FRAME; <span class="comment">/* 255 */</span></span><br><span class="line">    u2 offset_delta;</span><br><span class="line">    u2 number_of_locals;</span><br><span class="line">    verification_type_info locals[number_of_locals];</span><br><span class="line">    u2 number_of_stack_items;</span><br><span class="line">    verification_type_info <span class="built_in">stack</span>[number_of_stack_items];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>可以看到, 在 full_frame 中, 显示指定了 offset_delta, 完整记录了局部变量表的数量(number_of_locals)、局部变量表的数据类型(locals)、操作数栈的数量(number_of_stack_items)和操作数栈的类型(stack)。</p>
<p>至此，Code 属性的全部内容就已经介绍完了，为了让大家更加清晰地理解 Method 结构，Code 属性，以及 LineNumberTable，LocalVariableTable，StackMapTable 的关系，不妨看一看下面这个关系图，其中的箭头表示了它们之间的附属关系，即 LineNumberTable，LocalVariableTable，StackMapTable 属于 Code 属性，而 Code 属性又属于 Method 结构。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/relationship-method-code-attributes.png" alt="relationship-method-code-attributes"></p>
<h5 id="Exception-属性"><a href="#Exception-属性" class="headerlink" title="Exception 属性"></a>Exception 属性</h5><p>除了 Code 属性外，每个方法都可以有一个 Exception 属性，用于保存该方法可能抛出的异常信息，也就是受验异常（checked exception）。该属性的结构如下：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Exception_attribute {</span><br><span class="line">    u2 attribute_name_index; <span class="comment">// 指定了属性的名称, 它为指向常量池的索引, 恒为"Exceptions"</span></span><br><span class="line">    u4 attribute_length; <span class="comment">// 属性长度</span></span><br><span class="line">    u2 number_of_exception; <span class="comment">// 表示表项数最即可能拋出的异常个数</span></span><br><span class="line">    u2 exception_index_table[number_of_exception]; <span class="comment">// 罗列了所有的异常, 每一项为指向常量池的索引, 对应的常量为 CONSTANT_Class, 为一个异常类。</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>Exceptions 与 Code 属性中的异常表不同。Exceptions 属性表示一个方法可能拋出的异常, 通常是由方法的 throws 关键字指定的。而 Code 属性中的异常表, 则是异常处理机制, 由 try-catch 语句生成。</p>
<p>在 TestClass 中, attribute_name_index 是 29（0x1D), 内容为 “Exceptions”, attribute_length 4(0x04）, number_of_exceptions 为 1（0x01）, 最后 exception_index_table 指向常量池的索引 3（0x03）, 该 CONSTANT_Class 常量池项的名称也存储在常量池项中，对应的常量池项为 34（0x22），内容为 <code>java/io/IOException</code>。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/method2-exceptions.png" alt="method2-exceptions"></p>
<h3 id="Class-文件属性"><a href="#Class-文件属性" class="headerlink" title="Class 文件属性"></a>Class 文件属性</h3><p>在方法之后，就是 Class 文件的属性部分了，这也是 Class 文件中最后的一部分内容。</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ClassFile {</span><br><span class="line">    ...</span><br><span class="line">    u2 attributes_count;</span><br><span class="line">    attribute_info attributes[attributes_count];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>Class 的属性类型也有好几种，比如 SourceFile，BootstrapMethod，InnerClasses，Deprecated 等。但是在介绍这些内容之前，我打算为大家推荐一个字节码查看工具，它叫做 <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2luZ29rZWdlbC9qY2xhc3NsaWI=" title="https://github.com/ingokegel/jclasslib">jclasslib<i class="fa fa-external-link"></i></span>, 我这里使用的是 IDEA 的<span class="exturl" data-url="aHR0cHM6Ly9wbHVnaW5zLmpldGJyYWlucy5jb20vcGx1Z2luLzkyNDgtamNsYXNzbGliLWJ5dGVjb2RlLXZpZXdlcg==" title="https://plugins.jetbrains.com/plugin/9248-jclasslib-bytecode-viewer">插件版<i class="fa fa-external-link"></i></span>, 通过它能够一目了然的看到 Class 文件中的所有组成部分，如果大家以后打算分析 Class 文件，还是推荐大家使用这个工具，并不推荐人工对着 Class 二进制文件进行分析，说实话，挺费眼睛的 ^.^，当然，如果您偏爱命令行工具的话，<span class="exturl" data-url="aHR0cHM6Ly9kb2NzLm9yYWNsZS5jb20vamF2YXNlLzgvZG9jcy90ZWNobm90ZXMvdG9vbHMvd2luZG93cy9qYXZhcC5odG1s" title="https://docs.oracle.com/javase/8/docs/technotes/tools/windows/javap.html">javap<i class="fa fa-external-link"></i></span> 是一个不错的选择。工具虽然好用，但是我们前面的图例都是以二进制文件分析为主，之所以这么做是想加深大家对 Class 文件组织方式的认识。但是，看到这想必大家已经对它了然于心了，所以后续我们将改为以 <code>jclasslib</code> 图例为主进行介绍。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/jclasslib.png" alt="jclasslib"></p>
<h4 id="SourceFile-属性"><a href="#SourceFile-属性" class="headerlink" title="SourceFile 属性"></a>SourceFile 属性</h4><p>SourceFile 属性是属于 Class 文件的属性。它用于描述当前这个 Class 文件是由哪个源代码文件编译得来的, 格式如下:</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SourceFile_attribute {</span><br><span class="line">    u2 attribute_name_index; <span class="comment">// 属性名，指向常量池的一个索引，这里恒为 "SourceFile"</span></span><br><span class="line">    u4 attribute_length; <span class="comment">// 属性长度，对于 SourceFile 而言，恒为 2</span></span><br><span class="line">    u2 sourcefile_index; <span class="comment">// 表示源代码文件名，指向常量池的一个索引</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>在我们的 TestClass 中，SourceFile_attribute 的内容就是 <code>TestClass.java</code>，它保存在一个 utf8 常量池项中。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/source-file-class.png" alt="source-file-class"></p>
<h4 id="BootstrapMethod-属性"><a href="#BootstrapMethod-属性" class="headerlink" title="BootstrapMethod 属性"></a>BootstrapMethod 属性</h4><p>为了支持 JDK1.7 中的 invokedynamic 指令, Java 虚拟机増加了 BootstrapMethods 属性, 它用于描述和保存引导方法。引导方法可以理解成是一个查找方法的方法, invokeDynamic 需要能够在运行时根据实际情况返回合适的方法调用, 而使用何种策略去查找所需要的方法, 是由引导方法决定的, 这里的 BootstrapMethods 属性就是用于找到调用的目标方法，注意，这里所说的引导方法和正常的方法有些不同，正常的方法都是描述一个方法体，方法体包含方法的声明以及方法的字节码，而引导方法更像是描述一次函数的调用，其中包括实际调用的引导函数的引用，以及调用时所用的参数，这和前面的 Code 属性有很大的不同。该属性是 Class 文件的属性, 属性结构如下:</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">BootStrapMethods_attribute {</span><br><span class="line">    u2 attribute_name_index; <span class="comment">// 属性名称，指向常量池索引，这里为 “BootstrapMethods”</span></span><br><span class="line">    u4 attribute_length; <span class="comment">// 4字节数字，表示属性长度（不含前六个字节）</span></span><br><span class="line">    u2 num_bootstrap_methods; <span class="comment">// 表示引导方法的数量</span></span><br><span class="line">    {</span><br><span class="line">        u2 bootstrap_method_ref; <span class="comment">// 指向常量池的常数，对应的常量池项类型为 CONSTANT_MethodHandle，用于指明实际的引导函数</span></span><br><span class="line">        u2 num_bootstrap_arguments; <span class="comment">// 指明引导函数的参数个数</span></span><br><span class="line">        u2 bootstrap_arguments[num_bootstrap_arguments]; <span class="comment">// 参数的内容</span></span><br><span class="line">    } bootstrap_methods[num_bootstrap_methods]; <span class="comment">// num_bootstrap_methods 个引导方法</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>因为，我们的 TestClass 中并不包含 invokeDynamic，所以我们现在对其进行一波改写，让它能够覆盖接下来的各种属性，改写后 TestClass 如下所示：</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bbm.jvm;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Closeable;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.util.function.Consumer;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Deprecated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestClass</span> <span class="keyword">implements</span> <span class="title">Closeable</span>, <span class="title">Cloneable</span> </span>{</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">close</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>{</span><br><span class="line">        Consumer&lt;Integer&gt; consumer = i -&gt; {};</span><br><span class="line">        consumer.accept(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">new</span> TestInner().test();</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Deprecated</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deprecated</span><span class="params">()</span> </span>{</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">TestInner</span> </span>{</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> </span>{</span><br><span class="line">            System.out.println(<span class="string">'1'</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>改写完之后，我们编译 TestClass 并用 jclasslib 打开它的 Class 文件，就会发现 close 函数中已经出现了 invokedynamic 指令，它的参数保存在 2 号常量池项中。</p>
<figure class="highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> 0 invokedynamic #2 &lt;accept, BootstrapMethods #0&gt;</span><br><span class="line"> 5 astore_1</span><br><span class="line"> 6 aload_1</span><br><span class="line"> 7 iconst_1</span><br><span class="line"> 8 invokestatic #3 &lt;java/lang/Integer.valueOf&gt;</span><br><span class="line">11 invokeinterface #4 &lt;java/util/function/Consumer.accept&gt; count 2</span><br><span class="line">16 new #5 &lt;bbm/jvm/TestClass$Test&gt;</span><br><span class="line">19 dup</span><br><span class="line">20 invokespecial #6 &lt;bbm/jvm/TestClass$Test.&lt;init&gt;&gt;</span><br><span class="line">23 invokevirtual #7 &lt;bbm/jvm/TestClass$Test.hh&gt;</span><br><span class="line">26 return</span><br></pre></td></tr></tbody></table></figure>

<p>2 号常量池项的类型是 CONSTANT_InvokeDynamic_info，其中的内容如下，可以看到其中包含一个 CONSTANT_NameAndType 类型的常量池项和一个引导方法的编号（本例中是编号 0），而 CONSTANT_NameAndType 常量池项中 Name 部分保存的是 <code>accept</code>，Type 部分保存的是 <code>()Ljava/util/function/Consumer;</code>。这两个数据后面 JVM 会用到，我们后面再说，这里接着去看一下引导方法 BootStrapMethods_attribute 中都保存了什么。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/bootstrap-method.png" alt="bootstrap-method"><br>引导方法中只包含一份数据（编号为 0），实际使用到的引导方法引用保存在 40 号常量池项中，该项类型为 CONSTANT_MethodHandle，对应的函数是 <code>java/lang/invoke/LambdaMetaFactory.metafactory</code>, 使用的参数有 3 个，它们分别保存在 41（CONSTANT_MethodType），42（CONSTANT_MethodHandle），43（CONSTANT_MethodType） 号常量池项中。</p>
<p>这里，我们不妨看一下 <code>LambdaMetaFactory.metafactory</code> 这个引导函数是怎么实现的。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LambdaMetafactory</span> </span>{</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> CallSite <span class="title">metafactory</span><span class="params">(MethodHandles.Lookup caller,</span></span></span><br><span class="line"><span class="function"><span class="params">                                           String invokedName,</span></span></span><br><span class="line"><span class="function"><span class="params">                                           MethodType invokedType,</span></span></span><br><span class="line"><span class="function"><span class="params">                                           MethodType samMethodType,</span></span></span><br><span class="line"><span class="function"><span class="params">                                           MethodHandle implMethod,</span></span></span><br><span class="line"><span class="function"><span class="params">                                           MethodType instantiatedMethodType)</span></span></span><br><span class="line"><span class="function">                <span class="keyword">throws</span> LambdaConversionException </span>{</span><br><span class="line">        AbstractValidatingLambdaMetafactory mf;</span><br><span class="line">        mf = <span class="keyword">new</span> InnerClassLambdaMetafactory(caller, invokedType,</span><br><span class="line">                                             invokedName, samMethodType,</span><br><span class="line">                                             implMethod, instantiatedMethodType,</span><br><span class="line">                                             <span class="keyword">false</span>, EMPTY_CLASS_ARRAY, EMPTY_MT_ARRAY);</span><br><span class="line">        mf.validateMetafactoryArgs();</span><br><span class="line">        <span class="keyword">return</span> mf.buildCallSite();</span><br><span class="line">    }</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>看到这大家可能会有疑问，<code>metafactory</code> 有 6 个参数啊，但是我们在 BootStrapMethods_attribute 中只含有 3 个参数。实际上，前三个参数是 JVM 帮我们自动填充的：</p>
<ul>
<li>MethodHandles.Lookup caller: 代表查找上下文与调用者的访问权限, 使用 invokedynamic 指令时, JVM 会自动自动填充这个参数</li>
<li>String invokedName: 要实现的方法的名字, 使用 invokedynamic 时, JVM 自动帮我们填充(填充内容来自常量池 InvokeDynamic.NameAndType.Name), 在这里 JVM 为我们填充 “accept”，因为我们的 lambda 表达式实际上要实现的函数是 Consumer.accept。</li>
<li>MethodType invokedType: 调用点期望的方法参数的类型和返回值的类型(方法签名)。使用 invokedynamic 指令时, JVM 会自动自动填充这个参数(填充内容来自常量池 InvokeDynamic.NameAndType.Type), 在这里整个 invokedynamic 执行的是一个调用点 CallSite，这个调用点没有参数，返回值类型为 <code>Ljava/util/function/Consumer;</code>，而 invokedType 描述的就是这个调用点 CallSite 的签名 <code>()Ljava/util/function/Consumer;</code>。这里大家可能有点难理解为什么调用点的签名中没有参数，我们稍后解答这个问题。</li>
<li>MethodType samMethodType: 函数对象（即 accept 函数）将要实现的接口方法类型, 这里对应的是运行时函数签名, 值为引导方法属性中保存的第一个参数 <code>(Ljava/lang/Object;)V</code>，之所以不是 <code>(Ljava/lang/Integer;)V</code> 是因为 Java 编译器中泛型的实现是通过泛型信息擦除的方式实现的，即所有泛型 T 的签名都被改写为 Object, 而在使用这些对象的地方，编译器会为其添加类型转换。</li>
<li>MethodHandle implMethod: 一个直接方法句柄(DirectMethodHandle), 描述在调用（accept）时将被执行的具体实现方法 (包含适当的参数适配, 返回类型适配, 和在调用参数前附加上捕获的参数), 在这里为 <code>bbm/jvm/TestClass.lambda$close0</code>, 细心地同学会发现该函数实际上是编译器自动帮我们添加的函数，其中的内容就是我们在 lambda 表达式中写的内容。<ul>
<li><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/bootstrap-method.png" alt="bootstrap-method"></li>
</ul>
</li>
<li>MethodType instantiatedMethodType: 函数接口方法替换泛型为具体类型后的方法类型, 如果不使用泛型的话和 samMethodType 一样, 当使用泛型时，因为泛型的实现是通过类型擦除进行的，所以这里需要记录实际的签名，即 <code>(Ljava/lang/Integer;)V</code>，这才是 <code>Consumer&lt;Integer&gt;</code> 实例中 accept 函数的实际签名。</li>
</ul>
<p><strong>名词解释：</strong></p>
<ul>
<li>方法句柄(Method Handler): 方法句柄很像一个方法指针, 或者代理。通过方法句柄, 就可以调用一个方法。在Class文件的常量池中, 有一项常量类型为 CONSTANT_MethodHandle, 这就是方法句柄。</li>
<li>调用点(CallSite): 调用点是对方法句柄的封装, 通过调用点, 可以获得一个方法句柄进行函数调用。使用调用点可以增强方法句柄的表达能力, 比如对于可变调用点来说, 它绑定的方法句柄是可变的, 因此, 对同一个调用点而言, 其调用函数是可变的。</li>
<li>启动方法(BootstrapMethods): 通过启动方法可以获得一个调用点, 获取调用点的目的是为了进行方法绑定和调用。</li>
<li>方法类型 (Method Type): 用于描述方法的签名,比如方法的参数类型、返回值等。根据方法的类型, 可以查找到可用的方法句柄。</li>
</ul>
<p>接下来我们说一说，为什么 invokedType 等于 <code>()Ljava/util/function/Consumer;</code>。编译器在编译的时候， 会将 Lambda 表达式的表达式体 (lambda body)脱糖(desugar) 成一个方法，在我们的例子中这个方法就是 <code>TestClass.lambda$close0</code>，此方法的参数列表和返回类型和 lambda 表达式一致, 也就是 <code>(Ljava/lang/Integer;)V</code>，如果有捕获参数，脱糖的方法的参数可能会更多一些。这里可能有的同学不明白什么是捕捉参数，捕捉参数就是 lambda 表达式内对外层空间变量的引用。比如，如果我们将 lambda 改成如下形式，那么局部变量 test 就是一个捕捉参数。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TestClass test = <span class="keyword">new</span> TestClass();</span><br><span class="line">Consumer&lt;Integer&gt; consumer = i -&gt; {test.deprecated();};</span><br></pre></td></tr></tbody></table></figure>

<p>如果我们将 TestClass 中的 lambda 表达式改成上述形式的话，<code>TestClass.lambda$close0</code> 的函数签名也会跟着变化，变成 <code>(Lbbm/jvm/TestClass;Ljava/lang/Integer;)V</code>。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/lambda-close-1.png" alt="lambda-close-1"><br>此外，编译器还会产生一个 invokedynamic 调用，调用一个 call site。这个 call site 被调用时会返回 lambda 表达式的目标类型(functional interface)的一个实现类，在我们的例子中这个实现类就是 <code>Consumer&lt;Integer&gt;</code>。这个 call site 称为这个 lambda 表达式的 lambda factory。lambda factory 的 bootstrap 方法是一个标准方法，就是我们前面介绍的 lambda metafactory。这个 CallSite 在没有捕捉参数时，大家可以把它理解成如下形式, 所以 invokedType 签名才是 <code>()Ljava/util/function/Consumer;</code>。</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Consumer&lt;Integer&gt; consumer = callSite();</span><br></pre></td></tr></tbody></table></figure>

<p>而当存在捕捉参数时，就比如前面的 <code>i -&gt; {test.deprecated();};</code>, 这时候 CallSite 的签名就会发生变化，变成 <code>(Lbbm/jvm/TestClass)Ljava/util/function/Consumer;</code>。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/invoke-type-2.png" alt="invoke-type-2"></p>
<h4 id="InnerClasses-属性"><a href="#InnerClasses-属性" class="headerlink" title="InnerClasses 属性"></a>InnerClasses 属性</h4><p>InnerClass 属性是 Class 文件的属性，它用来描述当前 Class 文件中定义的或者所使用的所有内部类，以及该内部类所属的外部类是哪个。它的结构如下：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">InnerClasses_attribute {</span><br><span class="line">    u2 attribute_name_index; <span class="comment">// 属性名，指向常量池索引，这里恒为 "InnerClaaes"</span></span><br><span class="line">    u4 attribute_length; <span class="comment">// 属性长度</span></span><br><span class="line">    u2 number_of_classes; <span class="comment">// 使用的内部类的数量</span></span><br><span class="line">    {</span><br><span class="line">        u2 inner_class_info_index; <span class="comment">// 指向内部类对应的 Class 类型常量池项，表示内部类的类型</span></span><br><span class="line">        u2 outter_class_info_index; <span class="comment">// 指向外部类对应的 Class 类型常量池项，表示外部类的类型</span></span><br><span class="line">        u2 inner_name_index; <span class="comment">// 表示内部类的名称，指向 utf8 常量池项</span></span><br><span class="line">        u2 inner_class_access_flags; <span class="comment">// 内部类访问标示符，用于指示 public static 等，存储方式与之前的访问标示符相同</span></span><br><span class="line">    } classes[number_of_classes];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>在我们的 TestClass 中，有一个 TestInner 内部类，它的 Class 文件保存在一个单独的 Class 文件中，与 TestClass 的 Class 文件是独立的。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/inner-class-file.png" alt="inner-class-file"><br>而在 TestClass 的 Class 文件中的 InnerClasses 属性，会记录所有在 TestClass 中定义或者使用到的内部类。因为 TestClass 中使用了 lambda 表达式，lambda 表达式的 bootstrap 是 <code>metafactory</code>, 而该函数的第一个参数的类型就是一个内部类 <code>MethodHandles.Lookup</code>。所以，在我们的 TestClass 的 Class 文件中 InnerClasses 属性有两项内容，一个是 <code>TestInner</code>, 另一个就是 <code>MethodHandles.Lookup</code>。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/inner-class.png" alt="inner-class"></p>
<h4 id="Deprecated-属性"><a href="#Deprecated-属性" class="headerlink" title="Deprecated 属性"></a>Deprecated 属性</h4><p>Deprecated 属性可以出现在，类，方法，字段结构中，用于表示该类，字段，方法将来会被废弃，它的结构很简单：</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Deprecated_attribute {</span><br><span class="line">    u2 attribute_name_index; <span class="comment">// 属性名，指向常量池索引，这里恒为 "Deprecated"</span></span><br><span class="line">    u4 attribute_length; <span class="comment">// 属性长度, 这里恒为 0</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>在 TestClass 中，因为整个类和类中的 <code>deprecated</code> 函数都被打上了 <code>@Deprecated</code> 注解，所以 Deprecated 属性即会出现在 <code>deprecated</code> 函数的属性中，也会出现在 TestClass 类的属性中。<br><img src="/images/loading-cat.gif" data-original="https://bbm-hexo.oss-accelerate.aliyuncs.com/images/jvm/deprecated.png" alt="deprecated"></p>
<h2 id="参考内容"><a href="#参考内容" class="headerlink" title="参考内容"></a>参考内容</h2><p>[1]《实战 Java 虚拟机》<br>[2]《深入理解 Java 虚拟机》<br>[3] <span class="exturl" data-url="aHR0cHM6Ly9obGx2bS1ncm91cC5pdGV5ZS5jb20vZ3JvdXAvdG9waWMvMjg1OTQ=" title="https://hllvm-group.iteye.com/group/topic/28594">GC复制算法和标记-压缩算法的疑问<i class="fa fa-external-link"></i></span><br>[4] <span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3F1ZXN0aW9uLzUwMzgxNDM5" title="https://www.zhihu.com/question/50381439">Java中什么样的对象才能作为gc root，gc roots有哪些呢？<i class="fa fa-external-link"></i></span><br>[5] <span class="exturl" data-url="aHR0cHM6Ly9wbHVtYnIuaW8vaGFuZGJvb2svZ2FyYmFnZS1jb2xsZWN0aW9uLWFsZ29yaXRobXMtaW1wbGVtZW50YXRpb25zL2NvbmN1cnJlbnQtbWFyay1hbmQtc3dlZXA=" title="https://plumbr.io/handbook/garbage-collection-algorithms-implementations/concurrent-mark-and-sweep">concurrent-mark-and-sweep<i class="fa fa-external-link"></i></span><br>[6] <span class="exturl" data-url="aHR0cHM6Ly93d3cuemhpaHUuY29tL3F1ZXN0aW9uLzYxMDkwOTc1" title="https://www.zhihu.com/question/61090975">关于 -XX:+CMSScavengeBeforeRemark，是否违背cms的设计初衷？<i class="fa fa-external-link"></i></span><br>[7] <span class="exturl" data-url="aHR0cHM6Ly90ZWNoLm1laXR1YW4uY29tLzIwMTYvMDkvMjMvZzEuaHRtbA==" title="https://tech.meituan.com/2016/09/23/g1.html">Java Hotspot G1 GC的一些关键技术<i class="fa fa-external-link"></i></span><br>[8] <span class="exturl" data-url="aHR0cHM6Ly9saXVqaWFjYWkubmV0L2Jsb2cvMjAxOS8wMS8wOS9qYXZhLWdjLWRlZmluaXRpdmUtZ3VpZGUv" title="https://liujiacai.net/blog/2019/01/09/java-gc-definitive-guide/">Java 垃圾回收权威指北<i class="fa fa-external-link"></i></span><br>[9] <span class="exturl" data-url="aHR0cHM6Ly9obGx2bS1ncm91cC5pdGV5ZS5jb20vZ3JvdXAvdG9waWMvNDQzODE=" title="https://hllvm-group.iteye.com/group/topic/44381">[HotSpot VM] 请教G1算法的原理<i class="fa fa-external-link"></i></span><br>[10] <span class="exturl" data-url="aHR0cHM6Ly9obGx2bS1ncm91cC5pdGV5ZS5jb20vZ3JvdXAvdG9waWMvNDQ1Mjk=" title="https://hllvm-group.iteye.com/group/topic/44529">[HotSpot VM] 关于incremental update与SATB的一点理解<i class="fa fa-external-link"></i></span><br>[11] <span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3BhbmdlMTk5MS9hcnRpY2xlL2RldGFpbHMvNTM4NjA2NTE=" title="https://blog.csdn.net/pange1991/article/details/53860651">Java线程的6种状态及切换<i class="fa fa-external-link"></i></span><br>[12] <span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JhaW50dW5nbGkvYXJ0aWNsZS9kZXRhaWxzLzU0OTEwMTUy" title="https://blog.csdn.net/raintungli/article/details/54910152">Java 8 动态类型语言Lambda表达式实现原理分析<i class="fa fa-external-link"></i></span><br>[13] <span class="exturl" data-url="aHR0cHM6Ly9jb2xvYnUuY29tLzIwMTQvMTEvMDYvc2VjcmV0cy1vZi1qYXZhLTgtbGFtYmRhLw==" title="https://colobu.com/2014/11/06/secrets-of-java-8-lambda/">Java 8 Lambda 揭秘<i class="fa fa-external-link"></i></span><br>[14] <span class="exturl" data-url="aHR0cHM6Ly90ZWNoLm1laXR1YW4uY29tLzIwMTkvMDkvMDUvamF2YS1ieXRlY29kZS1lbmhhbmNlbWVudC5odG1s" title="https://tech.meituan.com/2019/09/05/java-bytecode-enhancement.html">字节码增强技术探索<i class="fa fa-external-link"></i></span><br>[15] <span class="exturl" data-url="aHR0cHM6Ly90ZWNoLm1laXR1YW4uY29tLzIwMTgvMTEvMTUvamF2YS1sb2NrLmh0bWw=" title="https://tech.meituan.com/2018/11/15/java-lock.html">不可不说的Java“锁”事<i class="fa fa-external-link"></i></span><br>[16] <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Zhcm1lcmpvaG5naXQvbXlibG9nL2lzc3Vlcy8xMg==" title="https://github.com/farmerjohngit/myblog/issues/12">死磕Synchronized底层实现–概论<i class="fa fa-external-link"></i></span><br>[17] <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Zhcm1lcmpvaG5naXQvbXlibG9nL2lzc3Vlcy8xMw==" title="https://github.com/farmerjohngit/myblog/issues/13">死磕Synchronized底层实现–偏向锁<i class="fa fa-external-link"></i></span><br>[18] <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Zhcm1lcmpvaG5naXQvbXlibG9nL2lzc3Vlcy8xNA==" title="https://github.com/farmerjohngit/myblog/issues/14">死磕Synchronized底层实现–轻量级锁<i class="fa fa-external-link"></i></span><br>[19] <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2Zhcm1lcmpvaG5naXQvbXlibG9nL2lzc3Vlcy8xNQ==" title="https://github.com/farmerjohngit/myblog/issues/15">死磕Synchronized底层实现–重量级锁<i class="fa fa-external-link"></i></span></p>

    </div>

    
    
    

      
        <div id="wechat_subscriber" style="display: block; padding: 10px 0; margin: 20px auto; width: 100%; text-align: center">
  <img id="wechat_subscriber_qcode" src="/images/qrcode_for_wechat.jpg" alt="贝克街的流浪猫 wechat" style="width: 400px; max-width: 100%;">
  <div></div>
</div>

      
        <div class="reward-container">
  <div>您的打赏将鼓励我继续分享!</div>
  <button disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
      
      <div style="display: inline-block;">
        <img src="/images/wechat.jpg" alt="贝克街的流浪猫 微信支付">
        <p>微信支付</p>
      </div>
      
      <div style="display: inline-block;">
        <img src="/images/alipay.jpg" alt="贝克街的流浪猫 支付宝">
        <p>支付宝</p>
      </div>

  </div>
</div>

        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>贝克街的流浪猫
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://www.beikejiedeliulangmao.top/java/jvm/class-file/" title="JVM Class 文件结构">https://www.beikejiedeliulangmao.top/java/jvm/class-file/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9udWxs"><i class="fa fa-fw fa-creative-commons"></i>BY-NC-SA</span> 许可协议，转载请注明出处！
  </li>
  <li class="post-copyright-license">
    <strong>创作声明： </strong>本文基于上述所有参考内容进行创作，其中可能涉及复制、修改或者转换，图片均来自网络，如有侵权请联系我，我会第一时间进行删除。
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Java/" rel="tag"># Java</a>
              <a href="/tags/JVM/" rel="tag"># JVM</a>
              <a href="/tags/HotSpot/" rel="tag"># HotSpot</a>
              <a href="/tags/ClassFile/" rel="tag"># ClassFile</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
                <a href="/java/jvm/bytecode-tech/" rel="next" title="JVM 字节码技术">
                  <i class="fa fa-chevron-left"></i> JVM 字节码技术
                </a>
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
                <a href="/java/jvm/lock/" rel="prev" title="JVM Synchronized 锁实现">
                  JVM Synchronized 锁实现 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
      </footer>
    
  </article>
  
  
  

  </div>


          </div>
          
    <div class="comments" id="gitalk-container"></div>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%BC%95%E8%A8%80"><span class="nav-number">1.</span> <span class="nav-text">引言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Class-%E6%96%87%E4%BB%B6%E7%BB%93%E6%9E%84"><span class="nav-number">2.</span> <span class="nav-text">Class 文件结构</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%AD%94%E6%95%B0"><span class="nav-number">2.1.</span> <span class="nav-text">魔数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%87%E4%BB%B6%E7%89%88%E6%9C%AC"><span class="nav-number">2.2.</span> <span class="nav-text">文件版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B8%B8%E9%87%8F%E6%B1%A0"><span class="nav-number">2.3.</span> <span class="nav-text">常量池</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E6%A0%87%E8%AE%B0"><span class="nav-number">2.4.</span> <span class="nav-text">访问标记</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BD%93%E5%89%8D%E7%B1%BB%E3%80%81%E7%88%B6%E7%B1%BB%E3%80%81%E6%8E%A5%E5%8F%A3"><span class="nav-number">2.5.</span> <span class="nav-text">当前类、父类、接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E6%AE%B5"><span class="nav-number">2.6.</span> <span class="nav-text">字段</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%96%B9%E6%B3%95"><span class="nav-number">2.7.</span> <span class="nav-text">方法</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%96%B9%E6%B3%95%E5%B1%9E%E6%80%A7"><span class="nav-number">2.7.1.</span> <span class="nav-text">方法属性</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Code-%E5%B1%9E%E6%80%A7"><span class="nav-number">2.7.1.1.</span> <span class="nav-text">Code 属性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#LineNumberTable-%E5%B1%9E%E6%80%A7"><span class="nav-number">2.7.1.2.</span> <span class="nav-text">LineNumberTable 属性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#LocalVariableTable-%E5%B1%9E%E6%80%A7"><span class="nav-number">2.7.1.3.</span> <span class="nav-text">LocalVariableTable 属性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#StackMapTable-%E5%B1%9E%E6%80%A7"><span class="nav-number">2.7.1.4.</span> <span class="nav-text">StackMapTable 属性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Exception-%E5%B1%9E%E6%80%A7"><span class="nav-number">2.7.1.5.</span> <span class="nav-text">Exception 属性</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Class-%E6%96%87%E4%BB%B6%E5%B1%9E%E6%80%A7"><span class="nav-number">2.8.</span> <span class="nav-text">Class 文件属性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SourceFile-%E5%B1%9E%E6%80%A7"><span class="nav-number">2.8.1.</span> <span class="nav-text">SourceFile 属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#BootstrapMethod-%E5%B1%9E%E6%80%A7"><span class="nav-number">2.8.2.</span> <span class="nav-text">BootstrapMethod 属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#InnerClasses-%E5%B1%9E%E6%80%A7"><span class="nav-number">2.8.3.</span> <span class="nav-text">InnerClasses 属性</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Deprecated-%E5%B1%9E%E6%80%A7"><span class="nav-number">2.8.4.</span> <span class="nav-text">Deprecated 属性</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83%E5%86%85%E5%AE%B9"><span class="nav-number">3.</span> <span class="nav-text">参考内容</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="贝克街的流浪猫" src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">贝克街的流浪猫</p>
  <div class="site-description" itemprop="description">贝贝猫</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">120</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">158</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="feed-link motion-element">
    <a href="/atom.xml" rel="alternate">
      <i class="fa fa-rss"></i>RSS
    </a>
  </div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL0JlaUtlSmllRGVMaXVMYW5nTWFv" title="GitHub → https://github.com/BeiKeJieDeLiuLangMao"><i class="fa fa-fw fa-github"></i></span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly96aHVhbmxhbi56aGlodS5jb20vY18xMTY3NDI5NTg4NzExMzM3OTg1" title="知乎 → https://zhuanlan.zhihu.com/c_1167429588711337985"><i class="fa fa-fw fa-book"></i></span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="bWFpbHRvOjUxNzM3NTY4NUBxcS5jb20=" title="E-Mail → mailto:517375685@qq.com"><i class="fa fa-fw fa-envelope"></i></span>
      </span>
      <span class="links-of-author-item">
        <span class="exturl" data-url="aHR0cHM6Ly9zdGFja292ZXJmbG93LmNvbS91c2Vycy84NzgyOTY0L3lhbmctY2hlbj90YWI9cHJvZmlsZQ==" title="StackOverflow → https://stackoverflow.com/users/8782964/yang-chen?tab=profile"><i class="fa fa-fw fa-stack-overflow"></i></span>
      </span>
  </div>



      </div>
        <div class="back-to-top motion-element">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        
  <div class="beian"><span class="exturl" data-url="aHR0cDovL3d3dy5iZWlhbi5taWl0Lmdvdi5jbg==">辽ICP备19017854号 </span>
  </div>

<div class="copyright">
  
  © 2019 – 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">贝克街的流浪猫</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">站点总字数：</span>
    <span title="站点总字数">1.5m</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span class="post-meta-item-text">站点阅读时长 ≈</span>
    <span title="站点阅读时长">22:36</span>
</div>

        
<div class="busuanzi-count">
  <script async="" src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        贝贝猫有
        <span id="busuanzi_value_site_uv"></span>
        位同学
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        笔记被翻阅
        <span id="busuanzi_value_site_pv"></span>
        次
      </span>
    </span>
</div>






  






        
      </div>
    </footer>
  </div>

  
  
  <script src="//cdn.jsdelivr.net/npm/medium-zoom@1/dist/medium-zoom.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/pangu@4/dist/browser/pangu.min.js"></script>
  
  














  
  




  

<script src="//cdn.jsdelivr.net/npm/instantsearch.js@2/dist/instantsearch.min.js"></script>

















  

  
  <script src="//cdn.jsdelivr.net/npm/quicklink@1/dist/quicklink.umd.js"></script>
  







<script type="text/javascript" src="/bundle.js"></script><script type="text/javascript">function leancloudSelector(url) {
    return document.getElementById(url).querySelector('.leancloud-visitors-count');
  }
  if (CONFIG.page.isPost) {
    function addCount(Counter) {
      var visitors = document.querySelector('.leancloud_visitors');
      var url = visitors.getAttribute('id').trim();
      var title = visitors.getAttribute('data-flag-title').trim();

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length > 0) {
            var counter = results[0];
              leancloudSelector(url).innerText = counter.time + 1;
            Counter('put', '/classes/Counter/' + counter.objectId, { time: { '__op': 'Increment', 'amount': 1 } })
              .then(response => response.json())
              .catch(error => {
                console.log('Failed to save visitor count', error);
              })
          } else {
              leancloudSelector(url).innerText = 'Counter not initialized! More info at console err msg.';
              console.error('ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.');
            
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  } else {
    function showTime(Counter) {
      var visitors = document.querySelectorAll('.leancloud_visitors');
      var entries = [...visitors].map(element => {
        return element.getAttribute('id').trim();
      });

      Counter('get', `/classes/Counter?where=${JSON.stringify({ url: { '$in': entries } })}`)
        .then(response => response.json())
        .then(({ results }) => {
          if (results.length === 0) {
            document.querySelectorAll('.leancloud_visitors .leancloud-visitors-count').forEach(element => {
              element.innerText = 0;
            });
            return;
          }
          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.url;
            var time = item.time;
            leancloudSelector(url).innerText = time;
          }
          for (var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = leancloudSelector(url);
            if (element.innerText == '') {
              element.innerText = 0;
            }
          }
        })
        .catch(error => {
          console.log('LeanCloud Counter Error', error);
        });
    }
  }

  fetch('https://app-router.leancloud.cn/2/route?appId=gmT3IkYtHVMymcwAjbwHhtiv-gzGzoHsz')
    .then(response => response.json())
    .then(({ api_server }) => {
      var Counter = (method, url, data) => {
        return fetch(`https://${api_server}/1.1${url}`, {
          method: method,
          headers: {
            'X-LC-Id': 'gmT3IkYtHVMymcwAjbwHhtiv-gzGzoHsz',
            'X-LC-Key': 'co6tpmcyS9za2D1uqQyMFtnN',
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });
      };
      if (CONFIG.page.isPost) {
        const localhost = /http:\/\/(localhost|127.0.0.1|0.0.0.0)/;
        if (localhost.test(document.URL)) return;
        addCount(Counter);
      } else if (document.querySelectorAll('.post-title-link').length >= 1) {
        showTime(Counter);
      }
    });;(function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();;if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme: 'forest',
      logLevel: 3,
      flowchart: { curve: 'linear' },
      gantt: { axisFormat: '%m/%d/%Y' },
      sequence: { actorMargin: 50 }
    });
  }, window.mermaid);
};window.addEventListener('load', () => {
      quicklink({
        timeout: 3000,
        priority: true,
        ignores: [uri => uri.includes('#'),uri => uri == 'https://www.beikejiedeliulangmao.top/java/jvm/class-file/',]
      });
      });;NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: '6201d1cc2825a93aa161',
      clientSecret: '71c60f650595a3eedba64b844f811b90acac3798',
      repo: 'HexoBlogComment',
      owner: 'BeiKeJieDeLiuLangMao',
      admin: ['BeiKeJieDeLiuLangMao'],
      id: '79ec3038693b40e516eebde228b51c90',
        language: 'zh-CN',
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);;window.imageLazyLoadSetting = {
                isSPA: false,
                processImages: null,
            };;window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});;!function(n){n.imageLazyLoadSetting.processImages=o;var i=n.imageLazyLoadSetting.isSPA,l=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function o(){i&&(l=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var r=0;r<l.length;r++)t=l[r],void 0,0<=(e=t.getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(n.innerHeight||document.documentElement.clientHeight)&&function(t){var e,n,i,o,a=l[r];e=a,n=function(){l=l.filter(function(t){return a!==t})},i=new Image,o=e.getAttribute("data-original"),i.onload=function(){e.src=o,n&&n()},i.src=o}();var t,e}o(),n.addEventListener("scroll",function(){var t,e;t=o,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body></html>